<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE server
    PUBLIC "-//JBoss//DTD MBean Service 4.0//EN"
    "http://www.jboss.org/j2ee/dtd/jboss-service_4_0.dtd">

<server>

<!--
Buni Meldware 1.0 milestone 7 configruation.
Please see http://www.buni.org/mediawiki/index.php/Meldware_Installation_Guide_v_1.0M7 for more
configuration details.
-->

  <!-- The SSL domain setup -->
  <mbean code="org.jboss.security.plugins.JaasSecurityDomain"
      name="meldware.mail:service=JaasSecurityDomain,name=Mail+SSL">
    <constructor>
       <arg type="java.lang.String" value="Mail+SSL"/>
    </constructor>
    <attribute name="KeyStoreURL">@deploy.dir@/mail.ear/meldware.store</attribute>
    <attribute name="KeyStorePass">mmrulez123</attribute>
  </mbean>

<!-- if($MAIL_LIST_ENABLED.equals("true")) -->
  <mbean code="org.buni.meldware.mail.maillist.hn.HnMailListManager"
         name="meldware.mail:type=MailServices,name=MailListManager">
  </mbean>
<!-- end -->


<!--
 Queue for messages meant for a mail list hosted by this server
-->
  <mbean code="org.jboss.mq.server.jmx.Queue"
         name="jboss.mq.destination:service=Queue,name=maillist">
    <depends optional-attribute-name="DestinationManager">jboss.mq:service=DestinationManager</depends>
  </mbean>

<!--
 Queue for messages which will be delivered to users in a domain served by this
 server. (local users with an account here)
-->
  <mbean code="org.jboss.mq.server.jmx.Queue"
         name="jboss.mq.destination:service=Queue,name=localMail">
    <depends optional-attribute-name="DestinationManager">jboss.mq:service=DestinationManager</depends>
  </mbean>
  
  <mbean code="org.jboss.mq.server.jmx.Queue"
         name="jboss.mq.destination:service=Queue,name=remoteMail">
    <depends optional-attribute-name="DestinationManager">jboss.mq:service=DestinationManager</depends>
  </mbean>
  
<!--
 Local domain group.  The server will try to deliver any message to any user
with the exact string in the @ clause locally.  
-->
  <mbean code="org.buni.meldware.mail.domaingroup.DomainGroup"
    interface="org.buni.meldware.mail.domaingroup.DomainGroupMBean"
    name="meldware.mail:type=DomainGroup,name=DomainGroup,group=Local">
     <attribute name="Postmaster">postmaster@takeaway.seam</attribute>
     <attribute name="Domains">
        <domains includes-local-interfaces="true">
          <domain>takeaway.seam</domain>
        </domains>
     </attribute>
  </mbean>



  <mbean code="org.buni.meldware.mail.userrepository.jaas.JaasUserRepository"
    interface="org.buni.meldware.mail.userrepository.jaas.JaasUserRepositoryMBean"
    name="meldware.mail:type=UserRepository,name=UserRepository">
    <depends>jboss.security:service=JaasSecurityManager</depends>
    <depends>meldware.mail:type=SecurityConfig,name=LoginConfig</depends>
        <attribute name="SecurityDomain">meldware</attribute>
  </mbean>

   <mbean code="org.jboss.security.auth.login.DynamicLoginConfig"
      name="meldware.mail:type=SecurityConfig,name=APOPLoginConfig">
      <attribute name="PolicyConfig" serialDataType="jbxb">
         <jaas:policy
            xsi:schemaLocation="urn:jboss:security-config:4.1 resource:security-config_4_1.xsd"
            xmlns:jaas="urn:jboss:security-config:4.1"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            >
            <jaas:application-policy name="meldware-apop">
               <jaas:authentication>
                <jaas:login-module code="org.jboss.security.auth.spi.DatabaseServerLoginModule"
                    flag="required">
                        <jaas:module-option name="dsJndiName">java:/DefaultDS</jaas:module-option>
                        <jaas:module-option name="principalsQuery">SELECT PASSWORD FROM MAIL_USERS WHERE USER_NAME=?</jaas:module-option>
                        <jaas:module-option name="rolesQuery">SELECT ROLE_NAME, 'Roles' FROM MAIL_ROLES WHERE USER_NAME=?</jaas:module-option>
                        <jaas:module-option name="unauthenticatedIdentity">guest</jaas:module-option>
                         <jaas:module-option name="callback.option.serviceName">meldware.mail:type=UserRepository,name=APOPUserRepository</jaas:module-option>
                         <jaas:module-option name="storeDigestCallback">org.buni.meldware.mail.userrepository.jaas.ApopDigestCallback</jaas:module-option>
                         <jaas:module-option name="hashUserPassword">false</jaas:module-option>
                         <jaas:module-option name="hashStorePassword">true</jaas:module-option>
                         <jaas:module-option name="hashAlgorithm">MD5</jaas:module-option>
                         <jaas:module-option name="hashEncoding">HEX</jaas:module-option>
                 </jaas:login-module>
               </jaas:authentication>
            </jaas:application-policy>
         </jaas:policy>
      </attribute>
      <depends optional-attribute-name="LoginConfigService">
         jboss.security:service=XMLLoginConfig
      </depends>
      <depends optional-attribute-name="SecurityManagerService">
         jboss.security:service=JaasSecurityManager
      </depends>
      <!-- prevent startup before the tables are created -->
      <depends>meldware.mail:type=MailServices,name=UserEditor</depends>
   </mbean>


  <mbean code="org.buni.meldware.mail.userrepository.jaas.JaasUserRepository"
    name="meldware.mail:type=UserRepository,name=APOPUserRepository">
    <depends>jboss.security:service=JaasSecurityManager</depends>
    <depends>meldware.mail:type=SecurityConfig,name=APOPLoginConfig</depends>
        <attribute name="SecurityDomain">meldware-apop</attribute>
  </mbean>
 
	<!-- 
		Hibernate based store that uses a Paging mechanism 
		to achieve partial I/O across a range of databases
	-->
	<mbean code="org.buni.meldware.mail.store.paged.PagedStore"
		name="meldware.mail:type=MailServices,name=PagedStore">
		<attribute name="PageSize">65535</attribute>
		<attribute name="Compress">false</attribute>
		<attribute name="CompressBufferSize">65535</attribute>
		<attribute name="StartIndex">0</attribute>
		<attribute name="Hashed">false</attribute>
	</mbean>

	
	
  
  	<!-- Mail Body Manager -->
  	<mbean code="org.buni.meldware.mail.message.MailBodyManagerImpl"
  	       interface="org.buni.meldware.mail.message.MailBodyManager"
  		name="meldware.mail:type=MailBodyManager,name=MailBodyManager">
  		<depends optional-attribute-name="Store" 
  			proxy-type="attribute">meldware.mail:type=MailServices,name=PagedStore</depends>
  	</mbean>
  
  <mbean code="org.buni.meldware.mail.mailbox.MailboxServiceImpl"
         interface="org.buni.meldware.mail.mailbox.MailboxService"
         name="meldware.mail:type=MailboxManager,name=MailboxManager">
      <depends optional-attribute-name="BodyManager"
               proxy-type="attribute">meldware.mail:type=MailBodyManager,name=MailBodyManager</depends>
      <attribute name="Hacks">hsqldb</attribute>
  </mbean>

  <!--
   JMS is used to asynchronously process mails, however the bodies are not stored via JMS as JBossMQ, the present
   JBosss messaging solution, doesn't do this efficiently.  This instance is to support nukes mail list integration.
   -->	


  <!--
   This JMS mail listener is used to pass things to the mail list processing plugins (MDBs). 
   -->
  <mbean code="org.buni.meldware.mail.maillistener.MailListJMSMailListener"
    name="meldware.mail:type=MailServices,name=MailListJMSListener">
    <attribute name="ConnectionFactoryName">java:/JmsXA</attribute>
    <attribute name="DestinationType">queue</attribute>
    <attribute name="Destination">maillist</attribute>
    <depends>jboss.mq:service=DestinationManager</depends>
    <depends>jboss.mq.destination:name=maillist,service=Queue</depends>
    <depends optional-attribute-name="MailListManager">meldware.mail:type=MailServices,name=MailListManager</depends>
  </mbean> 


  
  <!--
   JMS is used to asynchronously process mails, however the bodies are not stored via JMS as JBossMQ, the present
   JBosss messaging solution, doesn't do this efficiently.  This is used for normal mail processing.
   -->	
  <mbean code="org.buni.meldware.mail.maillistener.JMSMailListener"
    name="meldware.mail:type=MailServices,name=MailListener">
    <constructor>
        <arg type="java.lang.String" value="java:/JmsXA"/>
        <arg type="boolean" value="true"/>
    </constructor>

    <!--<depends>jboss.mq:service=DestinationManager</depends>-->
    <depends>jboss.jca:service=ManagedConnectionFactory,name=JmsXA</depends>
    <depends>jboss.mq.destination:name=localMail,service=Queue</depends>
    <depends>jboss.mq.destination:name=remoteMail,service=Queue</depends>
    <depends optional-attribute-name="DomainGroup">meldware.mail:type=DomainGroup,name=DomainGroup,group=Local</depends>
     <!-- queue or topic -->
     <!--<attribute name="DestinationType">queue</attribute>-->
     <!-- posts which are OnServer meaning they are for our domain and presumably a "local" user
          and won't go through an additional SMTP server should be sent here -->
     <attribute name="OnServerPostDestination">queue/localMail</attribute>
     <!-- posts which are OffServer meaning they will go through an additional SMTP server before
          finally being received should go here -->
     <attribute name="OffServerPostDestination">queue/remoteMail</attribute>
     <!-- Specifies the retry policy for failed local mail recipients. You can add as many retryTime
          elements as you like. Each retryTime element specifies the time in seconds to wait before 
          redelivery, and they are processed from the top. Once you run out of retry entries a bounce 
          message is generated for the sender. In the configuration shown below, if a message fails
             it will retry after a minute, if the retry fails
             it will retry again after a further two minutes, if the retry fails
             it will retry after after a further ten minutes, if the retry fails
             it will retry after after a further hour, if the retry fails
             it will retry after after a further hour, if the retry fails
             it will generate a bounce message
      -->                     
     <attribute name="LocalRetryTimes">
        <localRetryTimes>
           <retryTime>60</retryTime>
           <retryTime>120</retryTime>
           <retryTime>600</retryTime>
           <retryTime>3600</retryTime>
           <retryTime>3600</retryTime>
        </localRetryTimes>
     </attribute>
     <!-- Specifies the retry policy for failed remote mail recipients. You can add as many retryTime
          elements as you like. Each retryTime element specifies the time in seconds to wait before 
          redelivery, and they are processed from the top. Once you run out of retry entries a bounce 
          message is generated for the sender. In the configuration shown below, if a message fails
             it will retry after a minute, if the retry fails
             it will retry again after a further two minutes, if the retry fails
             it will retry after after a further ten minutes, if the retry fails
             it will retry after after a further hour, if the retry fails
             it will retry after after a further hour, if the retry fails
             it will generate a bounce message
     -->                     
     <attribute name="RemoteRetryTimes">
        <remoteRetryTimes>
           <retryTime>60</retryTime>
           <retryTime>120</retryTime>
           <retryTime>600</retryTime>
           <retryTime>3600</retryTime>
           <retryTime>3600</retryTime>
        </remoteRetryTimes>
      </attribute>
  </mbean> 
  
  <mbean code="org.buni.meldware.mail.MailListenerChainService"
         interface="org.buni.meldware.mail.MailListenerChain"
       name="meldware.mail:type=MailListenerChain,name=MailListenerChain">
<!-- xmbean-dd="META-INF/chain-xmbean.xml"-->
       <depends>meldware.mail:type=MailServices,name=MailListener</depends>
       <attribute name="Listeners">
            <listeners>
                 <!-- Uncomment to allow replies to go to Nukes
                     <value>meldware.mail:type=MailServices,name=NukesPosterJMSListener</value>
                 -->
                 <listener>meldware.mail:type=MailServices,name=MailListener</listener>
            </listeners>
       </attribute>          
  </mbean>

  <!--
  	Mail Listener responsible for delivering mails to local mailboxes.
  -->
  <mbean code="org.buni.meldware.mail.mailhandler.localmailbox.LocalDelivery"
	name="meldware.mail:type=MailServices,name=LocalDelivery">
 	<depends optional-attribute-name="MailboxManager"
 	  proxy-type="attribute">meldware.mail:type=MailboxManager,name=MailboxManager</depends>
 	<depends optional-attribute-name="Router"
 	  proxy-type="org.buni.meldware.mail.MailListener">meldware.mail:type=MailServices,name=MailListener</depends>
 	<attribute name="ParseMime">true</attribute>
  </mbean>
  
  <!--
  	Mail Listener chain for mails to be delivered locally.
  	Any listeners that are specific to locally delivered mail should be
  	added here.  E.g. SPAM filtering.
  -->
  <mbean code="org.buni.meldware.mail.MailListenerChainService"
    name="meldware.mail:type=MailListenerChain,name=LocalDeliveryChain" xmbean-dd="META-INF/chain-xmbean.xml">
    <depends>meldware.mail:type=MailServices,name=LocalDelivery</depends>
    <attribute name="Listeners">
      <listeners>
        <listener>meldware.mail:type=MailServices,name=MailListJMSListener</listener>
        <listener>meldware.mail:type=MailServices,name=LocalDelivery</listener>
      </listeners>
    </attribute>          
  </mbean>


<!--
 The SMTPSender MBean is used to send mails to remote hosts.  It also maintains
 the DNS server list.
-->
  <mbean code="org.buni.meldware.mail.smtp.sender.SMTPSender"
    name="meldware.mail:type=MailServices,name=SMTPSender">
     <!-- if no servers then uses the default DNS servers from the host's resolution path. -->
    <depends optional-attribute-name="MailBodyManager" 
    	     proxy-type="attribute">meldware.mail:type=MailBodyManager,name=MailBodyManager</depends>
     <attribute name="AllowAddressLookups">true</attribute>
  </mbean>


  <!--
  	Mail Listener responsible for delivering mails to remote addresses.
  -->
  <mbean code="org.buni.meldware.mail.mailhandler.remote.RemoteDelivery"
	name="meldware.mail:type=MailServices,name=RemoteDelivery">
 	<depends optional-attribute-name="Router"
 	  proxy-type="org.buni.meldware.mail.MailListener">meldware.mail:type=MailServices,name=MailListener</depends>
    <depends optional-attribute-name="DomainGroup"
      proxy-type="attribute">meldware.mail:type=DomainGroup,name=DomainGroup,group=Local</depends>
 	<depends optional-attribute-name="Sender"
 	  proxy-type="attribute">meldware.mail:type=MailServices,name=SMTPSender</depends>
  </mbean>
  
  <!--
  	Mail Listener chain for mails to be delivered remotely.
  -->
  <mbean code="org.buni.meldware.mail.MailListenerChainService"
    name="meldware.mail:type=MailListenerChain,name=RemoteDeliveryChain" xmbean-dd="META-INF/chain-xmbean.xml">
    <depends>meldware.mail:type=MailServices,name=RemoteDelivery</depends>
    <attribute name="Listeners">
      <listeners>
        <listener>meldware.mail:type=MailServices,name=RemoteDelivery</listener>
      </listeners>
    </attribute>
  </mbean>

  <mbean code="org.buni.meldware.mail.MailListenerChainService"
    name="meldware.mail:type=MailListenerChain,name=ListDeliveryChain" xmbean-dd="META-INF/chain-xmbean.xml">
    <depends>meldware.mail:type=MailServices,name=ListDelivery</depends>
    <attribute name="Listeners">
      <listeners>
        <listener>meldware.mail:type=MailServices,name=ListDelivery</listener>
        <listener>meldware.mail:type=MailServices,name=LocalDelivery</listener>
      </listeners>
    </attribute>
  </mbean>

  <mbean code="org.buni.meldware.mail.maillistener.MailListDelivery" interface="org.buni.meldware.mail.maillistener.MailListDeliveryMBean"
	name="meldware.mail:type=MailServices,name=ListDelivery">
    <depends optional-attribute-name="MailListManager"
      proxy-type="attribute">meldware.mail:type=MailServices,name=MailListManager</depends>
    <depends optional-attribute-name="DeliveryChain"
      proxy-type="attribute">meldware.mail:type=MailListenerChain,name=MailListenerChain</depends>
  </mbean>

  <!--
    SMTPProtocol is used for a "Server" instance.  This is an unencrypted 
    protocol 
  -->
  <mbean code="org.buni.meldware.mail.smtp.SMTPProtocol"
    name="meldware.mail:type=Protocol,name=SMTPProtocol">
    
    <depends optional-attribute-name="DomainGroup"
    		 proxy-type="attribute">meldware.mail:type=DomainGroup,name=DomainGroup,group=Local</depends>
    <depends optional-attribute-name="MailBodyManager" 
    	     proxy-type="attribute">meldware.mail:type=MailBodyManager,name=MailBodyManager</depends>
    <depends optional-attribute-name="ListenerChain" 
             proxy-type="org.buni.meldware.mail.MailListenerChain">meldware.mail:type=MailListenerChain,name=MailListenerChain</depends>
  	<depends optional-attribute-name="UserRepository"
  			 proxy-type="attribute">meldware.mail:type=UserRepository,name=UserRepository</depends>
  			 
    <depends>meldware.mail:service=JaasSecurityDomain,name=Mail+SSL</depends>-->
    <attribute name="SslDomain">java:/jaas/Mail+SSL</attribute>
 <!--register the protocols you want to use -->
    <attribute name="Servername"></attribute>	
    <!-- 
      auth-required - optional, default = true:  Determines whether we require the
      user to login to the SMTP server in order to send the mail.  By default we
      do require it.  I'd rather folks say that JBMail doesn't work at all than
      say its an open relay....if YOU misconfigure it you CAN make it an open
      relay....Its going to warn you in big bold fat letters.  This is only 
      required to send mail to some SMTP server outside of your domain 
    -->
    <attribute name="AuthRequired">true</attribute>
    <!--
      JBMail can not be configured as an open relay, you must specify a list of domains
      to allow relaying to.
    -->
    <attribute name="RelayByDomain">false</attribute>
    <!--
      auth-allowed means that users are allowed to login.  This is othogonal to AuthRequired.
      Where AuthRequired means "auth required in order to send mail", AuthAllowed means 
      "is anyone able to log in at all?"  A completely open relay (spam machine) would not 
      require authenticaiton and might not even allow it (so it can't be tracked or whatever).  
      One reason to FORBID authentication is if you want users to only authenticate over SSL but 
      want a seperate instance of SMTP (on the same box even) to receive mails from the outside for
      local users.
    -->
    <attribute name="AuthAllowed">true</attribute>
    <!-- 
      auth methods allowed.  DO NOT CHANGE THIS (unless you really know what 
      you are doing and have a very good reason to)
    -->
    <attribute name="AuthMethods">AUTH LOGIN PLAIN</attribute>
  		
    <!-- verify the identity -->
    <attribute name="VerifyIdentity">false</attribute>
    <attribute name="MaxMessageSize">10000000</attribute>
    <!-- block size for messages (should be about your average message size)   -->
    <attribute name="BlockSize">4096</attribute>
    <!-- rfc 2487 related properties -->
    <attribute name="RequireTls">false</attribute>
    <attribute name="RequireTlsForAuth">false</attribute>
    <attribute name="RequireClientCert">false</attribute> 
    <!-- change to true for TLS support -->
    <attribute name="TlsEnabled">false</attribute>                  
    <attribute name="Postmaster">postmaster@takeaway.seam</attribute>  
    <!-- 
      The maximum number of received headers allowed (to avoid looping). 
      If greater than this the message is not accepted. Default is 100 if not present
    -->
    <attribute name="MaxReceivedHdrs">100</attribute>  
    <!-- 
      The number of received headers before we start inspecting them looking
      for our server to see if more than maxOwnReceivedHdrs are present
      Default is 20 if not present 
    -->
    <attribute name="ReceivedHdrsThreshold">20</attribute>  
    <!--
      The number of received headers for our server allowed.
      Default is 5 if not present
    -->
    <attribute name="MaxOwnReceivedHdrs">5</attribute>
  </mbean> 

  <mbean code="org.buni.meldware.mail.ThreadPool"
    interface="org.buni.meldware.mail.ThreadPoolMBean" 
         name="meldware.mail:type=ThreadPool,name=ThreadPoolSMTP">
         <attribute name="Initial">5</attribute>
         <attribute name="Min">5</attribute>
         <attribute name="Max">100</attribute>
         <attribute name="IdleKeepAlive">120000</attribute>
  </mbean>

  <!-- defines an SMTP server.  -->
  <mbean code="org.buni.meldware.mail.Server"
    name="meldware.mail:type=Service,name=SMTP">
    <depends optional-attribute-name="Protocol">meldware.mail:type=Protocol,name=SMTPProtocol</depends>
    <depends optional-attribute-name="ThreadPool"
             proxy-type="attribute">meldware.mail:type=ThreadPool,name=ThreadPoolSMTP</depends>
      <!-- protocol should reference SMTP -->
     <!-- port to listen on -->
     <attribute name="Port">2525</attribute>
     <!-- which addresses to listen on 0.0.0.0 = all or localhost means only the localhost  -->
     <attribute name="Address">0.0.0.0</attribute>
     <!-- timeout between commands (not presently supported) -->
     <!-- note from mikea: rfc 821 sets strict guidelines on allowable timeouts -->
     <attribute name="Timeout">30000</attribute>
     <!-- timeout for the connection regardless of whether it is finished.  Thus it will kill the
          socket and thread mid-stream/operation.  This should be big enough to allow whatever the
          messages you're sending while defending against folks who might try to DoS your server 
          by keeping a large number of connections alive -->
     <!-- note from mikea: 10 mb in 120 seconds is about 100 kb/s - which may or may not be 
          the actual bandwidth achieved depending on server. therefore, i believe this value should 
	  be set somewhat higher to avoid timing out on 10mb emails, 
	  and other methods be used to detect DoS's -->
     <attribute name="Life">120000</attribute>
  </mbean> 




  <mbean code="org.buni.meldware.mail.ThreadPool"
    interface="org.buni.meldware.mail.ThreadPoolMBean" 
         name="meldware.mail:type=ThreadPool,name=ThreadPoolPOP">
         <attribute name="Initial">5</attribute>
         <attribute name="Min">5</attribute>
         <attribute name="Max">10</attribute>
         <attribute name="IdleKeepAlive">120000</attribute>
  </mbean>

  <mbean code="org.buni.meldware.mail.pop3.POP3Protocol"
    name="meldware.mail:type=Protocol,name=POP3Protocol">
   		<depends>meldware.mail:service=JaasSecurityDomain,name=Mail+SSL</depends>
   		<attribute name="SslDomain">java:/jaas/Mail+SSL</attribute>
    <depends>meldware.mail:type=MailServices,name=MailListener</depends>
    <depends optional-attribute-name="MailboxManager" 
    	proxy-type="attribute">meldware.mail:type=MailboxManager,name=MailboxManager</depends>
   	<depends optional-attribute-name="UserRepository"
   			 proxy-type="attribute">meldware.mail:type=UserRepository,name=UserRepository</depends>
   	<depends optional-attribute-name="APOPUserRepository"
   			 proxy-type="attribute">meldware.mail:type=UserRepository,name=APOPUserRepository</depends>
 	<!--register the protocols you want to use -->
  	<attribute name="Servername"></attribute>
  	<attribute name="TlsEnabled">false</attribute>       
        <attribute name="RequireTls">false</attribute>
        <!-- enable for forcing clients to use their own certificats -->
  	<attribute name="RequireClientCert">false</attribute> 
  </mbean>

  

  <!-- defines a POP server. -->
  <mbean code="org.buni.meldware.mail.Server"
    name="meldware.mail:type=Service,name=POP3">
    <depends>meldware.mail:type=Protocol,name=POP3Protocol</depends>
    <depends optional-attribute-name="ThreadPool"
             proxy-type="attribute">meldware.mail:type=ThreadPool,name=ThreadPoolPOP</depends>
     <!-- options are presently POP or SMTP, we want POP -->
     <attribute name="Protocol">meldware.mail:type=Protocol,name=POP3Protocol</attribute>
     <!-- port to listen on -->
     <attribute name="Port">11011</attribute>
     <!-- which addresses to listen on 0.0.0.0 = all or localhost means only the localhost  -->
     <attribute name="Address">0.0.0.0</attribute>
     <!-- timeout between commands (not presently supported) -->
     <attribute name="Timeout">30000</attribute>
     <!-- timeout for the connection regardless of whether it is finished.  Thus it will kill the
          socket and thread mid-stream/operation.  This should be big enough to allow whatever the
          messages you're sending while defending against folks who might try to DoS your server 
          by keeping a large number of connections alive -->
     <attribute name="Life">120000</attribute>
     <attribute name="UsesSSL">false</attribute>
  </mbean>


<!-- fetchmail example see http://wiki.jboss.org/wiki/Wiki.jsp?page=HowToConfigurePOPFetchmailForJBossMailServer1.0M4 for details
   <mbean code="org.buni.meldware.mail.fetchmail.Popper"
        name="meldware.mail:type=Fetchmail,name=Popper,instance=example">       must be unique 
        <attribute name="Servername">foo.nowhere.com</attribute>
        <attribute name="PopPort">110</attribute>
        <attribute name="PopUser">remoteuser</attribute>
        <attribute name="Password">mypassword</attribute>
        <attribute name="LocalUser">andy@localhost</attribute>
        <attribute name="DeleteAfterPop">false</attribute>
        <depends optional-attribute-name="SMTPProtocol"
                 proxy-type="org.buni.meldware.mail.smtp.SMTPProtocolMBean">meldware.mail:type=Protocol,name=SMTPProtocol</depends>
        </mbean>

<mbean code="org.jboss.varia.scheduler.Scheduler"
         name="meldware.mail:service=Scheduler,name=Popper,instance=example">     unique 
    <attribute name="StartAtStartup">true</attribute>
this needs to match your Popper instance's mbean name
    <attribute name="SchedulableMBean">meldware.mail:type=Fetchmail,name=Popper,instance=example</attribute>
    <attribute name="SchedulableMBeanMethod">pop()</attribute>
    <attribute name="InitialStartDate">NOW</attribute>
    <attribute name="SchedulePeriod">10000</attribute>
    <attribute name="InitialRepetitions">-1</attribute>
  </mbean>
-->

  <mbean code="org.buni.meldware.mail.imap4.IMAP4Protocol"
    name="meldware.mail:type=Protocol,name=IMAP4Protocol">
    <depends>meldware.mail:type=MailServices,name=MailListener</depends>
    <depends optional-attribute-name="MailboxManager" 
    	proxy-type="attribute">meldware.mail:type=MailboxManager,name=MailboxManager</depends>
   	<depends optional-attribute-name="UserRepository"
   			 proxy-type="attribute">meldware.mail:type=UserRepository,name=UserRepository</depends>
  	<attribute name="Servername"></attribute>
  </mbean>

  <mbean code="org.buni.meldware.mail.Server"
    name="meldware.mail:type=Service,name=IMAP">
    <depends>meldware.mail:type=Protocol,name=IMAP4Protocol</depends>
    <depends optional-attribute-name="ThreadPool"
             proxy-type="attribute">meldware.mail:type=ThreadPool,name=ThreadPoolPOP</depends>
     <attribute name="Protocol">meldware.mail:type=Protocol,name=IMAP4Protocol</attribute>
     <attribute name="Port">14343</attribute>
     <attribute name="Address">0.0.0.0</attribute>
     <!-- Default idle timeout 30 minutes -->
     <attribute name="Timeout">1800000</attribute>
     <!-- Default life timeout 60 minutes -->
     <attribute name="Life">3600000</attribute>
     <!-- 
     	Note that setting the life timeout is not spec compliant and can cause
        some problems with Novell Evolution.  To make the system spec compliant 
        set this value to something really large e.g. 31536000000 (1 year).
        We default this to 1 hour to try an help prevent DoS attacks.
     --> 
  </mbean> 

  <mbean code="org.buni.meldware.mail.userapi.MailSenderImpl"
         interface="org.buni.meldware.mail.userapi.MailSender"
         name="meldware.mail:type=MailServices,name=MailSender" >
      <depends optional-attribute-name="ListenerChain"
               proxy-type="attribute">meldware.mail:type=MailListenerChain,name=MailListenerChain</depends>
      <depends optional-attribute-name="BodyManager"
               proxy-type="attribute">meldware.mail:type=MailBodyManager,name=MailBodyManager</depends>
      <depends optional-attribute-name="MailboxManager"
               proxy-type="attribute">meldware.mail:type=MailboxManager,name=MailboxManager</depends>
  </mbean>

<!--
  <mbean code="org.buni.meldware.mail.usereditor.db.DBUserEditorImpl" interface="org.buni.meldware.mail.usereditor.db.UserEditor" name="meldware.mail:type=MailServices,name=UserEditor" xmbean-dd="META-INF/DBUserEditor-xmbean.xml">
         <depends optional-attribute-name="DataSource" proxy-type="attribute">jboss.jca:service=DataSourceBinding,name=DefaultDS</depends>
         <attribute name="CreateUserTableSQL">CREATE TABLE MAIL_USERS (USER_NAME VARCHAR(40) NOT NULL, PASSWORD VARCHAR(40) NOT NULL)</attribute>
         <attribute name="CreateRoleTableSQL">CREATE TABLE MAIL_ROLES (USER_NAME VARCHAR(40) NOT NULL, ROLE_NAME VARCHAR(40) NOT NULL)</attribute>
         <attribute name="AddUserSQL">INSERT INTO MAIL_USERS VALUES(?,?)</attribute>
         <attribute name="AddRoleSQL">INSERT INTO MAIL_ROLES VALUES(?,?)</attribute>
         <attribute name="DeleteUserSQL">DELETE FROM MAIL_USERS WHERE USER_NAME = ?</attribute>
         <attribute name="DeleteRoleSQL">DELETE FROM MAIL_ROLES WHERE USER_NAME = ? AND ROLE_NAME = ?</attribute>
         <attribute name="UserRolesSQL">SELECT ROLE_NAME FROM MAIL_ROLES WHERE USER_NAME = ?</attribute>
         <attribute name="UsersSQL">SELECT USER_NAME FROM MAIL_USERS WHERE USER_NAME LIKE ?</attribute>
         <attribute name="UpdatePasswordSQL">UPDATE MAIL_USERS SET PASSWORD = ? WHERE USER_NAME = ?</attribute>
  </mbean>
-->

  <mbean code="org.buni.meldware.mail.management.DumDOMImpl" interface="org.buni.meldware.mail.management.DumDOM" name="meldware.mail:type=MailServices,name=DumDOM">
         <attribute name="DeploymentURL">@deploy.dir@/mail.ear</attribute>
         <attribute name="ConfigFile">@deploy.dir@/mail.ear/mailjmx.sar/META-INF/jboss-service.xml</attribute>
  </mbean>

  <mbean code="org.buni.meldware.mail.management.AdminToolImpl" interface="org.buni.meldware.mail.management.AdminTool"
         name="meldware.mail:type=MailServices,name=AdminTool">
         <depends optional-attribute-name="DumDOM" proxy-type="attribute">meldware.mail:type=MailServices,name=DumDOM</depends>
         <depends optional-attribute-name="UserEditor"
                  proxy-type="attribute">meldware.mail:type=MailServices,name=UserEditor</depends>
  </mbean>


<!--
  <mbean code="org.buni.meldware.mail.management.DumDOMImpl"
         name="meldware.mail:type=MailServices,name=DumDOM" xmbean-dd="META-INF/DumDOM-xmbean.xml">
         <attribute name="DeploymentURL"></attribute>
         <attribute name="ConfigFile"></attribute>
  </mbean>
-->
</server>
