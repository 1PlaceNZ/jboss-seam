<chapter id="i18n">
    <title>Internationalization and themes</title>
    <para>
        Seam makes it easy to build internationalized applications by
        providing several built-in components for handling multi-language
        UI messages.
    </para>
    
    <section>
        <title>Locales</title>
        <para>
            Each user login session has an associated instance of
            <literal>java.util.Locale</literal> (available to the 
            application as a session-scoped component named 
            <literal>locale</literal>). Under normal circumstances,
            you won't need to do any special configuration to set
            the locale. Seam just delegates to JSF to determine
            the active locale:
        </para>
        
        <itemizedlist>
            <listitem>
                If there is a locale associated with the HTTP request
                (the browser locale), and that locale is in the list
                of supported locales from <literal>faces-config.xml</literal>, 
                use that locale for the rest of the session.
            </listitem>
            <listitem>
                Otherwise, if a default locale was specified in the
                <literal>faces-config.xml</literal>, use that locale 
                for the rest of the session.
            </listitem>
            <listitem>
                Otherwise, use the default locale of the server.
            </listitem>
        </itemizedlist>
        
        <para>
            It is <emphasis>possible</emphasis> to set the locale
            manually via the Seam configuration properties
            <literal>org.jboss.seam.core.localeSelector.language</literal>,
            <literal>org.jboss.seam.core.localeSelector.country</literal> and
            <literal>org.jboss.seam.core.localeSelector.variant</literal>, but 
            we can't think of any good reason to ever do this.
        </para>
        
        <para>
            It is, however, useful to allow the user to set the
            locale manually via the application user interface.
            Seam provides built-in functionality for overriding
            the locale determined by the algorithm above. All
            you have to do is add the following fragment to a 
            form in your JSP or Facelets page:
        </para>
        
        <programlisting><![CDATA[<h:selectOneMenu value="#{localeSelector.language}">
    <f:selectItem itemLabel="English" itemValue="en"/>
    <f:selectItem itemLabel="Deutsch" itemValue="de"/>
    <f:selectItem itemLabel="Francais" itemValue="fr"/>
</h:selectOneMenu>
<h:commandButton action="#{localeSelector.select}" value="#{messages['ChangeLanguage']}"/>]]></programlisting>

        <para>
            Or, if you want a list of all supported locales from 
            <literal>faces-config.xml</literal>, just use:
        </para>

        <programlisting><![CDATA[<h:selectOneMenu value="#{localeSelector.localeString}">
    <f:selectItems value="#{localeSelector.supportedLocales}"/>
</h:selectOneMenu>
<h:commandButton action="#{localeSelector.select}" value="#{messages['ChangeLanguage']}"/>]]></programlisting>

        <para>
            When this use selects an item from the drop-down, and 
            clicks the button, the Seam and JSF locales will be 
            overridden for the rest of the session.
        </para>
        
    </section>
    
    <section>
        <title>Labels</title>
        <para>
            JSF supports internationalization of user interface labels and
            descriptive text via the use of <literal>&lt;f:loadBundle /&gt;</literal>.
            You can use this approach in Seam applications. Alternatively, you can
            take advantage of the Seam <literal>messages</literal> component to 
            display templated labels with embedded EL expressions.
        </para>
        
    <section>
        <title>Defining labels</title>
        <para>
            Each login session has an associated instance of 
            <literal>java.util.ResourceBundle</literal> (available to the 
            application as a session-scoped component named 
            <literal>org.jboss.seam.core.resourceBundle</literal>). You'll need to 
            make your internationalized labels available via this special resource 
            bundle. By default, the resource bundle used by Seam is named 
            <literal>messages</literal> and so you'll need to define your labels 
            in files named <literal>messages.properties</literal>, 
            <literal>messages_en.properties</literal>,
            <literal>messages_en_AU.properties</literal>, etc. These
            files usually belong in the <literal>WEB-INF/classes</literal> 
            directory.
        </para>
        
        <para>
            So, in <literal>messages_en.properties</literal>:
        </para>
        
        <programlisting><![CDATA[Hello=Hello]]></programlisting>

        <para>
            And in <literal>messages_en_AU.properties</literal>:
        </para>
        
        <programlisting><![CDATA[Hello=G'day]]></programlisting>
        
        <para>
            You can select a different name for the resource bundle by setting
            the Seam configuration property named
            <literal>org.jboss.seam.core.resourceBundle.bundleNames</literal>. You can even specify
            a list of resource bundle names to be searched (depth first) for
            messages.
        </para>

        <programlisting><![CDATA[<component name="org.jboss.seam.core.resourceBundle">
    <property name="bundlenames">
        <value>mycompany_messages</value>
        <value>standard_messages</value>
    </property>
</component>]]></programlisting>

        <para>
            If you want to define a message just for a particular page, you
            can specify it in a resource bundle with the same name as the
            JSF view id, with the leading <literal>/</literal> and trailing
            file extension removed. So we could put our message in 
            <literal>welcome/hello_en.properties</literal> if we only needed
            to display the message on <literal>/welcome/hello.jsp</literal>.
        </para>
        
        <para>
            You can even specify an explicit bundle name in <literal>pages.xml</literal>:
        </para>
        
        <programlisting><![CDATA[<page view-id="/welcome/hello.jsp" bundle="HelloMessages"/>]]></programlisting>
        
        <para>
            Then we could use messages defined in <literal>HelloMessages.properties</literal>
            on <literal>/welcome/hello.jsp</literal>.
        </para>
    </section>
    
    <section>
        <title>Displaying labels</title>

        <para>
            If you define your labels using the Seam resource bundle, you'll
            be able to use them without having to type <literal>&lt;f:loadBundle ... /&gt;</literal>
            on every page. Instead, you can simply type:
        </para>
        
        <programlisting><![CDATA[<h:outputText value="#{messages['Hello']}"/>]]></programlisting>
        
        <para>
            or:
        </para>
        
        <programlisting><![CDATA[<h:outputText value="#{messages.Hello}"/>]]></programlisting>
        
        <para>
            Even better, the messages themselves may contain EL expressions:
        </para>

        <programlisting><![CDATA[Hello=Hello, #{user.firstName} #{user.lastName}]]></programlisting>
        <programlisting><![CDATA[Hello=G'day, #{user.firstName}]]></programlisting>
        
        <para>
            You can even use the messages in your code:
        </para>

        <programlisting><![CDATA[@In private Map<String, String> messages;]]></programlisting>
        <programlisting><![CDATA[@In("#{messages['Hello']}") private String helloMessage;]]></programlisting>

    </section>
    
    <section>
        <title>Faces messages</title>
        <para>
            The <literal>facesMessages</literal> component is a super-convenient 
            way to display success or failure messages to the user. The functionality 
            we just described also works for faces messages:
        </para>

        <programlisting><![CDATA[@Name("hello")
@Stateless
public class HelloBean implements Hello {
    @In FacesMessages facesMessages;
    
    public String sayIt() {
        facesMessages.addFromResourceBundle("Hello");
    }
}]]></programlisting>

        <para>
            This will display <literal>Hello, Gavin King</literal> or <literal>G'day, Gavin</literal>,
            depending upon the user's locale.
        </para>

    </section>
    </section>
    
    <section>
        <title>Timezones</title>
        <para>
            There is also a session-scoped instance of <literal>java.util.Timezone</literal>,
            named <literal>org.jboss.seam.core.timezone</literal>, and a Seam component for changing 
            the timezone named <literal>org.jboss.seam.core.timezoneSelector</literal>. By default, 
            the timezone is the default timezone of the server. Unfortunately, the JSF specification 
            says that all dates and times should be assumed to be UTC, and displayed as UTC, unless 
            a timezone is explicitly specified using <literal>&lt;f:convertDateTime&gt;</literal>. 
            This is an extremely inconvenient default behavior.
        </para>
        <para>
            Seam overrides this behavior, and defaults all dates and times to the Seam timezone.
            In addition, Seam provides the <literal>&lt;s:convertDateTime&gt;</literal> tag which 
            always performs conversions in the Seam timezone.
        </para>
    </section>
    
    <section>
        <title>Themes</title>
        <para>
            Seam applications are also very easily skinnable. The theme API is very
            similar to the localization API, but of course these two concerns are
            orthogonal, and some applications support both localization and themes.
        </para>
        
        <para>
            First, configure the set of supported themes:
        </para>
        
        <programlisting><![CDATA[<component name="org.jboss.seam.theme.themeSelector">
    <property name="availableThemes">
        <value>default</value>
        <value>accessible</value>
        <value>printable</value>
    </property>
</component>]]></programlisting>
       
       <para>
            Note that the first theme listed is the default theme.
       </para>

        <para>
            Themes are defined in a properties file with the same name as the theme.
            For example, the <literal>default</literal> theme is defined as a set of
            entries in <literal>default.properties</literal>. For example, 
            <literal>default.properties</literal> might define:
        </para>
        
<programlisting><![CDATA[css ../screen.css
template template.xhtml]]></programlisting>

        <para>
            Usually the entries in a theme resource bundle will be paths to CSS styles
            or images and names of facelets templates (unlike localization resource
            bundles which are usually text).
        </para>
        
        <para>
            Now we can use these entries in our JSP or facelets pages. For example,
            to theme the stylesheet in a facelets page:
        </para>
        
        <programlisting><![CDATA[<link href="#{theme.css}" rel="stylesheet" type="text/css" />]]></programlisting>
        
        <para>
            Most powerfully, facelets lets us theme the template used by a <literal>&lt;ui:composition&gt;</literal>:
        </para>

        <programlisting><![CDATA[<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    template="#{theme.template}">]]></programlisting>
        
        <para>
            Just like the locale selector, there is a built-in theme selector to allow 
            the user to freely switch themes:
        </para>

        <programlisting><![CDATA[<h:selectOneMenu value="#{themeSelector.theme}">
    <f:selectItems value="#{themeSelector.themes}"/>
</h:selectOneMenu>
<h:commandButton action="#{themeSelector.select}" value="Select Theme"/>]]></programlisting>

    </section>
    
    <section>
        <title>Persisting locale and theme preferences via cookies</title>
        <para>
            The locale selector, theme selector and timezone selector all support 
            persistence of locale and theme preference to a cookie. Simply set the 
            <literal>cookieEnabled</literal> configuration property:
        </para>
        
        <programlisting><![CDATA[<component name="org.jboss.seam.theme.themeSelector">
    <property name="availableThemes">
        <value>default</value>
        <value>accessible</value>
        <value>printable</value>
    </property>
    <property name="cookieEnabled">true</property>
</component>

<component name="localeSelector">
    <property name="cookieEnabled">true</property>
</component>]]></programlisting>

    </section>
    
</chapter>
