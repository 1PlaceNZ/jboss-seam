<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head xmlns="http://www.w3.org/1999/xhtml">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>1.2.1.2. The stateless session bean class: RegisterAction.java</title>
    <link rel="stylesheet" href="./Common_Content/css/default.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.72.0" />
    <link rel="start" href="index.html" title="Seam - Contextual Components" />
    <link rel="up" href="ch01s02s01.html" title="1.2.1. Understanding the code" />
    <link rel="prev" href="ch01s02s01s01.html" title="1.2.1.1. The entity bean: User.java" />
    <link rel="next" href="ch01s02s01s03.html" title="1.2.1.3. The session bean local interface: Register.java" />
  </head>
  <body>
    <p xmlns="http://www.w3.org/1999/xhtml" id="title">
      <a href="http://www.redhat.com/docs">
        <strong>1.2.1.2. The stateless session bean class: <code class="literal">RegisterAction.java</code></strong>
      </a>
    </p>
    <ul xmlns="http://www.w3.org/1999/xhtml" class="docnav">
      <li class="previous">
        <a accesskey="p" href="ch01s02s01s01.html">
          <strong>Prev</strong>
        </a>
      </li>
      <li class="next">
        <a accesskey="n" href="ch01s02s01s03.html">
          <strong>Next</strong>
        </a>
      </li>
    </ul>
    <div xmlns="http://www.w3.org/1999/xhtml" class="section" lang="en-US" xml:lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h4 class="title"><a id="id2792074"></a>1.2.1.2. The stateless session bean class: <code class="literal">RegisterAction.java</code></h4>
          </div>
        </div>
      </div>
      <p>
					Most Seam application use session beans as JSF action listeners (you can use JavaBeans instead if you like).
				</p>
      <p>
					We have exactly one JSF action in our application, and one session bean method attached to it. In this case, we'll use a stateless session bean, since all the state associated with our action is held by the <code class="literal">User</code> bean.
				</p>
      <p>
					This is the only really interesting code in the example!
				</p>
      <div class="example">
        <a id="id2807007"></a>
        <div class="example-contents">
          <div class="programlistingco">
            <pre class="programlisting">@Stateless
@Name("register")
public class RegisterAction implements Register
{

   @In
   private User user;
   
   @PersistenceContext
   private EntityManager em;
   
   @Logger
   private Log log;
   
   public String register()
   {
      List existing = em.createQuery(
         "select username from User where username=#{user.username}")
         .getResultList();
         
      if (existing.size()==0)
      {
         em.persist(user);
         log.info("Registered new user #{user.username}");
         return "/registered.xhtml";
      }
      else
      {
         FacesMessages.instance().add("User #{user.username} already exists");
         return null;
      }
   }

}
</pre>
            <div class="calloutlist">
              <table border="0" summary="Callout list">
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/1.png" alt="1" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
									The EJB standard <code class="literal">@Stateless</code> annotation marks this class as stateless session bean.
								</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/2.png" alt="2" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
									The <a href="ch26s02.html#in-annotation"><code class="literal">@In</code></a> annotation marks an attribute of the bean as injected by Seam. In this case, the attribute is injected from a context variable named <code class="literal">user</code> (the instance variable name).
								</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/3.png" alt="3" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
									The EJB standard <code class="literal">@PersistenceContext</code> annotation is used to inject the EJB3 entity manager.
								</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/4.png" alt="4" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
									The Seam <code class="literal">@Logger</code> annotation is used to inject the component's <code class="literal">Log</code> instance.
								</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/5.png" alt="5" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
									The action listener method uses the standard EJB3 <code class="literal">EntityManager</code> API to interact with the database, and returns the JSF outcome. Note that, since this is a sesson bean, a transaction is automatically begun when the <code class="literal">register()</code> method is called, and committed when it completes.
								</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/6.png" alt="6" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
									Notice that Seam lets you use a JSF EL expression inside EJB-QL. Under the covers, this results in an ordinary JPA <code class="literal">setParameter()</code> call on the standard JPA <code class="literal">Query</code> object. Nice, huh?
								</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/7.png" alt="7" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
									The <code class="literal">Log</code> API lets us easily display templated log messages.
								</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/8.png" alt="8" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
									JSF action listener methods return a string-valued outcome that determines what page will be displayed next. A null outcome (or a void action listener method) redisplays the previous page. In plain JSF, it is normal to always use a JSF <span class="emphasis"><em>navigation rule</em></span> to determine the JSF view id from the outcome. For complex application this indirection is useful and a good practice. However, for very simple examples like this one, Seam lets you use the JSF view id as the outcome, eliminating the requirement for a navigation rule. <span class="emphasis"><em>Note that when you use a view id as an outcome, Seam always performs a browser redirect.</em></span>
								</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/9.png" alt="9" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
									Seam provides a number of <span class="emphasis"><em>built-in components</em></span> to help solve common problems. The <code class="literal">FacesMessages</code> component makes it easy to display templated error or success messages. Built-in Seam components may be obtained by injection, or by calling an <code class="literal">instance()</code> method.
								</p>
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <p>
						Note that we did not explicitly specify a <code class="literal">@Scope</code> this time. Each Seam component type has a default scope if not explicitly specified. For stateless session beans, the default scope is the stateless context. Actually, <span class="emphasis"><em>all</em></span> stateless session beans belong in the stateless context.
					</p>
          <p>
						Our session bean action listener performs the business and persistence logic for our mini-application. In more complex applications, we might need to layer the code and refactor persistence logic into a dedicated data access component. That's perfectly trivial to do. But notice that Seam does not force you into any particular strategy for application layering.
					</p>
          <p>
						Furthermore, notice that our session bean has simultaneous access to context associated with the web request (the form values in the <code class="literal">User</code> object, for example), and state held in transactional resources (the <code class="literal">EntityManager</code> object). This is a break from traditional J2EE architectures. Again, if you are more comfortable with the traditional J2EE layering, you can certainly implement that in a Seam application. But for many applications, it's simply not very useful.
					</p>
        </div>
        <h6 xmlns="">Example 1.2. </h6>
      </div>
      <br class="example-break" />
    </div>
    <ul xmlns="http://www.w3.org/1999/xhtml" class="docnav">
      <li class="previous">
        <a accesskey="p" href="ch01s02s01s01.html"><strong>Prev</strong>1.2.1.1. The entity bean: User.java</a>
      </li>
      <li class="up">
        <a accesskey="u" href="#">
          <strong>Up</strong>
        </a>
      </li>
      <li class="home">
        <a accesskey="h" href="index.html">
          <strong>Home</strong>
        </a>
      </li>
      <li class="next">
        <a accesskey="n" href="ch01s02s01s03.html"><strong>Next</strong>1.2.1.3. The session bean local interface: Regist...</a>
      </li>
    </ul>
  </body>
</html>
