<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head xmlns="http://www.w3.org/1999/xhtml">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>1.4.1. Understanding the code</title>
    <link rel="stylesheet" href="./Common_Content/css/default.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.72.0" />
    <link rel="start" href="index.html" title="Seam - Contextual Components" />
    <link rel="up" href="todo.html" title="1.4. Seam and jBPM: the todo list example" />
    <link rel="prev" href="todo.html" title="1.4. Seam and jBPM: the todo list example" />
    <link rel="next" href="ch01s04s02.html" title="1.4.2. How it works" />
  </head>
  <body>
    <p xmlns="http://www.w3.org/1999/xhtml" id="title">
      <a href="http://www.redhat.com/docs">
        <strong>1.4.1. Understanding the code</strong>
      </a>
    </p>
    <ul xmlns="http://www.w3.org/1999/xhtml" class="docnav">
      <li class="previous">
        <a accesskey="p" href="todo.html">
          <strong>Prev</strong>
        </a>
      </li>
      <li class="next">
        <a accesskey="n" href="ch01s04s02.html">
          <strong>Next</strong>
        </a>
      </li>
    </ul>
    <div xmlns="http://www.w3.org/1999/xhtml" class="section" lang="en-US" xml:lang="en-US">
      <div class="titlepage">
        <div>
          <div>
            <h3 class="title"><a id="id2850186"></a>1.4.1. Understanding the code</h3>
          </div>
        </div>
      </div>
      <p>
				The center of this example is the jBPM process definition. There are also two JSPs and two trivial JavaBeans (There was no reason to use session beans, since they do not access the database, or have any other transactional behavior). Let's start with the process definition:
			</p>
      <div class="example">
        <a id="id2850200"></a>
        <div class="example-contents">
          <div class="programlistingco">
            <pre class="programlisting">&lt;process-definition name="todo"&gt;
   
   &lt;start-state name="start"&gt;
      &lt;transition to="todo"/&gt;
   &lt;/start-state&gt;
   
   &lt;task-node name="todo"&gt;
      &lt;task name="todo" description="#{todoList.description}"&gt;
         &lt;assignment actor-id="#{actor.id}"/&gt;
      &lt;/task&gt;
      &lt;transition to="done"/&gt;
   &lt;/task-node&gt;
   
   &lt;end-state name="done"/&gt;
   
&lt;/process-definition&gt;
</pre>
            <div class="calloutlist">
              <table border="0" summary="Callout list">
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/1.png" alt="1" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
								The <code class="literal">&lt;start-state&gt;</code> node represents the logical start of the process. When the process starts, it immediately transitions to the <code class="literal">todo</code> node.
							</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/2.png" alt="2" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
								The <code class="literal">&lt;task-node&gt;</code> node represents a <span class="emphasis"><em>wait state</em></span>, where business process execution pauses, waiting for one or more tasks to be performed.
							</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/3.png" alt="3" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
								The <code class="literal">&lt;task&gt;</code> element defines a task to be performed by a user. Since there is only one task defined on this node, when it is complete, execution resumes, and we transition to the end state. The task gets its description from a Seam component named <code class="literal">todoList</code> (one of the JavaBeans).
							</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/4.png" alt="4" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
								Tasks need to be assigned to a user or group of users when they are created. In this case, the task is assigned to the current user, which we get from a built-in Seam component named <code class="literal">actor</code>. Any Seam component may be used to perform task assignment.
							</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/5.png" alt="5" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
								The <code class="literal">&lt;end-state&gt;</code> node defines the logical end of the business process. When execution reaches this node, the process instance is destroyed.
							</p>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <h6 xmlns="">Example 1.13. </h6>
      </div>
      <br class="example-break" />
      <p>
				If we view this process definition using the process definition editor provided by JBossIDE, this is what it looks like:
			</p>
      <div class="mediaobject" align="center">
        <img src="/images/todo-process.png" align="middle" />
      </div>
      <p>
				This document defines our <span class="emphasis"><em>business process</em></span> as a graph of nodes. This is the most trivial possible business process: there is one <span class="emphasis"><em>task</em></span> to be performed, and when that task is complete, the business process ends.
			</p>
      <p>
				The first JavaBean handles the login screen <code class="literal">login.jsp</code>. Its job is just to initialize the jBPM actor id using the <code class="literal">actor</code> component. (In a real application, it would also need to authenticate the user.)
			</p>
      <div class="example">
        <a id="id2850444"></a>
        <div class="example-contents">
          <pre class="programlisting">@Name("login")
public class Login {
   
   @In
   private Actor actor;
   
   private String user;

   public String getUser() {
      return user;
   }

   public void setUser(String user) {
      this.user = user;
   }
   
   public String login()
   {
      actor.setId(user);
      return "/todo.jsp";
   }
}
</pre>
        </div>
        <h6 xmlns="">Example 1.14. </h6>
      </div>
      <br class="example-break" />
      <p>
				Here we see the use of <code class="literal">@In</code> to inject the built-in <code class="literal">Actor</code> component.
			</p>
      <p>
				The JSP itself is trivial:
			</p>
      <div class="example">
        <a id="id2850482"></a>
        <div class="example-contents">
          <pre class="programlisting">&lt;%@ taglib uri="http://java.sun.com/jsf/html" prefix="h"%&gt;
&lt;%@ taglib uri="http://java.sun.com/jsf/core" prefix="f"%&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Login&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Login&lt;/h1&gt;
&lt;f:view&gt;
    &lt;h:form&gt;
      &lt;div&gt;
        &lt;h:inputText value="#{login.user}"/&gt;
        &lt;h:commandButton value="Login" action="#{login.login}"/&gt;
      &lt;/div&gt;
    &lt;/h:form&gt;
&lt;/f:view&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
        </div>
        <h6 xmlns="">Example 1.15. </h6>
      </div>
      <br class="example-break" />
      <p>
				The second JavaBean is responsible for starting business process instances, and ending tasks.
			</p>
      <div class="example">
        <a id="id2850506"></a>
        <div class="example-contents">
          <div class="programlistingco">
            <pre class="programlisting">@Name("todoList")
public class TodoList {
   
   private String description;
   
   public String getDescription()
   {
      return description;
   }

   public void setDescription(String description) {
      this.description = description;
   }
   
   @CreateProcess(definition="todo")
   public void createTodo() {}
   
   @StartTask @EndTask
   public void done() {}

}
</pre>
            <div class="calloutlist">
              <table border="0" summary="Callout list">
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/1.png" alt="1" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
								The description property accepts user input form the JSP page, and exposes it to the process definition, allowing the task description to be set.
							</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/2.png" alt="2" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
								The Seam <code class="literal">@CreateProcess</code> annotation creates a new jBPM process instance for the named process definition.
							</p>
                  </td>
                </tr>
                <tr>
                  <td width="5%" valign="top" align="left">
                    <img src="./Common_Content/images/3.png" alt="3" border="0" />
                  </td>
                  <td valign="top" align="left">
                    <p>
								The Seam <code class="literal">@StartTask</code> annotation starts work on a task. The <code class="literal">@EndTask</code> ends the task, and allows the business process execution to resume.
							</p>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <h6 xmlns="">Example 1.16. </h6>
      </div>
      <br class="example-break" />
      <p>
				In a more realistic example, <code class="literal">@StartTask</code> and <code class="literal">@EndTask</code> would not appear on the same method, because there is usually work to be done using the application in order to complete the task.
			</p>
      <p>
				Finally, the meat of the application is in <code class="literal">todo.jsp</code>:
			</p>
      <div class="example">
        <a id="id2850640"></a>
        <div class="example-contents">
          <pre class="programlisting">&lt;%@ taglib uri="http://java.sun.com/jsf/html" prefix="h" %&gt;
&lt;%@ taglib uri="http://java.sun.com/jsf/core" prefix="f" %&gt;
&lt;%@ taglib uri="http://jboss.com/products/seam/taglib" prefix="s" %&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Todo List&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Todo List&lt;/h1&gt;
&lt;f:view&gt;
   &lt;h:form id="list"&gt;
      &lt;div&gt;
         &lt;h:outputText value="There are no todo items." 
                       rendered="#{empty taskInstanceList}"/&gt;
         &lt;h:dataTable value="#{taskInstanceList}" var="task" 
                      rendered="#{not empty taskInstanceList}"&gt;
            &lt;h:column&gt;
                &lt;f:facet name="header"&gt;
                    &lt;h:outputText value="Description"/&gt;
                &lt;/f:facet&gt;
                &lt;h:inputText value="#{task.description}"/&gt;
            &lt;/h:column&gt;
            &lt;h:column&gt;
                &lt;f:facet name="header"&gt;
                    &lt;h:outputText value="Created"/&gt;
                &lt;/f:facet&gt;
                &lt;h:outputText value="#{task.taskMgmtInstance.processInstance.start}"&gt;
                    &lt;f:convertDateTime type="date"/&gt;
                &lt;/h:outputText&gt;
            &lt;/h:column&gt;
            &lt;h:column&gt;
                &lt;f:facet name="header"&gt;
                    &lt;h:outputText value="Priority"/&gt;
                &lt;/f:facet&gt;
                &lt;h:inputText value="#{task.priority}" style="width: 30"/&gt;
            &lt;/h:column&gt;
            &lt;h:column&gt;
                &lt;f:facet name="header"&gt;
                    &lt;h:outputText value="Due Date"/&gt;
                &lt;/f:facet&gt;
                &lt;h:inputText value="#{task.dueDate}" style="width: 100"&gt;
                    &lt;f:convertDateTime type="date" dateStyle="short"/&gt;
                &lt;/h:inputText&gt;
            &lt;/h:column&gt;
            &lt;h:column&gt;
                &lt;s:button value="Done" action="#{todoList.done}" taskInstance="#{task}"/&gt;
            &lt;/h:column&gt;
         &lt;/h:dataTable&gt;
      &lt;/div&gt;
      &lt;div&gt;
      &lt;h:messages/&gt;
      &lt;/div&gt;
      &lt;div&gt;
         &lt;h:commandButton value="Update Items" action="update"/&gt;
      &lt;/div&gt;
   &lt;/h:form&gt;
   &lt;h:form id="new"&gt;
      &lt;div&gt;
         &lt;h:inputText value="#{todoList.description}"/&gt;
         &lt;h:commandButton value="Create New Item" action="#{todoList.createTodo}"/&gt;
      &lt;/div&gt;
   &lt;/h:form&gt;
&lt;/f:view&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
        </div>
        <h6 xmlns="">Example 1.17. </h6>
      </div>
      <br class="example-break" />
      <p>
				Let's take this one piece at a time.
			</p>
      <p>
				The page renders a list of tasks, which it gets from a built-in Seam component named <code class="literal">taskInstanceList</code>. The list is defined inside a JSF form.
			</p>
      <pre class="programlisting">&lt;h:form id="list"&gt;
   &lt;div&gt;
      &lt;h:outputText value="There are no todo items." rendered="#{empty taskInstanceList}"/&gt;
      &lt;h:dataTable value="#{taskInstanceList}" var="task" 
                   rendered="#{not empty taskInstanceList}"&gt;
         ...
      &lt;/h:dataTable&gt;
   &lt;/div&gt;
&lt;/h:form&gt;
</pre>
      <p>
				Each element of the list is an instance of the jBPM class <code class="literal">TaskInstance</code>. The following code simply displays the interesting properties of each task in the list. For the description, priority and due date, we use input controls, to allow the user to update these values.
			</p>
      <pre class="programlisting">&lt;h:column&gt;
    &lt;f:facet name="header"&gt;
       &lt;h:outputText value="Description"/&gt;
    &lt;/f:facet&gt;
    &lt;h:inputText value="#{task.description}"/&gt;
&lt;/h:column&gt;
&lt;h:column&gt;
    &lt;f:facet name="header"&gt;
        &lt;h:outputText value="Created"/&gt;
    &lt;/f:facet&gt;
    &lt;h:outputText value="#{task.taskMgmtInstance.processInstance.start}"&gt;
        &lt;f:convertDateTime type="date"/&gt;
    &lt;/h:outputText&gt;
&lt;/h:column&gt;
&lt;h:column&gt;
    &lt;f:facet name="header"&gt;
        &lt;h:outputText value="Priority"/&gt;
    &lt;/f:facet&gt;
    &lt;h:inputText value="#{task.priority}" style="width: 30"/&gt;
&lt;/h:column&gt;
&lt;h:column&gt;
    &lt;f:facet name="header"&gt;
        &lt;h:outputText value="Due Date"/&gt;
    &lt;/f:facet&gt;
    &lt;h:inputText value="#{task.dueDate}" style="width: 100"&gt;
        &lt;f:convertDateTime type="date" dateStyle="short"/&gt;
    &lt;/h:inputText&gt;
&lt;/h:column&gt;
</pre>
      <p>
				This button ends the task by calling the action method annotated <code class="literal">@StartTask @EndTask</code>. It passes the task id to Seam as a request parameter:
			</p>
      <pre class="programlisting">&lt;h:column&gt;
    &lt;s:button value="Done" action="#{todoList.done}" taskInstance="#{task}"/&gt;
&lt;/h:column&gt;
</pre>
      <p>
				(Note that this is using a Seam <code class="literal">&lt;s:button&gt;</code> JSF control from the <code class="literal">seam-ui.jar</code> package.)
			</p>
      <p>
				This button is used to update the properties of the tasks. When the form is submitted, Seam and jBPM will make any changes to the tasks persistent. There is no need for any action listener method:
			</p>
      <pre class="programlisting">&lt;h:commandButton value="Update Items" action="update"/&gt;
</pre>
      <p>
				A second form on the page is used to create new items, by calling the action method annotated <code class="literal">@CreateProcess</code>.
			</p>
      <pre class="programlisting">&lt;h:form id="new"&gt;
    &lt;div&gt;
        &lt;h:inputText value="#{todoList.description}"/&gt;
        &lt;h:commandButton value="Create New Item" action="#{todoList.createTodo}"/&gt;
    &lt;/div&gt;
&lt;/h:form&gt;
</pre>
      <p>
				There are several other files needed for the example, but they are just standard jBPM and Seam configuration and not very interesting.
			</p>
    </div>
    <ul xmlns="http://www.w3.org/1999/xhtml" class="docnav">
      <li class="previous">
        <a accesskey="p" href="todo.html"><strong>Prev</strong>1.4. Seam and jBPM: the todo list example</a>
      </li>
      <li class="up">
        <a accesskey="u" href="#">
          <strong>Up</strong>
        </a>
      </li>
      <li class="home">
        <a accesskey="h" href="index.html">
          <strong>Home</strong>
        </a>
      </li>
      <li class="next">
        <a accesskey="n" href="ch01s04s02.html"><strong>Next</strong>1.4.2. How it works</a>
      </li>
    </ul>
  </body>
</html>
