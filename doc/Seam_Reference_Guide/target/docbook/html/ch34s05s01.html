<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>34.5.1. Configuration file changes</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="Seam - Contextual Components"/>
      <link rel="up" href="ch34s05.html" title="34.5. Changes needed for deployment to Websphere"/>
      <link rel="prev" href="ch34s05.html" title="34.5. Changes needed for deployment to Websphere"/>
      <link rel="next" href="ch34s05s02.html" title="34.5.2. Creating the AuthenticatorAction EJB"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="ch34s05.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="ch34s05s02.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="section" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h3 class="title">
                     <a id="d0e24579"/>34.5.1. Configuration file changes</h3>
               </div>
            </div>
         </div>
         <div class="variablelist">
            <dl>
               <dt>
                  <span class="term">
                  
                     <code class="literal">resources/META-INF/persistence-dev.xml</code>
               
                  </span>
               </dt>
               <dd>
                  <div class="itemizedlist">
                     <ul>
                        <li>
                           <p> Alter the
                           <code class="literal">jta-data-source</code> to be
                           <code class="literal">DefaultDatasource</code>. We are
                           going to be using the integrated Websphere
                           DB.</p>
                        </li>
                        <li>
                           <p> Add or change the properties below.
                           These are described in detail at <a href="jee5-websphere-section.html" title="34.2.  The jee5/booking example">Section 34.2, “ The <code class="literal">jee5/booking</code> example ”</a>:
                           </p>
                           <pre class="programlisting">
&lt;property name="hibernate.dialect" value="GlassfishDerbyDialect"/&gt;
&lt;property name="hibernate.hbm2ddl.auto" value="update"/&gt;
&lt;property name="hibernate.show_sql" value="true"/&gt;
&lt;property name="hibernate.format_sql" value="true"/&gt;
&lt;property name="hibernate.cache.provider_class" 
          value="org.hibernate.cache.HashtableCacheProvider"/&gt;
&lt;property name="hibernate.transaction.manager_lookup_class" 
          value="org.hibernate.transaction.WebSphereExtendedJTATransactionLookup"/&gt;</pre>
                        </li>
                        <li>
                           <p> Remove the JBoss AS specific method of exposing
                           the EntityManagerFactory: </p>
                           <pre class="programlisting">&lt;property 
 name="jboss.entity.manager.factory.jndi.name" 
 value="java:/websphere_exampleEntityManagerFactory"&gt;</pre>
                        </li>
                        <li>
                           <p> You'll need to alter
                           <code class="literal">persistence-prod.xml</code> as
                           well if you want to deploy to Websphere using the
                           prod profile. </p>
                        </li>
                     </ul>
                  </div>
               </dd>
               <dt>
                  <span class="term">
                  
                     <code class="literal">resources/GlassfishDerbyDialect.class</code>
               
                  </span>
               </dt>
               <dd>
                  <p>As with other examples we need to include this class for
                     DB support. It can be copied from the
                     <code class="literal">jpa</code> example into the
                     <code class="literal">websphere_example/resources</code>
                     directory.
                     
                     </p>
                  <pre class="programlisting">
cp $SEAM/examples/jpa/resources-websphere61/WEB-INF/classes/GlassfishDerbyDialect.class
   ./resources</pre>
                  <p>
                     
                  </p>
               </dd>
               <dt>
                  <span class="term">
                  
                     <code class="literal">resources/META-INF/jboss-app.xml</code>
               
                  </span>
               </dt>
               <dd>
                  <p> You can delete this file as we aren't deploying to JBoss
                     AS ( <code class="literal">jboss-app.xml</code> is used to enable
                     classloading isolation in JBoss AS) </p>
               </dd>
               <dt>
                  <span class="term"> 
                     <code class="literal">resources/*-ds.xml</code>
               
                  </span>
               </dt>
               <dd>
                  <p> You can delete these file as we aren't deploying to
                     JBoss AS (these files define datasources in JBoss AS, we
                     are using Websphere's default datasource) </p>
               </dd>
               <dt>
                  <span class="term">
                  
                     <code class="literal">resources/WEB-INF/components.xml</code>
               
                  </span>
               </dt>
               <dd>
                  <div class="itemizedlist">
                     <ul>
                        <li>
                           <p> Enable container managed transaction
                           integration - add the <code class="literal">
                           &lt;transaction:ejb-transaction /&gt;
                           </code> component, and it's namespace
                           declaration <code class="literal">
                           xmlns:transaction="http://jboss.com/products/seam/transaction"
                           </code> 
                           </p>
                        </li>
                        <li>
                           <p> Alter the <code class="literal">jndi-pattern</code>
                           to <code class="literal">
                           java:comp/env/websphere_example/#{ejbName}
                           </code> 
                           </p>
                        </li>
                        <li>
                           <p>We do not need
                           <code class="literal">managed-persistence-context</code>
                           for this example and so can delete its
                           entry.</p>
                           <pre class="programlisting">
&lt;persistence:managed-persistence-context name="entityManager"
             auto-create="true"
             persistence-unit-jndi-name="java:/websphere_exampleEntityManagerFactory"/&gt; </pre>
                        </li>
                     </ul>
                  </div>
               </dd>
               <dt>
                  <span class="term"> 
                     <code class="literal">resources/WEB-INF/web.xml</code>
               
                  </span>
               </dt>
               <dd>
                  <p> Websphere does not support <code class="literal">Servlet
                     2.5</code>, it required <code class="literal">Servlet
                     2.4</code>. For this change we need to adjust the top of
                     the <code class="literal">web.xml</code> file to look like the
                     following:</p>
                  <pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app version="2.4" 
         xmlns="http://java.sun.com/xml/ns/j2ee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee 
                             http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"&gt;
                  </pre>
                  <p>As with the <code class="literal">jee5/booking</code>
                     example we need to add EJB references to the web.xml. These
                     references require the empty
                     <code class="literal">local-home</code> to flag them for
                     Websphere to perform the proper binding.</p>
                  <pre class="programlisting">
  &lt;ejb-local-ref&gt;              
    &lt;ejb-ref-name&gt;websphere_example/AuthenticatorAction&lt;/ejb-ref-name&gt;                
    &lt;ejb-ref-type&gt;Session&lt;/ejb-ref-type&gt;     
    &lt;local-home&gt;&lt;/local-home&gt;
    &lt;local&gt;org.jboss.seam.tutorial.websphere.action.Authenticator&lt;/local&gt;  
  &lt;/ejb-local-ref&gt;
   
  &lt;ejb-local-ref&gt;
    &lt;ejb-ref-name&gt;websphere_example/EjbSynchronizations&lt;/ejb-ref-name&gt;  
    &lt;ejb-ref-type&gt;Session&lt;/ejb-ref-type&gt;
    &lt;local-home&gt;&lt;/local-home&gt;
    &lt;local&gt;org.jboss.seam.transaction.LocalEjbSynchronizations&lt;/local&gt;
  &lt;/ejb-local-ref&gt;</pre>
               </dd>
            </dl>
         </div>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="ch34s05.html">
               <strong>Prev</strong>34.5. Changes needed for deployment to Websphere</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="ch34s05s02.html">
               <strong>Next</strong>34.5.2. Creating the AuthenticatorAction
        ...</a>
         </li>
      </ul>
   </body>
</html>