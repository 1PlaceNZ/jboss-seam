<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>1.5.1. Understanding the code</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="Seam - Contextual Components"/>
      <link rel="up" href="numberguess.html" title="1.5. Seam pageflow: the numberguess example"/>
      <link rel="prev" href="numberguess.html" title="1.5. Seam pageflow: the numberguess example"/>
      <link rel="next" href="ch01s05s02.html" title="1.5.2. How it works"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="numberguess.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="ch01s05s02.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="section" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h3 class="title">
                     <a id="d0e1400"/>1.5.1. Understanding the code</h3>
               </div>
            </div>
         </div>
         <p> The example is implemented using one JavaBean, three JSP pages and a jPDL pageflow definition. Let's
                begin with the pageflow: </p>
         <div class="example">
            <a id="d0e1405"/>
            <div class="example-contents">
               <div class="programlistingco">
                  <pre class="programlisting">&lt;pageflow-definition 
        xmlns="http://jboss.com/products/seam/pageflow"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://jboss.com/products/seam/pageflow 
                            http://jboss.com/products/seam/pageflow-2.1.xsd"
        name="numberGuess"&gt;
   
   &lt;start-page name="displayGuess" view-id="/numberGuess.jspx"&gt;
      &lt;redirect/&gt;
      &lt;transition name="guess" to="evaluateGuess"&gt;
         &lt;action expression="#{numberGuess.guess}"/&gt;
      &lt;/transition&gt;
      &lt;transition name="giveup" to="giveup"/&gt;
   &lt;/start-page&gt;
   
   &lt;decision name="evaluateGuess" expression="#{numberGuess.correctGuess}"&gt;
      &lt;transition name="true" to="win"/&gt;
      &lt;transition name="false" to="evaluateRemainingGuesses"/&gt;
   &lt;/decision&gt;
   
   &lt;decision name="evaluateRemainingGuesses" expression="#{numberGuess.lastGuess}"&gt;
      &lt;transition name="true" to="lose"/&gt;
      &lt;transition name="false" to="displayGuess"/&gt;
   &lt;/decision&gt;
   
   &lt;page name="giveup" view-id="/giveup.jspx"&gt;
      &lt;redirect/&gt;
      &lt;transition name="yes" to="lose"/&gt;
      &lt;transition name="no" to="displayGuess"/&gt;
   &lt;/page&gt;
   
   &lt;page name="win" view-id="/win.jspx"&gt;
      &lt;redirect/&gt;
      &lt;end-conversation/&gt;
   &lt;/page&gt;
   
   &lt;page name="lose" view-id="/lose.jspx"&gt;
      &lt;redirect/&gt;
      &lt;end-conversation/&gt;
   &lt;/page&gt;
   
&lt;/pageflow-definition&gt;</pre>
                  <div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <img src="images/1.png" alt="1" border="0"/>
                           </td>
                           <td valign="top" align="left">
                              <p> The <code class="literal">&lt;page&gt;</code> element defines a wait state where the
                                system displays a particular JSF view and waits for user input. The
                                <code class="literal">view-id</code> is the same JSF view id used in plain JSF navigation rules.
                                The <code class="literal">redirect</code> attribute tells Seam to use post-then-redirect when
                                navigating to the page. (This results in friendly browser URLs.) </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <img src="images/2.png" alt="2" border="0"/>
                           </td>
                           <td valign="top" align="left">
                              <p> The <code class="literal">&lt;transition&gt;</code> element names a JSF outcome. The
                                transition is triggered when a JSF action results in that outcome. Execution will then
                                proceed to the next node of the pageflow graph, after invocation of any jBPM transition
                                actions. </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <img src="images/3.png" alt="3" border="0"/>
                           </td>
                           <td valign="top" align="left">
                              <p> A transition <code class="literal">&lt;action&gt;</code> is just like a JSF action,
                                except that it occurs when a jBPM transition occurs. The transition action can invoke
                                any Seam component. </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <img src="images/4.png" alt="4" border="0"/>
                           </td>
                           <td valign="top" align="left">
                              <p> A <code class="literal">&lt;decision&gt;</code> node branches the pageflow, and
                                determines the next node to execute by evaluating a JSF EL expression. </p>
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <p class="title">
               <b>Example 1.18. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> Here is what the pageflow looks like in the JBossIDE pageflow editor: </p>
         <div class="mediaobject" align="center">
            <img src="/images/numberguess-pageflow.png" align="middle"/>
         </div>
         <p> Now that we have seen the pageflow, it is very, very easy to understand the rest of the application! </p>
         <p> Here is the main page of the application, <code class="literal">numberGuess.jspx</code>: </p>
         <div class="example">
            <a id="d0e1460"/>
            <div class="example-contents">
               <pre class="programlisting">&lt;&lt;?xml version="1.0"?&gt;
&lt;jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" 
          xmlns:h="http://java.sun.com/jsf/html"
          xmlns:f="http://java.sun.com/jsf/core"
          xmlns:s="http://jboss.com/products/seam/taglib"
          xmlns="http://www.w3.org/1999/xhtml"
          version="2.0"&gt;
  &lt;jsp:output doctype-root-element="html" 
              doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
              doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/&gt;
  &lt;jsp:directive.page contentType="text/html"/&gt;
  &lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Guess a number...&lt;/title&gt;
    &lt;link href="niceforms.css" rel="stylesheet" type="text/css" /&gt;
    &lt;script language="javascript" type="text/javascript" src="niceforms.js" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Guess a number...&lt;/h1&gt;
    &lt;f:view&gt;
	  &lt;h:form styleClass="niceform"&gt;
	    
	    &lt;div&gt;
	    &lt;h:messages globalOnly="true"/&gt;
	    &lt;h:outputText value="Higher!" 
	           rendered="#{numberGuess.randomNumber gt numberGuess.currentGuess}"/&gt;
	    &lt;h:outputText value="Lower!" 
	           rendered="#{numberGuess.randomNumber lt numberGuess.currentGuess}"/&gt;
		&lt;/div&gt;
		
		&lt;div&gt;
        I'm thinking of a number between 
        &lt;h:outputText value="#{numberGuess.smallest}"/&gt; and 
        &lt;h:outputText value="#{numberGuess.biggest}"/&gt;. You have 
        &lt;h:outputText value="#{numberGuess.remainingGuesses}"/&gt; guesses.
        &lt;/div&gt;
        
        &lt;div&gt;
        Your guess: 
        &lt;h:inputText value="#{numberGuess.currentGuess}" id="inputGuess" 
                     required="true" size="3" 
                     rendered="#{(numberGuess.biggest-numberGuess.smallest) gt 20}"&gt;
          &lt;f:validateLongRange maximum="#{numberGuess.biggest}" 
                               minimum="#{numberGuess.smallest}"/&gt;
        &lt;/h:inputText&gt;
        &lt;h:selectOneMenu value="#{numberGuess.currentGuess}" 
                         id="selectGuessMenu" required="true"
                         rendered="#{(numberGuess.biggest-numberGuess.smallest) le 20 and 
                                     (numberGuess.biggest-numberGuess.smallest) gt 4}"&gt;
          &lt;s:selectItems value="#{numberGuess.possibilities}" var="i" label="#{i}"/&gt;
        &lt;/h:selectOneMenu&gt;
        &lt;h:selectOneRadio value="#{numberGuess.currentGuess}" id="selectGuessRadio" 
                          required="true"
                          rendered="#{(numberGuess.biggest-numberGuess.smallest) le 4}"&gt;
          &lt;s:selectItems value="#{numberGuess.possibilities}" var="i" label="#{i}"/&gt;
        &lt;/h:selectOneRadio&gt;
		&lt;h:commandButton value="Guess" action="guess"/&gt;
        &lt;s:button value="Cheat" view="/confirm.jspx"/&gt;
        &lt;s:button value="Give up" action="giveup"/&gt;
		&lt;/div&gt;
		
		&lt;div&gt;
        &lt;h:message for="inputGuess" style="color: red"/&gt;
        &lt;/div&gt;
        
	  &lt;/h:form&gt;
    &lt;/f:view&gt;
  &lt;/body&gt;
  &lt;/html&gt;
&lt;/jsp:root&gt;</pre>
            </div>
            <p class="title">
               <b>Example 1.19. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> Notice how the command button names the <code class="literal">guess</code> transition instead of calling an
                action directly. </p>
         <p> The <code class="literal">win.jspx</code> page is predictable: </p>
         <div class="example">
            <a id="d0e1474"/>
            <div class="example-contents">
               <pre class="programlisting">&lt;jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" 
          xmlns:h="http://java.sun.com/jsf/html"
          xmlns:f="http://java.sun.com/jsf/core"
          xmlns="http://www.w3.org/1999/xhtml"
          version="2.0"&gt;
  &lt;jsp:output doctype-root-element="html"
              doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
              doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/&gt;
  &lt;jsp:directive.page contentType="text/html"/&gt;
  &lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;You won!&lt;/title&gt;
    &lt;link href="niceforms.css" rel="stylesheet" type="text/css" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;You won!&lt;/h1&gt;
    &lt;f:view&gt;
      Yes, the answer was &lt;h:outputText value="#{numberGuess.currentGuess}" /&gt;.
      It took you &lt;h:outputText value="#{numberGuess.guessCount}" /&gt; guesses.
      &lt;h:outputText value="But you cheated, so it doesn't count!" 
                    rendered="#{numberGuess.cheat}"/&gt;
      Would you like to &lt;a href="numberGuess.seam"&gt;play again&lt;/a&gt;?
    &lt;/f:view&gt;
  &lt;/body&gt;
  &lt;/html&gt;
&lt;/jsp:root&gt;
</pre>
            </div>
            <p class="title">
               <b>Example 1.20. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> As is <code class="literal">lose.jspx</code> (which I can't be bothered copy/pasting). Finally, the JavaBean
                Seam component: </p>
         <div class="example">
            <a id="d0e1483"/>
            <div class="example-contents">
               <div class="programlistingco">
                  <pre class="programlisting">@Name("numberGuess")
@Scope(ScopeType.CONVERSATION)
public class NumberGuess implements Serializable {
   
   private int randomNumber;
   private Integer currentGuess;
   private int biggest;
   private int smallest;
   private int guessCount;
   private int maxGuesses;
   private boolean cheated;
   
   @Create
   public void begin()
   {
      randomNumber = new Random().nextInt(100);
      guessCount = 0;
      biggest = 100;
      smallest = 1;
   }
   
   public void setCurrentGuess(Integer guess)
   {
      this.currentGuess = guess;
   }
   
   public Integer getCurrentGuess()
   {
      return currentGuess;
   }
   
   public void guess()
   {
      if (currentGuess&gt;randomNumber)
      {
         biggest = currentGuess - 1;
      }
      if (currentGuess&lt;randomNumber)
      {
         smallest = currentGuess + 1;
      }
      guessCount ++;
   }
   
   public boolean isCorrectGuess()
   {
      return currentGuess==randomNumber;
   }
   
   public int getBiggest()
   {
      return biggest;
   }
   
   public int getSmallest()
   {
      return smallest;
   }
   
   public int getGuessCount()
   {
      return guessCount;
   }
   
   public boolean isLastGuess()
   {
      return guessCount==maxGuesses;
   }

   public int getRemainingGuesses() {
      return maxGuesses-guessCount;
   }

   public void setMaxGuesses(int maxGuesses) {
      this.maxGuesses = maxGuesses;
   }

   public int getMaxGuesses() {
      return maxGuesses;
   }

   public int getRandomNumber() {
      return randomNumber;
   }

   public void cheated()
   {
      cheated = true;
   }
   
   public boolean isCheat() {
      return cheated;
   }
   
   public List&lt;Integer&gt; getPossibilities()
   {
      List&lt;Integer&gt; result = new ArrayList&lt;Integer&gt;();
      for(int i=smallest; i&lt;=biggest; i++) result.add(i);
      return result;
   }
   
}
</pre>
                  <div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <img src="images/1.png" alt="1" border="0"/>
                           </td>
                           <td valign="top" align="left">
                              <p> The first time a JSP page asks for a <code class="literal">numberGuess</code> component, Seam
                                will create a new one for it, and the <code class="literal">@Create</code> method will be invoked,
                                allowing the component to initialize itself. </p>
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <p class="title">
               <b>Example 1.21. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p>The <code class="literal">pages.xml</code> file starts a Seam
                <span class="emphasis">
               <em>conversation</em>
            </span> (much more about that later), and specifies the
                pageflow definition to use for the conversation's page flow. 
            </p>
         <div class="example">
            <a id="d0e1508"/>
            <div class="example-contents">
               <pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;pages xmlns="http://jboss.com/products/seam/pages"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://jboss.com/products/seam/pages http://jboss.com/products/seam/pages-2.1.xsd"&gt;

  &lt;page view-id="/numberGuess.jspx"&gt;
    &lt;begin-conversation join="true" pageflow="numberGuess"/&gt;
  &lt;/page&gt;

  &lt;page view-id="/confirm.jspx"&gt;
    &lt;begin-conversation nested="true" pageflow="cheat"/&gt;
  &lt;/page&gt;

&lt;/pages&gt;      
</pre>
            </div>
            <p class="title">
               <b>Example 1.22. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> As you can see, this Seam component is pure business logic! It doesn't need to know anything at all
                about the user interaction flow. This makes the component potentially more reuseable. </p>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="numberguess.html">
               <strong>Prev</strong>1.5. Seam pageflow: the numberguess example</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="ch01s05s02.html">
               <strong>Next</strong>1.5.2. How it works</a>
         </li>
      </ul>
   </body>
</html>