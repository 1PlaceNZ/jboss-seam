<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>12.1. Installing rules</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="Seam - Contextual Components"/>
      <link rel="up" href="drools.html" title="Chapter 12. Seam and JBoss Rules"/>
      <link rel="prev" href="drools.html" title="Chapter 12. Seam and JBoss Rules"/>
      <link rel="next" href="ch12s02.html" title="12.2. Using rules from a Seam component"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="drools.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="ch12s02.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="section" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title">
                     <a id="d0e6879"/>12.1. Installing rules</h2>
               </div>
            </div>
         </div>
         <p>
            The first step is to make an instance of <code class="literal">org.drools.RuleBase</code>
            available in a Seam context variable. For testing purposes, Seam provides a built-in component
            that compiles a static set of rules from the classpath. You can install
            this component via <code class="literal">components.xml</code>:
        </p>
         <pre class="programlisting">&lt;drools:rule-base name="policyPricingRules"&gt;
    &lt;drools:rule-files&gt;
        &lt;value&gt;policyPricingRules.drl&lt;/value&gt;
    &lt;/drools:rule-files&gt;
&lt;/drools:rule-base&gt;</pre>
         <p>
             This component compiles rules from a set of <code class="literal">.drl</code>
             files and caches an instance of <code class="literal">org.drools.RuleBase</code>
             in the Seam <code class="literal">APPLICATION</code> context. Note that it is 
             quite likely that you will need to install multiple rule bases in a 
             rule-driven application.
         </p>
         <p>
             If you want to use a Drools DSL, you alse need to specify the DSL
             definition:
         </p>
         <pre class="programlisting">&lt;drools:rule-base name="policyPricingRules" dsl-file="policyPricing.dsl"&gt;
    &lt;drools:rule-files&gt;
        &lt;value&gt;policyPricingRules.drl&lt;/value&gt;
    &lt;/drools:rule-files&gt;
&lt;/drools:rule-base&gt;</pre>
         <p>
        In most rules-driven applications,
            rules need to be dynamically deployable, so a production application will want to use a
            Drools RuleAgent to manage the RuleBase.  The RuleAgent can connect to a Drools rule server (BRMS) 
            or hot deploy rules packages from a local file repository.  The RulesAgent-managed RuleBase is
            also configurable in <code class="literal">components.xml</code>:
        </p>
         <pre class="programlisting">&lt;drools:rule-agent name="insuranceRules" 
                    configurationFile="/WEB-INF/deployedrules.properties" /&gt;</pre>
         <p>The properties file contains properties specific to the RulesAgent. Here is an example configuration file from the
        Drools example distribution.</p>
         <pre class="programlisting">newInstance=true
url=http://localhost:8080/drools-jbrms/org.drools.brms.JBRMS/package/org.acme.insurance/fmeyer
localCacheDir=/Users/fernandomeyer/projects/jbossrules/drools-examples/drools-examples-brms/cache
poll=30
name=insuranceconfig</pre>
         <p>It is also possible to configure the options on the component directly, bypassing the configuration file.</p>
         <pre class="programlisting">&lt;drools:rule-agent name="insuranceRules"
                   url="http://localhost:8080/drools-jbrms/org.drools.brms.JBRMS/package/org.acme.insurance/fmeyer"
                   local-cache-dir="/Users/fernandomeyer/projects/jbossrules/drools-examples/drools-examples-brms/cache"
                   poll="30"
                   configuration-name="insuranceconfig" /&gt;</pre>
         <p>
             Next, we need to make an instance of <code class="literal">org.drools.WorkingMemory</code>
             available to each conversation. (Each <code class="literal">WorkingMemory</code>
             accumulates facts relating to the current conversation.)
         </p>
         <pre class="programlisting">&lt;drools:managed-working-memory name="policyPricingWorkingMemory" auto-create="true" rule-base="#{policyPricingRules}"/&gt;</pre>
         <p>
             Notice that we gave the <code class="literal">policyPricingWorkingMemory</code> a
             reference back to our rule base via the <code class="literal">ruleBase</code>
             configuration property.
         </p>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="drools.html">
               <strong>Prev</strong>Chapter 12. Seam and JBoss Rules</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="ch12s02.html">
               <strong>Next</strong>12.2. Using rules from a Seam component</a>
         </li>
      </ul>
   </body>
</html>