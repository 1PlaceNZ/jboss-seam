<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>1.9.2. Bookmarkable search results page</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="Seam - Contextual Components"/>
      <link rel="up" href="blog.html" title="1.9. A RESTful Seam application: the Blog example"/>
      <link rel="prev" href="ch01s09s01.html" title="1.9.1. Using &#34;pull&#34;-style MVC"/>
      <link rel="next" href="ch01s09s03.html" title="1.9.3. Using &#34;push&#34;-style MVC in a RESTful application"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="ch01s09s01.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="ch01s09s03.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="section" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h3 class="title">
                     <a id="d0e2054"/>1.9.2. Bookmarkable search results page</h3>
               </div>
            </div>
         </div>
         <p> The blog example has a tiny form in the top right of each page that allows the user to search for
                blog entries. This is defined in a file, <code class="literal">menu.xhtml</code>, included by the facelets
                template, <code class="literal">template.xhtml</code>: </p>
         <div class="example">
            <a id="d0e2065"/>
            <div class="example-contents">
               <pre class="programlisting">&lt;div id="search"&gt;
   &lt;h:form&gt;
      &lt;h:inputText value="#{searchAction.searchPattern}"/&gt;
      &lt;h:commandButton value="Search" action="/search.xhtml"/&gt;
   &lt;/h:form&gt;
&lt;/div&gt;</pre>
            </div>
            <p class="title">
               <b>Example 1.28. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> To implement a bookmarkable search results page, we need to perform a browser redirect after
                processing the search form submission. Because we used the JSF view id as the action outcome, Seam
                automatically redirects to the view id when the form is submitted. Alternatively, we could have defined
                a navigation rule like this: </p>
         <div class="example">
            <a id="d0e2071"/>
            <div class="example-contents">
               <pre class="programlisting">&lt;navigation-rule&gt;
   &lt;navigation-case&gt;
      &lt;from-outcome&gt;searchResults&lt;/from-outcome&gt;
      &lt;to-view-id&gt;/search.xhtml&lt;/to-view-id&gt;
      &lt;redirect/&gt;
   &lt;/navigation-case&gt;
&lt;/navigation-rule&gt;</pre>
            </div>
            <p class="title">
               <b>Example 1.29. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> Then the form would have looked like this: </p>
         <div class="example">
            <a id="d0e2077"/>
            <div class="example-contents">
               <pre class="programlisting">&lt;div id="search"&gt;
   &lt;h:form&gt;
      &lt;h:inputText value="#{searchAction.searchPattern}"/&gt;
      &lt;h:commandButton value="Search" action="searchResults"/&gt;
   &lt;/h:form&gt;
&lt;/div&gt;</pre>
            </div>
            <p class="title">
               <b>Example 1.30. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> But when we redirect, we need to include the values submitted with the form as request parameters, to
                get a bookmarkable URL like
                <code class="literal">http://localhost:8080/seam-blog/search.seam?searchPattern=seam</code>. JSF does not provide
                an easy way to do this, but Seam does. We use a Seam <span class="emphasis">
               <em>page parameter</em>
            </span>, defined in
                    <code class="literal">WEB-INF/pages.xml</code>: </p>
         <div class="example">
            <a id="d0e2092"/>
            <div class="example-contents">
               <pre class="programlisting">&lt;pages&gt;
   &lt;page view-id="/search.xhtml"&gt;
      &lt;param name="searchPattern" value="#{searchService.searchPattern}"/&gt;
   &lt;/page&gt;
   ...
&lt;/pages&gt;</pre>
            </div>
            <p class="title">
               <b>Example 1.31. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> This tells Seam to include the value of <code class="literal">#{searchService.searchPattern}</code> as a
                request parameter named <code class="literal">searchPattern</code> when redirecting to the page, and then re-apply
                the value of that parameter to the model before rendering the page. </p>
         <p> The redirect takes us to the <code class="literal">search.xhtml</code> page: </p>
         <div class="example">
            <a id="d0e2109"/>
            <div class="example-contents">
               <pre class="programlisting">&lt;h:dataTable value="#{searchResults}" var="blogEntry"&gt;
   &lt;h:column&gt;
      &lt;div&gt;
         &lt;h:outputLink value="entry.seam"&gt;
            &lt;f:param name="blogEntryId" value="#{blogEntry.id}"/&gt;
            #{blogEntry.title}
         &lt;/h:outputLink&gt;
         posted on 
         &lt;h:outputText value="#{blogEntry.date}"&gt;
            &lt;f:convertDateTime timeZone="#{blog.timeZone}" locale="#{blog.locale}" type="both"/&gt;
         &lt;/h:outputText&gt;
      &lt;/div&gt;
   &lt;/h:column&gt;
&lt;/h:dataTable&gt;</pre>
            </div>
            <p class="title">
               <b>Example 1.32. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> Which again uses "pull"-style MVC to retrieve the actual search results: </p>
         <div class="example">
            <a id="d0e2115"/>
            <div class="example-contents">
               <pre class="programlisting">@Name("searchService")
public class SearchService 
{
   
   @In
   private EntityManager entityManager;
   
   private String searchPattern;
   
   @Factory("searchResults")
   public List&lt;BlogEntry&gt; getSearchResults()
   {
      if (searchPattern==null)
      {
         return null;
      }
      else
      {
         return entityManager.createQuery("select be from BlogEntry be "" + 
                      "where lower(be.title) like :searchPattern " + 
                      "lower(be.body) like :searchPattern order by be.date desc")
               .setParameter( "searchPattern", getSqlSearchPattern() )
               .setMaxResults(100)
               .getResultList();
      }
   }

   private String getSqlSearchPattern()
   {
      return searchPattern==null ? "" :
             '%' + searchPattern.toLowerCase().replace('*', '%').replace('?', '_') + '%';
   }

   public String getSearchPattern()
   {
      return searchPattern;
   }

   public void setSearchPattern(String searchPattern)
   {
      this.searchPattern = searchPattern;
   }

}</pre>
            </div>
            <p class="title">
               <b>Example 1.33. </b>
            </p>
         </div>
         <br class="example-break"/>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="ch01s09s01.html">
               <strong>Prev</strong>1.9.1. Using "pull"-style MVC</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="ch01s09s03.html">
               <strong>Next</strong>1.9.3. Using "push"-style MVC in a RESTful applic...</a>
         </li>
      </ul>
   </body>
</html>