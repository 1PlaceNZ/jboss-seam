<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>1.9.1. Using "pull"-style MVC</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="Seam - Contextual Components"/>
      <link rel="up" href="blog.html" title="1.9. A RESTful Seam application: the Blog example"/>
      <link rel="prev" href="blog.html" title="1.9. A RESTful Seam application: the Blog example"/>
      <link rel="next" href="ch01s09s02.html" title="1.9.2. Bookmarkable search results page"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="blog.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="ch01s09s02.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="section" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h3 class="title">
                     <a id="d0e1999"/>1.9.1. Using "pull"-style MVC</h3>
               </div>
            </div>
         </div>
         <p> This snippet from the <code class="literal">index.xhtml</code> facelets page displays a list of recent blog
                entries: </p>
         <div class="example">
            <a id="d0e2007"/>
            <div class="example-contents">
               <pre class="programlisting">&lt;h:dataTable value="#{blog.recentBlogEntries}" var="blogEntry" rows="3"&gt;
   &lt;h:column&gt;
      &lt;div class="blogEntry"&gt;
         &lt;h3&gt;#{blogEntry.title}&lt;/h3&gt;
         &lt;div&gt;
            &lt;h:outputText escape="false" 
                  value="#{blogEntry.excerpt==null ? blogEntry.body : blogEntry.excerpt}"/&gt;
         &lt;/div&gt;
         &lt;p&gt;
            &lt;h:outputLink value="entry.seam" rendered="#{blogEntry.excerpt!=null}"&gt;
               &lt;f:param name="blogEntryId" value="#{blogEntry.id}"/&gt;
               Read more...
            &lt;/h:outputLink&gt;
         &lt;/p&gt;
         &lt;p&gt;
            [Posted on 
            &lt;h:outputText value="#{blogEntry.date}"&gt;
               &lt;f:convertDateTime timeZone="#{blog.timeZone}" 
                                  locale="#{blog.locale}" type="both"/&gt;
            &lt;/h:outputText&gt;]
            &amp;#160;
            &lt;h:outputLink value="entry.seam"&gt;[Link]
               &lt;f:param name="blogEntryId" value="#{blogEntry.id}"/&gt;
            &lt;/h:outputLink&gt;
         &lt;/p&gt;
      &lt;/div&gt;
   &lt;/h:column&gt;
&lt;/h:dataTable&gt;</pre>
            </div>
            <p class="title">
               <b>Example 1.26. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> If we navigate to this page from a bookmark, how does the data used by the
                    <code class="literal">&lt;h:dataTable&gt;</code> actually get initialized? Well, what happens is that
                the <code class="literal">Blog</code> is retrieved lazily—"pulled"—when needed, by a Seam
                component named <code class="literal">blog</code>. This is the opposite flow of control to what is usual in
                traditional web action-based frameworks like Struts. </p>
         <div class="example">
            <a id="d0e2022"/>
            <div class="example-contents">
               <div class="programlistingco">
                  <pre class="programlisting">@Name("blog")
@Scope(ScopeType.STATELESS)
@AutoCreate
public class BlogService 
{
   
   @In EntityManager entityManager;
  
   @Unwrap
   public Blog getBlog()
   {
      return (Blog) entityManager.createQuery("select distinct b from Blog b left join fetch b.blogEntries")
            .setHint("org.hibernate.cacheable", true)
            .getSingleResult();
   }

}</pre>
                  <div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <img src="images/1.png" alt="1" border="0"/>
                           </td>
                           <td valign="top" align="left">
                              <p> This component uses a <span class="emphasis">
                                    <em>seam-managed persistence context</em>
                                 </span>. Unlike
                                the other examples we've seen, this persistence context is managed by Seam, instead of
                                by the EJB3 container. The persistence context spans the entire web request, allowing us
                                to avoid any exceptions that occur when accessing unfetched associations in the view.
                            </p>
                           </td>
                        </tr>
                        <tr>
                           <td width="5%" valign="top" align="left">
                              <img src="images/2.png" alt="2" border="0"/>
                           </td>
                           <td valign="top" align="left">
                              <p> The <code class="literal">@Unwrap</code> annotation tells Seam to provide the return value of
                                the method—the <code class="literal">Blog</code>—instead of the actual
                                    <code class="literal">BlogService</code> component to clients. This is the Seam
                                    <span class="emphasis">
                                    <em>manager component pattern</em>
                                 </span>. </p>
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <p class="title">
               <b>Example 1.27. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> This is good so far, but what about bookmarking the result of form submissions, such as a search
                results page? </p>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="blog.html">
               <strong>Prev</strong>1.9. A RESTful Seam application: the Blog example</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="ch01s09s02.html">
               <strong>Next</strong>1.9.2. Bookmarkable search results page</a>
         </li>
      </ul>
   </body>
</html>