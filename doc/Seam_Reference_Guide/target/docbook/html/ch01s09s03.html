<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>1.9.3. Using "push"-style MVC in a RESTful application</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="Seam - Contextual Components"/>
      <link rel="up" href="blog.html" title="1.9. A RESTful Seam application: the Blog example"/>
      <link rel="prev" href="ch01s09s02.html" title="1.9.2. Bookmarkable search results page"/>
      <link rel="next" href="gettingstarted.html" title="Chapter 2. Getting started with Seam, using seam-gen"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="ch01s09s02.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="gettingstarted.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="section" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h3 class="title">
                     <a id="d0e2119"/>1.9.3. Using "push"-style MVC in a RESTful application</h3>
               </div>
            </div>
         </div>
         <p> Very occasionally, it makes more sense to use push-style MVC for processing RESTful pages, and so
                Seam provides the notion of a <span class="emphasis">
               <em>page action</em>
            </span>. The Blog example uses a page action for
                the blog entry page, <code class="literal">entry.xhtml</code>. Note that this is a little bit contrived, it would
                have been easier to use pull-style MVC here as well. </p>
         <p> The <code class="literal">entryAction</code> component works much like an action class in a traditional
                push-MVC action-oriented framework like Struts: </p>
         <div class="example">
            <a id="d0e2135"/>
            <div class="example-contents">
               <pre class="programlisting">@Name("entryAction")
@Scope(STATELESS)
public class EntryAction
{
   @In(create=true) 
   private Blog blog;
   
   @Out
   private BlogEntry blogEntry;
   
   public void loadBlogEntry(String id) throws EntryNotFoundException
   {
      blogEntry = blog.getBlogEntry(id);
      if (blogEntry==null) throw new EntryNotFoundException(id);
   }
   
}</pre>
            </div>
            <p class="title">
               <b>Example 1.34. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> Page actions are also declared in <code class="literal">pages.xml</code>: </p>
         <div class="example">
            <a id="d0e2144"/>
            <div class="example-contents">
               <pre class="programlisting">&lt;pages&gt;
   ...

   &lt;page view-id="/entry.xhtml" action="#{entryAction.loadBlogEntry(blogEntry.id)}"&gt;
      &lt;param name="blogEntryId" value="#{blogEntry.id}"/&gt;
   &lt;/page&gt;

   &lt;page view-id="/post.xhtml" action="#{loginAction.challenge}"/&gt;

   &lt;page view-id="*" action="#{blog.hitCount.hit}"/&gt;

&lt;/pages&gt;</pre>
            </div>
            <p class="title">
               <b>Example 1.35. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> Notice that the example is using page actions for some other functionality—the login
                challenge, and the pageview counter. Also notice the use of a parameter in the page action method
                binding. This is not a standard feature of JSF EL, but Seam lets you use it, not just for page actions,
                but also in JSF method bindings. </p>
         <p> When the <code class="literal">entry.xhtml</code> page is requested, Seam first binds the page parameter
                    <code class="literal">blogEntryId</code> to the model, then runs the page action, which retrieves the needed
                data—the <code class="literal">blogEntry</code>—and places it in the Seam event context.
                Finally, the following is rendered: </p>
         <div class="example">
            <a id="d0e2161"/>
            <div class="example-contents">
               <pre class="programlisting">&lt;div class="blogEntry"&gt;
   &lt;h3&gt;#{blogEntry.title}&lt;/h3&gt;
   &lt;div&gt;
      &lt;h:outputText escape="false" value="#{blogEntry.body}"/&gt;
   &lt;/div&gt;
   &lt;p&gt;
      [Posted on&amp;#160;
      &lt;h:outputText value="#{blogEntry.date}"&gt;
         &lt;f:convertDateTime timezone="#{blog.timeZone}" 
                            locale="#{blog.locale}" type="both"/&gt;
      &lt;/h:outputText&gt;]
   &lt;/p&gt;
&lt;/div&gt;</pre>
            </div>
            <p class="title">
               <b>Example 1.36. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> If the blog entry is not found in the database, the <code class="literal">EntryNotFoundException</code>
                exception is thrown. We want this exception to result in a 404 error, not a 505, so we annotate the
                exception class: </p>
         <div class="example">
            <a id="d0e2170"/>
            <div class="example-contents">
               <pre class="programlisting">@ApplicationException(rollback=true)
@HttpError(errorCode=HttpServletResponse.SC_NOT_FOUND)
public class EntryNotFoundException extends Exception
{
   EntryNotFoundException(String id)
   {
      super("entry not found: " + id);
   }
}</pre>
            </div>
            <p class="title">
               <b>Example 1.37. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> An alternative implementation of the example does not use the parameter in the method binding: </p>
         <div class="example">
            <a id="d0e2176"/>
            <div class="example-contents">
               <pre class="programlisting">@Name("entryAction")
@Scope(STATELESS)
public class EntryAction
{
   @In(create=true) 
   private Blog blog;
   
   @In @Out
   private BlogEntry blogEntry;
   
   public void loadBlogEntry() throws EntryNotFoundException
   {
      blogEntry = blog.getBlogEntry( blogEntry.getId() );
      if (blogEntry==null) throw new EntryNotFoundException(id);
   }
   
}</pre>
               <pre class="programlisting">&lt;pages&gt;
   ...

   &lt;page view-id="/entry.xhtml" action="#{entryAction.loadBlogEntry}"&gt;
      &lt;param name="blogEntryId" value="#{blogEntry.id}"/&gt;
   &lt;/page&gt;
   
   ...
&lt;/pages&gt;</pre>
            </div>
            <p class="title">
               <b>Example 1.38. </b>
            </p>
         </div>
         <br class="example-break"/>
         <p> It is a matter of taste which implementation you prefer. </p>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="ch01s09s02.html">
               <strong>Prev</strong>1.9.2. Bookmarkable search results page</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="gettingstarted.html">
               <strong>Next</strong>Chapter 2. Getting started with Seam, using seam-...</a>
         </li>
      </ul>
   </body>
</html>