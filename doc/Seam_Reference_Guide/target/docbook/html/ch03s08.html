<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <title>3.8. Factory and manager components</title>
      <link rel="stylesheet" href="css/jbossorg.css" type="text/css"/>
      <meta name="generator" content="DocBook XSL Stylesheets V1.72.0"/>
      <link rel="start" href="index.html" title="Seam - Contextual Components"/>
      <link rel="up" href="concepts.html" title="Chapter 3. The contextual component model"/>
      <link rel="prev" href="ch03s07.html" title="3.7. The Mutable interface and @ReadOnly"/>
      <link rel="next" href="xml.html" title="Chapter 4. Configuring Seam components"/>
   </head>
   <body>
      <p id="title">
         <a href="http://www.jboss.org" class="jbossOrg_href">
            <strong>
						        JBoss.org	
						</strong>
         </a>
         <a href="http://labs.jboss.com/projects/docs" class="commDoc_href">
            <strong>
						        Community Documentation	
						</strong>
         </a>
      </p>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="ch03s07.html">
               <strong>Prev</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="xml.html">
               <strong>Next</strong>
            </a>
         </li>
      </ul>
      <div class="sect1" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title">
                     <a id="d0e3406"/>3.8. Factory and manager components</h2>
               </div>
            </div>
         </div>
         <p> 
            We often need to work with objects that are not Seam components. But we still want to be able to inject
            them into our components using <code class="literal">@In</code> and use them in value and method binding expressions,
            etc. Sometimes, we even need to tie them into the Seam context lifecycle (<code class="literal">@Destroy</code>, for
            example). So the Seam contexts can contain objects which are not Seam components, and Seam provides a couple
            of nice features that make it easier to work with non-component objects bound to contexts. 
        </p>
         <p> 
            The <span class="emphasis">
               <em>factory component pattern</em>
            </span> lets a Seam component act as the instantiator for a
            non-component object. A <span class="emphasis">
               <em>factory method</em>
            </span> will be called when a context variable is
            referenced but has no value bound to it. We define factory methods using the <code class="literal">@Factory</code>
            annotation. The factory method binds a value to the context variable, and determines the scope of the bound
            value. There are two styles of factory method. The first style returns a value, which is bound to the
            context by Seam:
        </p>
         <pre class="programlisting">@Factory(scope=CONVERSATION)
public List&lt;Customer&gt; getCustomerList() { 
    return ... ;
} </pre>
         <p> 
            The second style is a method of type <code class="literal">void</code> which binds the value to the context
            variable itself: 
        </p>
         <pre class="programlisting">@DataModel List&lt;Customer&gt; customerList;

@Factory("customerList")
public void initCustomerList() { 
    customerList = ...  ;
} </pre>
         <p> 
            In both cases, the factory method is called when we reference the <code class="literal">customerList</code> context
            variable and its value is null, and then has no further part to play in the lifecycle of the value. An even
            more powerful pattern is the <span class="emphasis">
               <em>manager component pattern</em>
            </span>. In this case, we have a Seam
            component that is bound to a context variable, that manages the value of the context variable, while
            remaining invisible to clients. 
        </p>
         <p> 
            A manager component is any component with an <code class="literal">@Unwrap</code> method. This method returns the
            value that will be visable to clients, and is called <span class="emphasis">
               <em>every time</em>
            </span> a context variable is
            referenced. 
        </p>
         <pre class="programlisting">@Name("customerList")
@Scope(CONVERSATION)
public class CustomerListManager
{
    ...
    
    @Unwrap
    public List&lt;Customer&gt; getCustomerList() { 
        return ... ;
    }
}</pre>
         <p> 
            The manager component pattern is especially useful if we have an object where you need more control over the 
            lifecycle of the component.  For example, if you have a heavyweight object that needs a cleanup operation when 
            the context ends you could <code class="literal">@Unwrap</code> the object, and perform cleanup in the 
            <code class="literal">@Destroy</code> method of the manager component.
        </p>
         <pre class="programlisting">@Name("hens")
@Scope(APPLICATION) 
public class HenHouse {
    
    Set&lt;Hen&gt; hens;
    
    @In(required=false) Hen hen;
    
    @Unwrap
    public List&lt;Hen&gt; getHens() {
        if (hens == null) {
            // Setup our hens
        }
        return hens;
    }
    
    @Observer({"chickBorn", "chickenBoughtAtMarket"})
    public addHen() {
        hens.add(hen);
    }
    
    @Observer("chickenSoldAtMarket")
    public removeHen() {
        hens.remove(hen);
    }
    
    @Observer("foxGetsIn")
    public removeAllHens() {
        hens.clear();
    }
    ...
} </pre>
         <p>
		Here the managed component observes many events which change the underlying object. 
		The component manages these actions itself, and because the object is unwrapped
		on every access, a consistent view is provided.
	</p>
      </div>
      <ul class="docnav">
         <li class="previous">
            <a accesskey="p" href="ch03s07.html">
               <strong>Prev</strong>3.7. The Mutable interface and @ReadOnly</a>
         </li>
         <li class="up">
            <a accesskey="u" href="#">
               <strong>Top of page</strong>
            </a>
         </li>
         <li class="home">
            <a accesskey="h" href="index.html">
               <strong>Front page</strong>
            </a>
         </li>
         <li class="next">
            <a accesskey="n" href="xml.html">
               <strong>Next</strong>Chapter 4. Configuring Seam components</a>
         </li>
      </ul>
   </body>
</html>