<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:s="http://jboss.com/products/seam/taglib">

  <ui:composition template="template.xhtml">
    <ui:define name="content">
      
      <div class="errors"><h:messages globalOnly="true"/></div>     

      <s:div rendered="#{selectedMember == null}">
        Sorry, but this member does not exist.
      </s:div>
    
      <s:div rendered="#{selectedMember != null}">
      
        <s:div id="memberCard">
          <h1>#{selectedMember.memberName}'s profile</h1>
                    
          <s:div id="memberCardPicture" rendered="#{selectedMember.picture != null}">
            <s:graphicImage value="#{selectedMember.picture.data}" width="170" contentType="image/png" maintainRatio="true" fileName="member/#{selectedMember.memberName}" rendered="#{not empty selectedMember.picture}"/>
            <s:graphicImage value="/images/no_image.png" width="170" contentType="image/png" maintainRatio="true" key="member/no_image" rendered="#{empty selectedMember.picture}"/>
          </s:div>
          
          <div id="memberCardText">
            <span class="tagline">"#{selectedMember.tagline}"</span><br/><br/>
            #{selectedMember.gender.descr}<br/>
            #{selectedMember.age}<br/>
            #{selectedMember.location}<br/>
          </div>
          
          <br style="clear:both"/>
          
          View My: Pics
          
        </s:div>
        
        <s:div id="memberBlog">
          <div class="sectionHeader">#{selectedMember.memberName}'s latest blog entries</div>
          
          <ui:repeat value="#{profile.latestBlogs}" var="latestBlog">
            <div class="blogSummary">#{latestBlog.title} 
              (<s:link view="/blogentry.seam" value="view more"/>)
            </div>
          </ui:repeat>            
          
          [<s:link view="/blog.seam" value="View all blog entries" propagation="none"/>]
          
          <s:span rendered="#{s:hasPermission('blog', 'create', selectedMember)}">
            [<s:link action="#{blog.createEntry}" value="Create new blog entry" propagation="none"/>]
          </s:span>
        </s:div>
        
        <s:div id="memberFriends">
          <div class="sectionHeader">#{selectedMember.memberName}'s friends</div>
          
          <ui:repeat value="#{profile.friends}" var="f">
            <div class="friend">
              
              <s:link view="/profile.seam" propagation="none">
                <f:param name="name" value="#{f.memberName}"/>
                #{f.memberName}<br/>
                <s:graphicImage value="#{f.picture.data}" width="90" contentType="image/png" maintainRatio="true" fileName="member/#{f.memberName}" rendered="#{not empty f.picture}"/>
            	<s:graphicImage value="/images/no_image.png" width="90" contentType="image/png" maintainRatio="true" key="member/no_image" rendered="#{empty f.picture}"/>
              </s:link>
              
            </div>          
          </ui:repeat>          
          
          <br class="clear"/>
        
          <s:span rendered="#{selectedMember.memberId != authenticatedMember.memberId and s:hasPermission('friendRequest', 'create', selectedMember.friends)}">
            [<s:link view="/friendrequest.seam" value="Send a friend request" propagation="none"/>]
          </s:span>
          
        </s:div>
        
        <s:div id="friendComments">
          <div class="sectionHeader">#{selectedMember.memberName}'s friend's comments</div>
          
	        <ui:repeat value="#{profile.friendComments}" var="c">
	          <table class="friendComments">
	            <tr>
		            <td class="friendCommentor">					        
					        <s:link view="/profile.seam">
					          <f:param name="name" value="#{c.friend.memberName}"/>
					          #{c.friend.memberName}<br/>
	                          <s:graphicImage value="#{c.friend.picture.data}" width="90" contentType="image/png" maintainRatio="true" fileName="member/#{c.friend.memberName}" rendered="#{not empty c.friend.picture}"/>
       			           	  <s:graphicImage value="/images/no_image.png" width="90" contentType="image/png" maintainRatio="true" key="member/no_image" rendered="#{empty c.friend.picture}"/>
					        </s:link>
		            </td>
		            
		            <td style="text-align: left">
                  <b>#{c.formattedCommentDate}</b><br/>
		              <p><s:formattedText value="#{c.comment}"/></p>
		            </td>	            
	            </tr>
	          </table>	          	          
	        </ui:repeat>            
          
          <s:span rendered="#{s:hasPermission('friendComment', 'create', selectedMember.friends)}">            
            [<s:link view="/friendcomment.seam" value="Add Comment"/>]
          </s:span>          
        </s:div>        
      </s:div>                
          
    </ui:define>
    
  </ui:composition>
</html>
