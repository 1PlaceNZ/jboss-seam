<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html">
<body>
    <ui:composition template="/WEB-INF/template.xhtml">
        <ui:define name="topnav">
            <ui:include src="/WEB-INF/incl/admin_nav.xhtml" />
        </ui:define>

        <ui:define name="sidebar">
            <ui:include src="/WEB-INF/incl/login.xhtml" />
            <ui:include src="/WEB-INF/incl/stats.xhtml" />
            <ui:include src="/WEB-INF/incl/processmenu.xhtml" />
        </ui:define>
        
        <ui:define name="body">
            <c:if test="${currentUserIsAdmin}">
            <h1>Order Management</h1>
            
            <p>
                Pending orders are shown here on the order management
                screen for the store manager to process.  Rather than
                being data-driven, order management is process-driven.
                A JBoss jBPM process assigns fulfillment tasks to the
                manager based on the version of the process loaded.
                The manager can change the version of the process at
                any time using the admin options box to the right.  
            </p>

            <ul>
                <li>
                Order process 1 sends orders immediately to shipping,
                where the manager should ship the order and record the
                tracking number for the user to see.</li>
                <li>Order process 2 adds an approval
                step where the manager is first given the chance to approve
                the order before sending it to shipping.  In each case,
                the status of the order is shown in the customer's order
                list.</li>
                <li>Order process 3 introduces a decision node.  Only orders over $100.00
                need to be accepted.  Smaller orders are automatically approved
                for shipping.
                </li>
            </ul>
            
            <h2>Task Assignment</h2>
            <c:choose>
                <c:when test="${empty pooledTaskInstanceList}">
                    <p>There are no pooled tasks to be assigned.</p>
                </c:when>
                <c:otherwise>      
                    <h:dataTable value="#{pooledTaskInstanceList}"
                                 var="task" 
                                 styleClass="dvdtable" 
                                 headerClass="dvdtablehead"
                                 rowClasses="dvdtableodd,dvdtableeven"
                                 columnClasses="dvdtablecol">
                        <h:column>
                            <f:facet name="header">
                                Order Id
                            </f:facet>
                            #{task.taskMgmtInstance.processInstance.contextInstance.variables['orderId']}
                        </h:column>
                        <h:column>
                            <f:facet name="header">
                                Order Amount
                            </f:facet>
                            <h:outputText value="#{task.taskMgmtInstance.processInstance.contextInstance.variables['amount']}">
                                <f:convertNumber type="currency" currencySymbol="$" />
                            </h:outputText>
                        </h:column>
                        <h:column>
                            <f:facet name="header">
                                Customer
                            </f:facet>
                            <h:outputText value="#{task.taskMgmtInstance.processInstance.contextInstance.variables['customer']}" />
                        </h:column>
                        <h:column>
                            <h:commandLink action="#{pooledTask.assignToCurrentActor}"> 
                                <h:commandButton value="Assign"/>
                                <f:param name="taskId" value="#{task.id}"/>
                            </h:commandLink>
                        </h:column>
                        	
                    </h:dataTable>
                </c:otherwise>
            </c:choose>

            <h2>Order Acceptance</h2>
            <c:choose>
                <c:when test="${empty taskInstanceListForType['approve']}">
                    <p>There are no orders to be accepted.</p>
                </c:when>
                <c:otherwise>      
                    <h:dataTable value="#{taskInstanceListForType['approve']}"
                                 var="task" 
                                 styleClass="dvdtable" 
                                 headerClass="dvdtablehead"
                                 rowClasses="dvdtableodd,dvdtableeven"
                                 columnClasses="dvdtablecol">
                        <h:column>
                            <f:facet name="header">
                                Order Id
                            </f:facet>
                            #{task.taskMgmtInstance.processInstance.contextInstance.variables['orderId']}
                        </h:column>
                        <h:column>
                            <f:facet name="header">
                                Order Amount
                            </f:facet>
                            <h:outputText value="#{task.taskMgmtInstance.processInstance.contextInstance.variables['amount']}">
                                <f:convertNumber type="currency" currencySymbol="$" />
                            </h:outputText>
                        </h:column>
                        <h:column>
                            <f:facet name="header">
                                Customer
                            </f:facet>
                            <h:outputText value="#{task.taskMgmtInstance.processInstance.contextInstance.variables['customer']}" />
                        </h:column>
                        <h:column>
                            <h:commandLink action="#{accept.viewTask}"> 
                                <h:commandButton value="Review"/>
                                <f:param name="taskId" value="#{task.id}"/>
                            </h:commandLink>
                        </h:column>
               
                    </h:dataTable>
                </c:otherwise>
            </c:choose>


            <h2>Shipping</h2>
            <c:choose>
                <c:when test="${empty taskInstanceListForType['ship']}">
                    <p>There are no orders to be shipped.</p>
                </c:when>
                <c:otherwise>
                    <h:dataTable value="#{taskInstanceListForType['ship']}"
                                 var="task" 
                                 styleClass="dvdtable" 
                                 headerClass="dvdtablehead"
                                 rowClasses="dvdtableodd,dvdtableeven"
                                 columnClasses="dvdtablecol">
                        
                        <h:column>
                            <f:facet name="header">
                                Order Id
                            </f:facet>
                            #{task.taskMgmtInstance.processInstance.contextInstance.variables['orderId']}
                        </h:column>
                        <h:column>
                            <f:facet name="header">
                                Order Amount
                            </f:facet>
                            <h:outputText value="#{task.taskMgmtInstance.processInstance.contextInstance.variables['amount']}">
                                <f:convertNumber type="currency" currencySymbol="$" />
                            </h:outputText>
                        </h:column>
                        <h:column>
                            <f:facet name="header">
                                Customer
                            </f:facet>
                            <h:outputText value="#{task.taskMgmtInstance.processInstance.contextInstance.variables['customer']}" />
                        </h:column>
                        <h:column>
                            <h:commandLink action="#{ship.viewTask}"> 
                                <h:commandButton value="Ship"/>
                                <f:param name="taskId" value="#{task.id}"/>
                            </h:commandLink>
                        </h:column>               
                    </h:dataTable>
                </c:otherwise>
            </c:choose>
        </c:if>
        </ui:define>
    </ui:composition>
</body>
</html>




