<?xml version="1.0" encoding="UTF-8"?>

<project name="DVDStore" default="deploy" basedir=".">
    <property name="Name"         value="Seam DVD Store"/>
    <property name="example.name" value="dvd"/>
    
    <property name="src.java.dir" location="src" />
    <property name="src.test.dir" location="src"/>

    <property name="dd.dir"       location="dd" />

    <property name="extlib.dir"   location="lib" />
    <property name="web.dir"      location="web" />

    <fileset id="example.deploy" dir="db">
        <include name="dvd-ds.xml"/> 
    </fileset>

    <patternset id="example.undeploy">
        <include name="dvd-ds.xml"/> 
    </patternset>

    <import file="../../build.xml"/>
    
    <target name="war" depends="compile">
        <war destfile="${build.dir}/dvd.war" 
             webxml="dd/web/web.xml">
            <webinf dir="dd/web">
                <include name="jboss-web.xml" />
                <include name="faces-config.xml" />
            </webinf>
            <lib dir="${extlib.dir}"> 
                <include name="standard.jar" />
                <include name="el-*.jar" />
                <include name="jsf-facelets.jar" />
            </lib>
            <fileset dir="${web.dir}"/>
        </war>
    </target>

    <target name="ejb3jar" depends="compile">
        <mkdir dir="${build.dir}"/>
        
        <jar destfile="${build.dir}/dvd.jar" >
            <metainf dir="dd/ejb3">
                <include name="persistence.xml" />
            </metainf>
            
            <fileset dir="dd/ejb3">
                <include name="import.sql"/>
                <include name="seam.properties"/>
            </fileset>

            <fileset dir="${classes.dir}">
                <include name="**/*.class"/>
            </fileset>
            <fileset dir="${imported.basedir}">
                <include name="jboss-seam.jar"/>
            </fileset>
            <fileset dir="${imported.basedir}/lib">
                <include name="jbpm*.jar" />
            </fileset>
        </jar>
    </target>



    <target name="ear" depends="war,ejb3jar">
        <mkdir dir="${build.dir}"/>
        <ear destfile="${build.dir}/dvd.ear" 
             appxml="dd/ear/application.xml">
            <metainf dir="dd/ear">
                <include name="jboss-app.xml" />
            </metainf>                
            <fileset dir="dd/ear">
                <include name="*.jpdl.xml"/>
            	<include name="jbpm.cfg.xml"/>
            	<include name="hibernate.cfg.xml"/>
            </fileset>

            <fileset dir="${build.dir}" 
                     includes="*.jar, *.par, *.war, *.sar, *.beans"/>
            <fileset dir="dd/ear"
                     includes="dvd-*.xml" />
        </ear>
    </target>

    <target name="deploy" depends="ear">
        <antcall target="Seam.deploy"/>
    </target>

    <target name="undeploy">
        <antcall target="Seam.undeploy"/>
    </target>


    <target name="deploy.par">
        <taskdef name="deploypar" classname="org.jbpm.jpdl.par.ProcessArchiveDeployer">
            <classpath> 
                <path refid="build.classpath" />
                <fileset dir="/Users/orb/proj/jboss/jboss-head/build/output/jboss-5.0.0alpha/lib/">
                    <include name="commons-logging.jar" />
                </fileset>
            </classpath>
        </taskdef>  
        <deploypar par="build/myprocess.par" /> 
    </target>

</project>

