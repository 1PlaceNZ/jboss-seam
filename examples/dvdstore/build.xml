<?xml version="1.0" encoding="UTF-8"?>

<project name="DVDStore" default="deploy" basedir=".">
    <property name="Name"         value="Seam DVD Store"/>
    <property name="example.name" value="dvd"/>
    
    <property name="src.java.dir" location="src" />

    <property name="dd.dir"       location="dd" />

    <property name="extlib.dir"   location="lib" />
    <property name="web.dir"      location="web" />

    <fileset id="example.deploy"
            dir="db">
        <include name="dvd-ds.xml"/>
    </fileset>

    <patternset id="example.undeploy">
        <include name="dvd-ds.xml"/>
    </patternset>

    <import file="../../build.xml"/>
    
    <target name="war" depends="compile">
        <war destfile="${build.dir}/dvd.war" 
             webxml="dd/web/web.xml">
            <webinf dir="dd/web">
                <include name="jboss-web.xml" />
                <include name="faces-config.xml" />
            </webinf>
            <lib dir="${extlib.dir}"> 
                <include name="standard.jar" />
            </lib>

            <!-- workaround for MyFaces bug in 4.0.3RC* -->
            <lib dir="${jboss.home}/server/default/deploy/jbossweb-tomcat55.sar/jsf-libs/">
                <include name="myfaces-impl.jar" />
            </lib>

            <classes dir="${classes.dir}">
                <include name="**/web/**/*.class" />
            </classes>
            <fileset dir="${web.dir}"/>
        </war>
    </target>

    <target name="ejb3jar" depends="compile">
        <mkdir dir="${build.dir}"/>
        
        <jar destfile="${build.dir}/dvd.ejb3" >
            <metainf dir="dd/ejb3">
                <include name="persistence.xml" />
            </metainf>
            <fileset dir="dd/ejb3">
                <include name="import.sql"/>
                <include name="seam.properties"/>
            </fileset>
            <fileset dir="${classes.dir}">
                <include name="**/ejb/**/*.class"/>
            </fileset>
            <fileset dir="${imported.basedir}">
                <include name="jboss-seam.jar"/>
            </fileset>
        </jar>
    </target>



    <target name="ear" depends="war,ejb3jar">
        <mkdir dir="${build.dir}"/>
        
        <ear destfile="${build.dir}/dvd.ear" 
             appxml="dd/ear/application.xml">
            <metainf dir="dd/ear">
                <include name="jboss-app.xml" />
            </metainf>                
            <fileset dir="${build.dir}" 
                     includes="*.ejb3, *.par, *.war, *.sar"/>
            <fileset dir="dd/ear"
                     includes="dvd-*.xml" />
        </ear>
    </target>




    <target name="deploy" depends="ear">
        <antcall target="Seam.deploy"/>
    </target>

    <target name="undeploy">
        <antcall target="Seam.undeploy"/>
    </target>

</project>
