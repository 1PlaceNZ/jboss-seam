<?xml version="1.0" encoding="UTF-8"?>

<project name="Hibernate Booking"
         default="main" basedir=".">
    
  <description>Hibernate Booking</description>
  <property name="projname" value="jboss-seam-hibernate" />

  <property file="../../build.properties"/>

  <property name="lib" location="../../lib" />
  <property name="applib" location="lib" />
  <property name="seamlib" location="../../" />
  <property name="hibernatelib" location="../../hibernate/lib" />
  <path id="lib.classpath">
    <fileset dir="${lib}" includes="*.jar"/>
    <fileset dir="${applib}" includes="*.jar"/>
    <fileset dir="${seamlib}" includes="*.jar"/>
  </path>
  
  <property name="resources" location="resources" />
  
  <property name="src" location="src" />
  <property name="view" location="view" />
  
  <property name="build.classes" location="build/classes" />
  <property name="build.jars" location="build/" />

  <target name="clean">
    <delete dir="build"/>
  </target>

  <target name="main" depends="deploy"/>

  <target name="compile">
    <mkdir dir="${build.classes}"/>
    <javac destdir="${build.classes}"
           classpathref="lib.classpath"
           debug="true">
      <src path="${src}"/>
    </javac>
  </target>
  
  <!-- Hibernate and Seam POJO on JBoss AS 4.2.0-->
  <target name="jboss" depends="compile">
    
    <mkdir dir="${build.jars}"/>
    
    <jar destfile="${build.jars}/${projname}.jar">
      <fileset dir="${build.classes}">
        <include name="**/*.class"/>
      </fileset>
      <fileset dir="${resources}">
        <include name="seam.properties" />
        <include name="import.sql" />
        <include name="hibernate.cfg.xml" />
      </fileset>
    </jar>

    <war destfile="${build.jars}/${projname}.war"
         webxml="${resources}/web.xml">
      <webinf dir="${resources}">
        <include name="faces-config.xml" />
        <include name="pages.xml" />
        <include name="jboss-web.xml" />
        <include name="components.xml" />
      </webinf>
      <lib dir="${seamlib}">
        <include name="jboss-seam.jar" />
        <include name="jboss-seam-ui.jar" />
        <include name="jboss-seam-debug.jar" />
      </lib>
      <lib dir="${lib}">
        <include name="ajax4jsf*.jar" />
        <include name="oscache-2.3.2.jar" />
        <include name="jboss-el.jar" />
        <include name="jsf-facelets.jar" />
        <include name="commons*.jar" />
      </lib>
      <lib dir="${build.jars}">
        <include name="${projname}.jar" />
      </lib>
      <fileset dir="${view}"/>
    </war>
  </target>
  
  <!--
    Works for JBoss 4.0.5 by default
    
    See notes for which JARs to add for JBoss AS 4.0.2 to 4.0.4
    
    JBoss AS 4.0.0: need to remove cglib.jar and hibernate2.jar from server/default/lib
      the isolated classloader in jboss-web.xml does not seem to work. If we force it
      in jbossweb*/META-INF/jboss-service.xml, the commons logging lib in thirdparty-all.jar
      will throw errors
  -->
  <target name="jboss405" depends="compile">
    
    <mkdir dir="${build.jars}"/>
    
    <jar destfile="${build.jars}/${projname}.jar">
      <fileset dir="${build.classes}">
        <include name="**/*.class"/>
      </fileset>
      <fileset dir="${resources}">
        <include name="seam.properties" />
        <include name="import.sql" />
        <include name="hibernate.cfg.xml" />
      </fileset>
    </jar>

    <war destfile="${build.jars}/${projname}.war"
         webxml="${resources}/web.xml">
      <webinf dir="${resources}">
        <include name="faces-config.xml" />
        <include name="pages.xml" />
        <include name="jboss-web.xml" />
        <include name="components.xml" />
      </webinf>
      <lib dir="${seamlib}">
        <include name="jboss-seam.jar" />
        <include name="jboss-seam-ui.jar" />
        <include name="jboss-seam-debug.jar" />
      </lib>
      <lib dir="${applib}">
        <!-- do not need the following for 4.0.4 and 4.0.5
        <include name="cglib.jar" />
        -->
        <include name="el-api.jar" />
        <include name="el-ri.jar" />
      </lib>
      <!--
      <lib dir="${hibernatelib}">
        <include name="*.jar" />
      </lib>
      -->
      <lib dir="${lib}">
        <include name="ajax4jsf*.jar" />
        <include name="oscache-2.3.2.jar" />
        <include name="jboss-el.jar" />
        <include name="jsf-facelets.jar" />
        <include name="commons*.jar" />
        <include name="hibernate-all.jar" />
        <include name="jsf-api.jar" />
        <include name="jsf-impl.jar" />
      </lib>
      <lib dir="${build.jars}">
        <include name="${projname}.jar" />
      </lib>
      <fileset dir="${view}"/>
    </war>
  </target>
  
  <target name="weblogic" depends="compile">
    
    <mkdir dir="${build.jars}"/>
    
    <jar destfile="${build.jars}/${projname}.jar">
      <fileset dir="${build.classes}">
        <include name="**/*.class"/>
      </fileset>
      <fileset dir="${resources}">
        <include name="seam.properties" />
        <include name="import.sql" />
      </fileset>
      <fileset dir="${resources}/weblogic">
        <include name="hibernate.cfg.xml" />
      </fileset>
    </jar>
    
    <war destfile="${build.jars}/${projname}.war"
         webxml="${resources}/web.xml">
      <webinf dir="${resources}">
        <include name="faces-config.xml" />
        <include name="pages.xml" />
      </webinf>
      <webinf dir="${resources}/weblogic">
        <include name="components.xml" />
      </webinf>
      <lib dir="${seamlib}">
        <include name="jboss-seam.jar" />
        <include name="jboss-seam-ui.jar" />
        <include name="jboss-seam-debug.jar" />
      </lib>
      <!-- WebLogic requires this since when the Sun listener starts up,
           it looks for Sun implementations for JSP files. -->
      <lib dir="${applib}">
        <include name="el-api.jar" />
        <include name="el-ri.jar" />
      </lib>
      <lib dir="${lib}">
        <include name="ajax4jsf*.jar" />
        <include name="oscache*.jar" />
        <include name="jboss-el.jar" />
        <include name="jboss-el-api.jar" />
        <include name="jsf-facelets.jar" />
        <include name="jsf-api.jar" />
        <include name="jsf-impl.jar" />
        <include name="thirdparty-all.jar" />
        <include name="commons*.jar" />
      </lib>
      <lib dir="${hibernatelib}">
        <include name="*.jar" />
      </lib>
      <lib dir="${build.jars}">
        <include name="${projname}.jar" />
      </lib>
      <classes dir="${resources}/weblogic">
        <include name="log4j.xml" />
      </classes>
      <fileset dir="${view}"/>
    </war>
  </target>
  
  <target name="websphere" depends="compile">
    
    <mkdir dir="${build.jars}"/>
    
    <jar destfile="${build.jars}/${projname}.jar">
      <fileset dir="${build.classes}">
        <include name="**/*.class"/>
      </fileset>
      <fileset dir="${resources}">
        <include name="seam.properties" />
        <include name="import.sql" />
      </fileset>
      <fileset dir="${resources}/websphere">
        <include name="hibernate.cfg.xml" />
      </fileset>
    </jar>
    
    <war destfile="${build.jars}/${projname}.war"
         webxml="${resources}/websphere/web.xml">
      <webinf dir="${resources}">
        <include name="faces-config.xml" />
        <include name="pages.xml" />
      </webinf>
      <webinf dir="${resources}/websphere">
        <include name="components.xml" />
      </webinf>
      <lib dir="${seamlib}">
        <include name="jboss-seam.jar" />
        <include name="jboss-seam-ui.jar" />
        <include name="jboss-seam-debug.jar" />
      </lib>
      <lib dir="${lib}">
        <include name="el-api.jar" />
        <include name="el-ri.jar" />
        <include name="ajax4jsf*.jar" />
        <include name="oscache*.jar" />
        <include name="jsf-facelets.jar" />
        <include name="jsf-api.jar" />
        <include name="jsf-impl.jar" />
        <include name="thirdparty-all.jar" />
        <include name="commons*.jar" />
      </lib>
      <lib dir="${hibernatelib}">
        <include name="*.jar" />
      </lib>
      <lib dir="${build.jars}">
        <include name="${projname}.jar" />
      </lib>
      <classes dir="${resources}/websphere">
        <include name="log4j.xml" />
      </classes>
      <fileset dir="${view}"/>
    </war>
  </target>
  
  <target name="glassfish" depends="compile">
    
    <mkdir dir="${build.jars}"/>
    
    <jar destfile="${build.jars}/${projname}.jar">
      <fileset dir="${build.classes}">
        <include name="**/*.class"/>
      </fileset>
      <fileset dir="${resources}">
        <include name="seam.properties" />
      </fileset>
      <fileset dir="${resources}/glassfish">
        <include name="hibernate.cfg.xml" />
        <include name="import.sql" />
      </fileset>
    </jar>
    
    <war destfile="${build.jars}/${projname}.war"
         webxml="${resources}/glassfish/web.xml">
      <webinf dir="${resources}">
        <include name="faces-config.xml" />
        <include name="pages.xml" />
      </webinf>
      <webinf dir="${resources}/glassfish">   
        <include name="components.xml" />
      </webinf>
      <lib dir="${seamlib}">
        <include name="jboss-seam.jar" />
        <include name="jboss-seam-ui.jar" />
        <include name="jboss-seam-debug.jar" />
      </lib>
      <lib dir="${lib}">
        <include name="jboss-el.jar" />
        <include name="ajax4jsf*.jar" />
        <include name="oscache*.jar" />
        <include name="jsf-facelets.jar" />
        <include name="thirdparty-all.jar" />
        <include name="commons*.jar" />
      </lib>
      <lib dir="${hibernatelib}">
        <include name="*.jar" />
      </lib>
      <lib dir="${build.jars}">
        <include name="${projname}.jar" />
      </lib>
      <classes dir="${resources}/glassfish">
        <include name="log4j.xml" />
        <include name="GlassfishDerbyDialect.class" />
      </classes>
      <fileset dir="${view}"/>
    </war>
  </target>
  
  <target name="deploy" depends="jboss">
    <copy file="${build.jars}/${projname}.war"
      todir="${jboss.home}/server/default/deploy"/>
  </target>
  
  <target name="undeploy">
    <delete
        file="${jboss.home}/server/default/deploy/${projname}.war"/>
  </target>

</project>
