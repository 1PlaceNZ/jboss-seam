<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                xmlns:rich="http://richfaces.ajax4jsf.org/rich"
                template="themes/#{globalPrefs.themeName}/template.xhtml">

<ui:define name="includeHeaders">
    <link href="#{themePath}/css/userControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/searchControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/mainMenu.css" rel="stylesheet" type="text/css"/>
</ui:define>

<ui:define name="screenname">
    <h:outputText value="Create directory" rendered="#{!directoryHome.managed}"/>
    <h:outputText value="Edit directory" rendered="#{directoryHome.managed}"/>
</ui:define>

<ui:define name="headerTopRight">
    <ui:include src="includes/userControl.xhtml"/>
</ui:define>

<ui:define name="headerBottomLeft">&#160;</ui:define>

<ui:define name="sidebar">
    <ui:include src="includes/searchControl.xhtml"/>
    <ui:include src="includes/mainMenu.xhtml"/>
</ui:define>

<ui:define name="controlRight">
    <s:link id="exit" styleClass="linkNavigation"
            action="#{directoryHome.exitConversation(true)}"
            accesskey="E"><u>E</u>xit Editor</s:link>
</ui:define>

<ui:define name="content">

<h:form>
<div class="form">
<div class="formHead">
    <h:outputText value="New directory: #{directoryHome.instance.name}"
                  rendered="#{!directoryHome.managed}"/>
    <h:outputText value="Editing directory: #{directoryHome.instance.name}"
                  rendered="#{directoryHome.managed}"/>
</div>

<div class="formFieldsWideLabels">

    <s:validateAll>

        <s:div styleClass="entry" rendered="#{!empty directoryHome.parentDirectory}">
            <div class="label">Parent:</div>
            <div class="output">
                <h:outputText value="#{directoryHome.parentDirectory}"/>
            </div>
        </s:div>

        <s:div styleClass="entry" rendered="#{directoryHome.managed}">
            <div class="label">Created On:</div>
            <div class="output">
                <h:outputText value="#{directoryHome.instance.createdOn}">
                    <f:convertDateTime type="both"/>
                </h:outputText>
                (#{directoryHome.instance.createdBy.username})
            </div>
        </s:div>

        <s:decorate>
            <div class="entry">
                <div class="label">Name:</div>
                <div class="input">
                    <h:inputText size="40" maxlength="255" id="name" required="true" tabindex="1"
                                 value="#{directoryHome.instance.name}"/>
                </div>
            </div>
        </s:decorate>

        <ui:include src="includes/accessLevelSelector.xhtml"/>

    </s:validateAll>

    <s:div styleClass="entry" rendered="#{directoryHome.managed}">
        <div class="label">Default document:</div>
        <div class="input">
            <h:selectOneMenu value="#{directoryHome.instance.defaultDocument}" converter="#{restrictedEntityConverter}" tabindex="2">
                <s:selectItems value="#{directoryHome.childDocuments}"
                               var="document"
                               label="#{document.name}"
                               noSelectionLabel="No default document"/>
            </h:selectOneMenu>
        </div>
    </s:div>

    <s:div styleClass="entry"
           rendered="#{childNodes.rowCount>0 and s:hasPermission('Node', 'editMenu', directoryHome.instance)}">
        <div class="label">Menu items:</div>
        <div class="input">
            <h:dataTable id="directoryFormTable" var="node" style="width:60%"
                         value="#{childNodes}"
                         binding="#{wikiUtil.datatable}"
                         styleClass="datatable"
                         columnClasses="onePercentColumn alignCenter, onePercentColumn alignCenter, onePercentColumn alignCenter,
                                        onePercentColumn alignCenter, defaultColumn alignLeft"
                         rowClasses="rowEven,rowOdd"
                         cellpadding="0" cellspacing="0" border="0">

                <h:column>
                    <h:commandLink id="nodeUp" tabindex="1"
                                   action="#{directoryHome.moveNodeUpInList}"
                                   rendered="#{wikiUtil.datatable.rowIndex > 0}">
                        <h:graphicImage value="/themes/#{globalPrefs.themeName}/img/up.gif" width="18" height="18"/>
                    </h:commandLink>
                </h:column>

                <h:column>
                    <h:commandLink id="nodeDown" tabindex="2"
                                   action="#{directoryHome.moveNodeDownInList}"
                                   rendered="#{wikiUtil.datatable.rowIndex+1 lt wikiUtil.datatable.rowCount}">
                        <h:graphicImage value="/themes/#{globalPrefs.themeName}/img/down.gif" width="18" height="18"/>
                    </h:commandLink>
                </h:column>

                <h:column>
                    <h:selectBooleanCheckbox value="#{node.menuItem}" tabindex="3"/>
                </h:column>

                <h:column>
                    <h:graphicImage value="/themes/#{globalPrefs.themeName}/img/icon.dir.gif"
                                    width="18" height="20"
                                    rendered="#{wiki:isDirectory(node)}"/>
                    <h:graphicImage value="/themes/#{globalPrefs.themeName}/img/icon.doc.gif"
                                    width="18" height="20"
                                    rendered="#{wiki:isDocument(node)}"/>

                    <h:graphicImage value="/themes/#{globalPrefs.themeName}/img/#{fileMetaMap[node.contentType].displayIcon}"
                                    width="18" height="20"
                                    rendered="#{wiki:isFile(node) and !empty fileMetaMap[node.contentType]}"/>
                    <h:graphicImage value="/themes/#{globalPrefs.themeName}/img/#{fileMetaMap['generic'].displayIcon}"
                                    width="18" height="20"
                                    rendered="#{wiki:isFile(node) and empty fileMetaMap[node.contentType]}"/>
                </h:column>

                <h:column>
                    <h:outputText value="#{node.name}"/>
                </h:column>

            </h:dataTable>
        </div>
    </s:div>

</div>
<div class="formControls">

    <div class="entry">
        <div class="label">&#160;</div>
        <div class="input">

            <h:commandLink id="preview" styleClass="buttonNonpersistent"
                           action="#{directoryHome.previewMenuItems()}"
                           rendered="#{childNodes.rowCount>0 and s:hasPermission('Node', 'editMenu', directoryHome.instance)}"
                           tabindex="5" accesskey="P"><span class="buttonLabel"><u>P</u>review</span></h:commandLink>
            
            <h:commandLink id="save" styleClass="button"
                           action="#{directoryHome.persist}"
                           rendered="#{!directoryHome.managed}"
                           tabindex="6" accesskey="S"><span class="buttonLabel"><u>S</u>ave</span></h:commandLink>

            <h:commandLink id="update" styleClass="button"
                           action="#{directoryHome.update}"
                           rendered="#{directoryHome.managed}"
                           tabindex="7" accesskey="U"><span class="buttonLabel"><u>U</u>pdate</span></h:commandLink>

            <h:outputLink id="delete" value="javascript:Richfaces.showModalPanel('deleteConfirmation',{})"
                          rendered="#{directoryHome.managed
                                     and !empty directoryHome.instance.parent
                                     and empty directoryHome.instance.children}"
                          tabindex="8" accesskey="D" styleClass="button"><span class="buttonLabel"><u>D</u>elete</span></h:outputLink>
        </div>
    </div>

</div>

</div>
</h:form>

<ui:decorate template="includes/confirmationModalDialog.xhtml">
    <ui:param name="confirmationModalDialogId" value="deleteConfirmation"/>
    <ui:define name="confirmationText">
        <p>Are you sure you want to delete the directory '#{directoryHome.instance.name}'?</p>
    </ui:define>
    <ui:define name="confirmationOption">
        <h:commandLink id="delete" action="#{directoryHome.remove}"
                       accesskey="O" styleClass="button">
            <span class="buttonLabel"><u>O</u>k</span>
        </h:commandLink>
    </ui:define>
</ui:decorate>

</ui:define>

<ui:define name="footer">&#160;</ui:define>

</ui:composition>

