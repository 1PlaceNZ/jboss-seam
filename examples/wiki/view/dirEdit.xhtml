<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                xmlns:j4j="http://javascript4jsf.dev.java.net/"
                xmlns:rich="http://richfaces.ajax4jsf.org/rich"
                xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                template="themes/#{wikiPreferences.themeName}/template.xhtml">

<ui:define name="includeHeaders">
    <link href="#{themePath}/css/userControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/searchControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/mainMenu.css" rel="stylesheet" type="text/css"/>
</ui:define>

<ui:define name="screenname">
    <h:outputText value="Create directory" rendered="#{!directoryHome.managed}"/>
    <h:outputText value="Edit directory" rendered="#{directoryHome.managed}"/>
</ui:define>

<ui:define name="headerTopRight">
    <ui:include src="includes/userControl.xhtml"/>
</ui:define>

<ui:define name="headerBottomLeft">&#160;</ui:define>

<ui:define name="sidebar">
    <ui:include src="includes/searchControl.xhtml"/>
    <ui:include src="includes/mainMenu.xhtml"/>
</ui:define>

<ui:define name="controlRight">
    <s:link id="exit" styleClass="linkNavigation"
            action="#{browser.exitConversation(true)}"
            accesskey="E"><u>E</u>xit Editor</s:link>
</ui:define>

<ui:define name="content">

<s:span rendered="#{s:hasPermission('User', 'isAdmin', currentUser) and directoryHome.managed}">
    <ui:include src="includes/ownerSelector.xhtml">
        <ui:param name="home" value="#{directoryHome}"/>
    </ui:include>
</s:span>

<s:span rendered="#{directoryHome.managed and !empty directoryHome.instance.parent}">
    <ui:include src="includes/deleteConfirmation.xhtml">
        <ui:param name="home" value="#{directoryHome}"/>
    </ui:include>
</s:span>


<h:form id="directoryEditForm">
<div class="form">
<div class="formHead">
    <h:outputText value="New directory: #{directoryHome.instance.name}"
                  rendered="#{!directoryHome.managed}"/>
    <h:outputText value="Editing directory: #{directoryHome.instance.name}"
                  rendered="#{directoryHome.managed}"/>
</div>

<div class="formFields formBorder">

    <s:validateAll>

        <s:div styleClass="entry" rendered="#{!empty directoryHome.parentDirectory}">
            <div class="label">Parent:</div>
            <div class="output">
                <h:outputText value="#{directoryHome.parentDirectory}"/>
            </div>
        </s:div>

        <s:div styleClass="entry" rendered="#{directoryHome.managed}">
            <div class="label">Created On:</div>
            <div class="output">
                <h:outputText value="#{directoryHome.instance.createdOn}">
                    <f:convertDateTime type="both" timeZone="#{wikiPreferences.timeZone}"/>
                </h:outputText>
                <s:span id="ownerDisplay">&#160;(#{directoryHome.instance.createdBy.username})</s:span>
                <h:outputLink id="selectOwner" value="#" tabindex="1" styleClass="buttonNonpersistent"
                              rendered="#{s:hasPermission('User', 'isAdmin', currentUser)}"><j4j:idProxy
                                id="openDialogOwnerSelection"/><span class="buttonLabel">...</span></h:outputLink>
            </div>
        </s:div>

        <s:decorate id="nameDecorate" template="includes/formFieldDecorate.xhtml">
            <ui:define name="label">Name</ui:define>
            <h:inputText size="40" maxlength="255" required="true" tabindex="1" value="#{directoryHome.instance.name}">
                <a:support event="onblur" reRender="nameDecorate"/>
            </h:inputText>
        </s:decorate>

        <ui:include src="includes/accessLevelSelector.xhtml"/>

    </s:validateAll>

    <s:div styleClass="entry" rendered="#{directoryHome.managed and !empty directoryHome.instance.parent}">
        <div class="label">Default document:</div>
        <div class="input">
            <h:selectOneMenu value="#{directoryHome.instance.defaultDocument}" converter="#{restrictedEntityConverter}" tabindex="2">
                <s:selectItems value="#{directoryHome.childDocuments}"
                               var="document"
                               label="#{document.name}"
                               noSelectionLabel="No default document"/>
            </h:selectOneMenu>
        </div>
    </s:div>

    <rich:dragIndicator id="rowDragIndicator"/>

    <s:div styleClass="entry"
           rendered="#{childNodes.rowCount>0 and s:hasPermission('Node', 'editMenu', directoryHome.instance)}">
        <div class="label">Menu items:</div>
        <div class="input">
            <h:dataTable id="directoryFormTable" var="node" style="width:50%"
                         value="#{childNodes}"
                         binding="#{wikiUtil.datatable}"
                         styleClass="datatable"
                         columnClasses="onePercentColumn alignCenter, onePercentColumn alignCenter, defaultColumn alignLeft"
                         rowClasses="rowEven,rowOdd"
                         cellpadding="0" cellspacing="0" border="0">

                <h:column>
                    <h:selectBooleanCheckbox value="#{node.menuItem}" tabindex="3"/>
                </h:column>

                <h:column>
                    <a:outputPanel>
                        <rich:dragSupport dragIndicator=":directoryEditForm:rowDragIndicator"
                                          dragType="node"
                                          dragValue="#{node}">
                            <rich:dndParam name="label" type="drag"><h:outputText value="#{node.name}"/></rich:dndParam>
                        </rich:dragSupport>
                        <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/icon.dir.gif"
                                        width="18" height="20" style="cursor:move"
                                        rendered="#{wiki:isDirectory(node)}"/>
                        <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/icon.doc.gif"
                                        width="18" height="20" style="cursor:move"
                                        rendered="#{wiki:isDocument(node)}"/>

                        <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/#{fileMetaMap[node.contentType].displayIcon}"
                                        width="18" height="20" style="cursor:move"
                                        rendered="#{wiki:isFile(node) and !empty fileMetaMap[node.contentType]}"/>
                        <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/#{fileMetaMap['generic'].displayIcon}"
                                        width="18" height="20" style="cursor:move"
                                        rendered="#{wiki:isFile(node) and empty fileMetaMap[node.contentType]}"/>
                    </a:outputPanel>
                </h:column>

                <h:column>
                    <a:outputPanel>
                        <rich:dropSupport id="dropZone" acceptedTypes="node" reRender="directoryFormTable"
                                          dropListener="#{directoryHome.dropMenuItem}" dropValue="#{wikiUtil.datatable.rowIndex}"/>
                        <rich:dragSupport dragIndicator=":directoryEditForm:rowDragIndicator"
                                          dragType="node"
                                          dragValue="#{node}">
                            <rich:dndParam name="label" type="drag"><h:outputText value="#{node.name}"/></rich:dndParam>
                        </rich:dragSupport>
                        <h:outputText value="#{node.name}" style="cursor:move"/>
                    </a:outputPanel>
                </h:column>

            </h:dataTable>
        </div>
    </s:div>

    <s:div styleClass="entry">
        <div class="label">&#160;</div>
        <div class="input">
            <h:selectBooleanCheckbox value="#{directoryHome.hasFeed}" tabindex="2"
                                     disabled="#{empty directoryHome.instance.parent}"/>
            Enable syndication feed (disabling invalidates subcriber link)
            <a:commandLink id="resetFeed" reRender="messageBox"
                           action="#{directoryHome.resetFeed}"
                           rendered="#{!empty directoryHome.instance.feed}"
                           styleClass="buttonNonpersistent"><span class="buttonLabel">Reset Feed</span></a:commandLink>
        </div>
    </s:div>

</div>
<div class="formControls wideLabels">

    <div class="entry">
        <div class="label">&#160;</div>
        <div class="input">

            <h:commandLink id="preview" styleClass="buttonNonpersistent"
                           action="#{directoryHome.previewMenuItems()}"
                           rendered="#{childNodes.rowCount>0 and s:hasPermission('Node', 'editMenu', directoryHome.instance)}"
                           tabindex="5" accesskey="P"><span class="buttonLabel"><u>P</u>review</span></h:commandLink>
            
            <h:commandLink id="save" styleClass="button"
                           action="#{directoryHome.persist}"
                           rendered="#{!directoryHome.managed}"
                           tabindex="6" accesskey="S"><span class="buttonLabel"><u>S</u>ave</span></h:commandLink>

            <h:commandLink id="update" styleClass="button"
                           action="#{directoryHome.update}"
                           rendered="#{directoryHome.managed}"
                           tabindex="7" accesskey="U"><span class="buttonLabel"><u>U</u>pdate</span></h:commandLink>

            <h:outputLink id="delete" value="#" tabindex="8" accesskey="D" styleClass="button"
                          rendered="#{directoryHome.managed and !empty directoryHome.instance.parent}"><j4j:idProxy
                    id="openDialogDelete"/><span class="buttonLabel"><u>D</u>elete</span></h:outputLink>

        </div>
    </div>

</div>

</div>
</h:form>

</ui:define>

<ui:define name="footer">&#160;</ui:define>

</ui:composition>

