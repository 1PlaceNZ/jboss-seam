<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                xmlns:j4j="http://javascript4jsf.dev.java.net/"
                xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                template="themes/#{wikiPreferences.themeName}/template.xhtml">

<ui:define name="screenname">
    <h:outputText value="Create directory" rendered="#{!directoryHome.managed}"/>
    <h:outputText value="Edit directory" rendered="#{directoryHome.managed}"/>
</ui:define>

<ui:define name="controlTwo">

    <s:link id="exitManaged" styleClass="linkNavigation" rendered="#{directoryHome.managed}" action="exitManaged"
            accesskey="E"><u>E</u>xit Editor</s:link>

    <s:link id="exitUnmanaged" styleClass="linkNavigation" rendered="#{!directoryHome.managed}" action="exitUnmanaged"
            accesskey="E"><u>E</u>xit Editor</s:link>

</ui:define>

<ui:define name="content">

<s:span rendered="#{s:hasPermission('User', 'isAdmin', currentUser) and directoryHome.managed and directoryHome.instance.id != wikiPreferences.memberAreaId}">
    <ui:include src="includes/ownerSelector.xhtml">
        <ui:param name="home" value="#{directoryHome}"/>
    </ui:include>
</s:span>

<s:span rendered="#{directoryHome.managed and !empty directoryHome.parentDirectory and directoryHome.instance.id != wikiPreferences.memberAreaId}">
    <ui:include src="includes/deleteConfirmation.xhtml">
        <ui:param name="home" value="#{directoryHome}"/>
    </ui:include>
</s:span>


<h:form id="directoryEditForm" styleClass="box">
<div class="form">

<ui:include src="includes/statusIndicator.xhtml"/>

<div class="formHead">
    <h:outputText value="New directory" rendered="#{!directoryHome.managed}"/>
    <h:outputText value="Edit directory" rendered="#{directoryHome.managed}"/>
</div>

<div class="formFields formBorder">

    <s:validateAll>

        <s:div styleClass="entry" rendered="#{!empty directoryHome.parentDirectory}">
            <div class="label">Parent:</div>
            <div class="output">
                <h:outputText value="#{directoryHome.parentDirectory.name}"/>
            </div>
        </s:div>

        <s:div styleClass="entry" rendered="#{directoryHome.managed}">
            <div class="label">Created On:</div>
            <div class="output">
                <h:outputText value="#{directoryHome.instance.createdOn}">
                    <f:convertDateTime type="both" timeZone="#{wikiPreferences.timeZone}"/>
                </h:outputText>
                <s:span id="ownerDisplay">&#160;(#{directoryHome.instance.createdBy.username})</s:span>
                <h:outputLink id="selectOwner" value="#" tabindex="1" styleClass="buttonNonpersistent"
                              rendered="#{s:hasPermission('User', 'isAdmin', currentUser) and directoryHome.instance.id != wikiPreferences.memberAreaId}"><j4j:idProxy
                                id="openDialogOwnerSelection"/><span class="buttonLabel">...</span></h:outputLink>
            </div>
        </s:div>

        <s:decorate id="nameDecorate" template="includes/formFieldDecorate.xhtml">
            <ui:define name="label">Name</ui:define>
            <h:inputText size="25" maxlength="255" required="true" tabindex="1" value="#{directoryHome.instance.name}">
                <a:support status="directoryEditForm:status" event="onblur" reRender="nameDecorate"/>
            </h:inputText>
        </s:decorate>

        <s:decorate id="descriptionDecorate" template="includes/formFieldDecorate.xhtml">
            <ui:define name="label">Description</ui:define>
            <h:inputText size="50" maxlength="512" required="false" tabindex="1" value="#{directoryHome.instance.description}">
                <a:support status="directoryEditForm:status" event="onblur" reRender="descriptionDecorate"/>
            </h:inputText>
        </s:decorate>

        <s:span rendered="#{directoryHome.instance.id != wikiPreferences.memberAreaId}">
            <ui:include src="includes/accessLevelSelector.xhtml"/>
        </s:span>

    </s:validateAll>

    <s:span id="defaultDocumentSelector">
        <s:div styleClass="entry" rendered="#{directoryHome.managed and !empty directoryHome.parentDirectory and !empty directoryHome.childDocuments}">
            <div class="label">Default document:</div>
            <div class="input">
                <h:selectOneMenu value="#{directoryHome.instance.defaultDocument}" converter="#{restrictedEntityConverter}" tabindex="2">
                    <s:selectItems value="#{directoryHome.childDocuments}"
                                   var="document"
                                   label="#{wiki:truncateString(document.name, 40, '...')}"
                                   noSelectionLabel="No default document"/>
                </h:selectOneMenu>
            </div>
        </s:div>
    </s:span>

    <s:div styleClass="entry"
           rendered="#{!empty directoryHome.instance.children and s:hasPermission('Node', 'editMenu', directoryHome.instance)}">
        <div class="label">Menu items:</div>
        <div class="input">

            <h:dataTable id="menuItemTable" var="node" style="width:50%"
                         value="#{directoryHome.instance.children}"
                         styleClass="datatable"
                         columnClasses="onePercentColumn alignCenter, onePercentColumn alignCenter, onePercentColumn alignCenter, onePercentColumn alignCenter, defaultColumn alignLeft"
                         rowClasses="rowEven,rowOdd"
                         cellpadding="0" cellspacing="0" border="0">

                <h:column>
                    <a:commandLink rendered="#{uiComponent['directoryEditForm:menuItemTable'].rowIndex != 0}"
                                   status="directoryEditForm:status"
                                   action="#{directoryHome.moveNode(uiComponent['directoryEditForm:menuItemTable'].rowIndex, uiComponent['directoryEditForm:menuItemTable'].rowIndex-1)}"
                                   reRender="menuItemTable, defaultDocumentSelector">
                        <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/up.gif" width="18" height="18"/>
                    </a:commandLink>
                </h:column>
                <h:column>
                    <a:commandLink rendered="#{uiComponent['directoryEditForm:menuItemTable'].rowIndex != uiComponent['directoryEditForm:menuItemTable'].rowCount-1}"
                                   status="directoryEditForm:status"
                                   action="#{directoryHome.moveNode(uiComponent['directoryEditForm:menuItemTable'].rowIndex, uiComponent['directoryEditForm:menuItemTable'].rowIndex+1)}"
                                   reRender="menuItemTable, defaultDocumentSelector">
                        <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/down.gif" width="18" height="18"/>
                    </a:commandLink>
                </h:column>

                <h:column>
                    <h:selectBooleanCheckbox value="#{node.menuItem}" tabindex="3"/>
                </h:column>

                <h:column>
                    <a:outputPanel>
                        <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/icon.dir.gif"
                                        width="18" height="20"
                                        rendered="#{wiki:isDirectory(node)}"/>
                        <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/icon.doc.gif"
                                        width="18" height="20"
                                        rendered="#{wiki:isDocument(node)}"/>
                        <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/#{fileMetaMap[node.contentType].displayIcon}"
                                        width="18" height="20"
                                        rendered="#{wiki:isFile(node) and !empty fileMetaMap[node.contentType]}"/>
                        <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/#{fileMetaMap['generic'].displayIcon}"
                                        width="18" height="20"
                                        rendered="#{wiki:isFile(node) and empty fileMetaMap[node.contentType]}"/>
                    </a:outputPanel>
                </h:column>

                <h:column>
                    <a:outputPanel>
                        <h:outputText value="#{wiki:truncateString(node.name, 40, '...')}"/>
                    </a:outputPanel>
                </h:column>

            </h:dataTable>

        </div>
    </s:div>

    <s:div styleClass="entry">
        <div class="label">&#160;</div>
        <div class="input">
            <h:selectBooleanCheckbox value="#{directoryHome.hasFeed}" tabindex="2"
                                     disabled="#{empty directoryHome.parentDirectory}"/>
            Enable syndication feed (disabling invalidates subcriber link)
            <a:commandLink id="resetFeed" reRender="messageBoxContainer"
                           action="#{directoryHome.resetFeed}"
                           rendered="#{!empty directoryHome.instance.feed}"
                           styleClass="buttonNonpersistent"><span class="buttonLabel">Reset Feed</span></a:commandLink>
        </div>
    </s:div>

</div>
<div class="formControls wideLabels">

    <div class="entry">
        <div class="label">&#160;</div>
        <div class="input">

            <h:commandLink id="save" styleClass="button"
                           action="#{directoryHome.persist}"
                           rendered="#{!directoryHome.managed}"
                           tabindex="6" accesskey="S"><span class="buttonLabel"><u>S</u>ave</span></h:commandLink>

            <h:commandLink id="update" styleClass="button"
                           action="#{directoryHome.update}"
                           rendered="#{directoryHome.managed}"
                           tabindex="7" accesskey="U"><span class="buttonLabel"><u>U</u>pdate</span></h:commandLink>

            <h:outputLink id="delete" value="#" tabindex="8" accesskey="D" styleClass="button"
                          rendered="#{directoryHome.managed and !empty directoryHome.parentDirectory and directoryHome.instance.id != wikiPreferences.memberAreaId}"><j4j:idProxy
                    id="openDialogDelete"/><span class="buttonLabel"><u>D</u>elete</span></h:outputLink>

        </div>
    </div>

</div>

</div>
</h:form>


</ui:define>

<ui:define name="footer">&#160;</ui:define>

</ui:composition>

