<wiki:plugin id="blogDirectoryPlugin"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:c="http://java.sun.com/jstl/core"
        xmlns:wiki="http://jboss.com/products/seam/wiki"
        xmlns:s="http://jboss.com/products/seam/taglib">

    <s:div id="blogDirectory"
         styleClass="#{showPluginPreferences and !empty blogDirectoryPreferencesEditor ? 'pluginPreferencesBox' : ''}">

        <s:div id="blogDirectoryPreferences"
               rendered="#{showPluginPreferences and !empty blogDirectoryPreferencesEditor}">
            <div align="center">
                <h:message for="blogDirectoryPreferences" styleClass="pluginPreferencesMessage"/>

                <ui:include src="../../includes/pluginPreferencesForm.xhtml">
                    <ui:param name="pluginDiv" value="blogDirectory"/>
                    <ui:param name="pluginPreferencesEditor" value="#{blogDirectoryPreferencesEditor}"/>
                </ui:include>
            </div>
        </s:div>

        <s:div id="blogEntries">
        <s:div rendered="#{!empty blogDirectory.blogEntries}">

            <c:forEach var="blogEntry" items="#{blogDirectory.blogEntries}">

                <div class="box">

                    <div class="blogEntryHeader">
                        <h:outputText value="#{blogEntry.entryDocument.name}"/>
                        <div>
                            <h:outputText styleClass="blogEntryCreatedOnText" value="#{blogEntry.entryDocument.createdOn}">
                                <f:convertDateTime pattern="dd. MMM yyyy, HH:mm" timeZone="#{wikiPreferences.timeZone}"/>
                            </h:outputText>
                            <h:outputText value="&#160;#{wikiPreferences.timeZone}"/>
                            <h:outputText value=",&#160;by&#160;"/>
                            <h:outputLink value="#{wiki:renderHomeURL(blogEntry.entryDocument.createdBy)}" target="_top"
                                          rendered="#{!empty blogEntry.entryDocument.createdBy.memberHome}">
                                <h:outputText styleClass="blogEntryCreatedByLink"
                                              value="#{blogEntry.entryDocument.createdBy.fullname}"/>
                            </h:outputLink>
                            <h:outputText rendered="#{empty blogEntry.entryDocument.createdBy.memberHome}"
                                          value="#{blogEntry.entryDocument.createdBy.fullname}"/>
                        </div>
                    </div>

                    <div class="blogEntryContent">
                        <wiki:formattedText value="#{blogEntry.entryDocument.content}"
                                            linkStyleClass="regularLink"
                                            brokenLinkStyleClass="brokenLink"
                                            attachmentLinkStyleClass="attachmentLink"
                                            thumbnailLinkStyleClass="regularLink"
                                            updateResolvedLinks="false"
                                            internalTargetFrame="_top"
                                            externalTargetFrame="_top"
                                            renderBaseDocument="#{blogEntry.entryDocument}"
                                            renderBaseDirectory="#{currentDirectory}"
                                            enablePlugins="true"/>
                    </div>

                    <s:div rendered="#{blogEntry.entryDocument.pluginsUsed.contains('showTags') and not blogEntry.entryDocument.tags}"
                           styleClass="documentTags undecoratedLink">
                        <s:div>
                            #{messages['lacewiki.label.docDisplay.Tags']}:&#160;
                            <ui:repeat var="tag" value="#{blogEntry.entryDocument.tagsSplit}">
                                <s:link view="/tagDisplay_#{skin}.xhtml" value="#{tag}">
                                    <f:param value="#{tag}" name="tag"/>
                                </s:link>

                                <h:outputText rendered="#{blogEntry.entryDocument.tagsSplit.indexOf(tag) &lt; blogEntry.entryDocument.tagsSplit.size()-1}"
                                              value="&#160;|&#160;"/>
                            </ui:repeat>
                        </s:div>
                    </s:div>

                    <div class="boxFooter">
                        <h:panelGrid styleClass="blogEntryFooterTable" columns="5" cellpadding="0" cellspacing="0" border="0">
                            <s:div styleClass="blogEntryCommentCount"
                                   rendered="#{blogEntry.commentCount > 0 and blogEntry.entryDocument.enableComments}">
                                <h:outputLink value="#{wiki:renderPermLink(blogEntry.entryDocument)}#comments" target="_top">
                                    <span class="blogEntryCommentCountText">
                                        <h:outputText value="#{blogEntry.commentCount}&#160;"/>
                                        <h:outputText value="#{blogEntry.commentCount>1
                                                             ? messages['lacewiki.label.commentsDisplay.Comments']
                                                             : messages['lacewiki.label.commentsDisplay.Comment']}"/>
                                    </span>
                                </h:outputLink>
                            </s:div>
                            <s:div styleClass="blogEntryCommentLink" target="_top"
                                   rendered="#{blogEntry.entryDocument.enableComments and blogEntry.entryDocument.enableCommentForm}">
                                <h:outputLink target="_top" value="#{wiki:renderURL(blogEntry.entryDocument)}?showCommentForm=true#commentForm">
                                    <h:outputText styleClass="blogEntryCommentLinkText" value="#{messages['lacewiki.label.commentForm.PostComment']}"/>
                                </h:outputLink>
                            </s:div>
                            <s:div styleClass="blogEntryAttachmentsLink"
                                    rendered="#{wiki:sizeOf(wikiTextAttachments) > 0}">
                                <h:outputLink value="#{wiki:renderPermLink(blogEntry.entryDocument)}#attachments" target="_top">
                                    <span class="blogEntryAttachmentsLinkText">
                                        <h:outputText value="#{wiki:sizeOf(wikiTextAttachments)}&#160;"/>
                                        <h:outputText value="#{wiki:sizeOf(wikiTextAttachments)>1
                                                             ? messages['blogDirectory.label.Attachments']
                                                             : messages['blogDirectory.label.Attachment']}"/>
                                    </span>
                                </h:outputLink>
                            </s:div>
                            <s:div styleClass="blogEntryPermLink">
                                <h:outputLink value="#{wiki:renderPermLink(blogEntry.entryDocument)}" target="_top">
                                    <h:outputText styleClass="blogEntryPermLinkText" value="#{messages['lacewiki.label.PermLink']}"/>
                                </h:outputLink>
                            </s:div>
                            <s:div styleClass="blogEntryWikiLink">
                                <h:outputLink value="#{wiki:renderWikiLink(blogEntry.entryDocument)}" target="_top">
                                    <h:outputText styleClass="blogEntryWikiLinkText" value="#{messages['lacewiki.label.WikiLink']}"/>
                                </h:outputLink>
                            </s:div>
                        </h:panelGrid>
                    </div>

                </div>

                <div class="blogEntrySeparator"/>

            </c:forEach>
        </s:div>

        <h:panelGrid columns="5" rendered="#{blogDirectory.numOfBlogEntries > blogDirectoryPreferences.properties['pageSize']}"
                     styleClass="blogPagerTable"
                     columnClasses="blogPagerColumn, blogPagerColumn, blogPagerTextColumn, blogPagerColumn, blogPagerColumn, "
                     cellpadding="0" cellspacing="0" border="0">

            <h:outputLink rendered="#{blogDirectory.previousPageAvailable}" target="_top"
                          value="#{wiki:renderURL(currentDocument)}#{blogDirectory.dateUrl}#{blogDirectory.tagUrl}">
                <div style="width:30px;">
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/page.first.gif" width="13" height="11"/>
                </div>
            </h:outputLink>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/blank.gif" width="13" height="11"
                            rendered="#{!blogDirectory.previousPageAvailable}"/>

            <h:outputLink rendered="#{blogDirectory.previousPageAvailable}" target="_top"
                          value="#{wiki:renderURL(currentDocument)}#{blogDirectory.dateUrl}/Page/#{blogDirectory.previousPage}#{blogDirectory.tagUrl}">
                <div style="width:30px;">
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/page.previous.gif" width="13" height="11"/>
                </div>
            </h:outputLink>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/blank.gif" width="13" height="11"
                            rendered="#{!blogDirectory.previousPageAvailable}"/>

            <s:span>
                <h:outputText value="#{messages['blogDirectory.label.Showing']}
                                        #{blogDirectory.firstRow} #{messages['blogDirectory.label.To']}
                                        #{blogDirectory.lastRow} #{messages['blogDirectory.label.Of']}
                                        #{blogDirectory.numOfBlogEntries} #{messages['blogDirectory.label.BlogEntries']}"/>

                <h:outputText rendered="#{!empty param.day || !empty param.month || !empty param.year}"
                              value="&#160;#{messages['blogDirectory.label.In']}"/>
                <h:outputText rendered="#{!empty param.day}" value="&#160;#{param.day}."/>
                <h:outputText rendered="#{!empty param.month}" value="&#160;#{messages[wiki:concat('lacewiki.label.', converters.monthNames[param.month])]}"/>
                <h:outputText rendered="#{!empty param.year}" value="&#160;#{param.year}"/>
                <h:outputText rendered="#{!empty param.tag}" value="&#160;#{messages['blogDirectory.label.Tagged']} '#{param.tag}'"/>
            </s:span>

            <h:outputLink rendered="#{blogDirectory.nextPageAvailable}" target="_top"
                          value="#{wiki:renderURL(currentDocument)}#{blogDirectory.dateUrl}/Page/#{blogDirectory.nextPage}#{blogDirectory.tagUrl}">
                <div style="width:30px;">
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/page.next.gif" width="13" height="11"/>
                </div>
            </h:outputLink>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/blank.gif" width="13" height="11"
                            rendered="#{!blogDirectory.nextPageAvailable}"/>

            <h:outputLink rendered="#{blogDirectory.nextPageAvailable}" target="_top"
                          value="#{wiki:renderURL(currentDocument)}#{blogDirectory.dateUrl}/Page/#{blogDirectory.lastPage}#{blogDirectory.tagUrl}">
                <div style="width:30px;">
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/page.last.gif" width="13" height="11"/>
                </div>
            </h:outputLink>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/blank.gif" width="13" height="11"
                            rendered="#{!blogDirectory.nextPageAvailable}"/>

        </h:panelGrid>

        </s:div>

        <s:div id="noBlogEntriesContainer" rendered="#{empty blogDirectory.blogEntries}">
            <h:outputText value="#{messages['blogDirectory.label.NoBlogEntriesFound']}"/>
        </s:div>

    </s:div>

</wiki:plugin>