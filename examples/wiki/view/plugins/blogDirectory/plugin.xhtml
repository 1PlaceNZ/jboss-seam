<wiki:plugin id="blogDirectoryPlugin"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:c="http://java.sun.com/jstl/core"
        xmlns:wiki="http://jboss.com/products/seam/wiki"
        xmlns:s="http://jboss.com/products/seam/taglib">

    <script type="text/javascript">jQuery(function() {
        clearDocumentBackground();
    });</script>

    <s:div id="blogDirectory"
         styleClass="#{showPluginPreferences and !empty blogDirectoryPreferencesEditor ? 'pluginPreferencesBox' : null}">

        <s:div id="blogDirectoryPreferences"
               rendered="#{showPluginPreferences and !empty blogDirectoryPreferencesEditor}">
            <div align="center">
                <h:message for="blogDirectoryPreferences" styleClass="attentionMessage"/>

                <ui:include src="../../includes/pluginPreferencesForm.xhtml">
                    <ui:param name="pluginPreferencesEditor" value="#{blogDirectoryPreferencesEditor}"/>
                </ui:include>
            </div>
        </s:div>

        <s:div id="blogEntries">
        <s:div rendered="#{!empty blogDirectory.blogEntries}">

            <c:forEach var="blogEntry" items="#{blogDirectory.blogEntries}">

                <s:div styleClass="shadowContainer"><div class="shadow1"><div class="shadow2">
                <div class="blogEntry">

                    <div class="blogEntryHeader">
                        <div class="blogEntryTitle">
                            <h:outputText value="#{blogEntry.entryDocument.name}"/>
                        </div>
                        <div class="blogEntryCreatenOnAndBy">
                            <h:outputText styleClass="blogEntryCreatedOnText" value="#{blogEntry.entryDocument.createdOn}">
                                <f:convertDateTime pattern="dd. MMM yyyy, HH:mm" timeZone="#{wikiPreferences.timeZone}"/>
                            </h:outputText>
                            <h:outputText value="&#160;#{wikiPreferences.timeZone}"/>
                            <h:outputText value=",&#160;by&#160;"/>
                            <h:outputLink value="#{wiki:renderHomeURL(blogEntry.entryDocument.createdBy)}"
                                          rendered="#{!empty blogEntry.entryDocument.createdBy.memberHome}">
                                <h:outputText styleClass="blogEntryCreatedByLink"
                                              value="#{blogEntry.entryDocument.createdBy.fullname}"/>
                            </h:outputLink>
                            <h:outputText rendered="#{empty blogEntry.entryDocument.createdBy.memberHome}"
                                          value="#{blogEntry.entryDocument.createdBy.fullname}"/>
                        </div>
                    </div>
                    <div class="blogEntryBody">
                        <wiki:formattedText value="#{blogEntry.entryDocument.content}"
                                            linkStyleClass="regularLink"
                                            brokenLinkStyleClass="brokenLink"
                                            attachmentLinkStyleClass="attachmentLink"
                                            thumbnailLinkStyleClass="regularLink"
                                            updateResolvedLinks="false"
                                            renderBaseDocument="#{blogEntry.entryDocument}"
                                            renderBaseDirectory="#{currentDirectory}"
                                            enablePlugins="true"/>
                    </div>

                    <div class="blogEntryFooter">
                        <h:panelGrid styleClass="blogEntryFooterTable" columns="5" cellpadding="0" cellspacing="0" border="0">
                            <s:div styleClass="blogEntryCommentCount"
                                   rendered="#{blogEntry.commentCount > 0 and blogEntry.entryDocument.enableComments}">
                                <h:outputLink value="#{wiki:renderPermLink(blogEntry.entryDocument)}#comments">
                                    <span class="blogEntryCommentCountText">
                                        <h:outputText value="#{blogEntry.commentCount}&#160;"/>
                                        <h:outputText value="#{blogEntry.commentCount>1 ? 'comments' : 'comment'}"/>
                                    </span>
                                </h:outputLink>
                            </s:div>
                            <s:div styleClass="blogEntryCommentLink"
                                   rendered="#{blogEntry.entryDocument.enableComments and blogEntry.entryDocument.enableCommentForm}">
                                <h:outputLink value="#{wiki:renderURL(blogEntry.entryDocument)}?showCommentForm=true#commentForm">
                                    <span class="blogEntryCommentLinkText">Post comment</span>
                                </h:outputLink>
                            </s:div>
                            <s:div styleClass="blogEntryAttachmentsLink"
                                    rendered="#{wiki:sizeOf(wikiTextAttachments) > 0}">
                                <h:outputLink value="#{wiki:renderURL(blogEntry.entryDocument)}#attachments">
                                    <span class="blogEntryAttachmentsLinkText">
                                        <h:outputText value="#{wiki:sizeOf(wikiTextAttachments)}&#160;"/>
                                        <h:outputText value="#{wiki:sizeOf(wikiTextAttachments)>1 ? 'attachments' : 'attachment'}"/>
                                    </span>
                                </h:outputLink>
                            </s:div>
                            <s:div styleClass="blogEntryPermLink">
                                <h:outputLink value="#{wiki:renderPermLink(blogEntry.entryDocument)}">
                                    <span class="blogEntryPermLinkText">Permlink</span>
                                </h:outputLink>
                            </s:div>
                            <s:div styleClass="blogEntryWikiLink">
                                <h:outputLink value="#{wiki:renderWikiLink(blogEntry.entryDocument)}">
                                    <span class="blogEntryWikiLinkText">WikiLink</span>
                                </h:outputLink>
                            </s:div>
                        </h:panelGrid>
                    </div>

                </div>
                </div></div></s:div>

                <div class="blogEntrySeparator"/>

            </c:forEach>
        </s:div>

        <h:panelGrid columns="5" rendered="#{blogDirectory.numOfBlogEntries > blogDirectoryPreferences.properties['pageSize']}"
                     styleClass="blogPagerTable"
                     columnClasses="blogPagerColumn, blogPagerColumn, blogPagerTextColumn, blogPagerColumn, blogPagerColumn, "
                     cellpadding="0" cellspacing="0" border="0">

            <h:outputLink rendered="#{blogDirectory.previousPageAvailable}"
                          value="#{wiki:renderURL(currentDocument)}#{blogDirectory.dateUrl}">
                <div style="width:30px;">
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/page.first.gif" width="13" height="11"/>
                </div>
            </h:outputLink>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/blank.gif" width="13" height="11"
                            rendered="#{!blogDirectory.previousPageAvailable}"/>

            <h:outputLink rendered="#{blogDirectory.previousPageAvailable}"
                          value="#{wiki:renderURL(currentDocument)}#{blogDirectory.dateUrl}/Page/#{blogDirectory.previousPage}">
                <div style="width:30px;">
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/page.previous.gif" width="13" height="11"/>
                </div>
            </h:outputLink>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/blank.gif" width="13" height="11"
                            rendered="#{!blogDirectory.previousPageAvailable}"/>

            <s:span>
                <h:outputText value="Showing #{blogDirectory.firstRow} to
                                             #{blogDirectory.lastRow} of
                                             #{blogDirectory.numOfBlogEntries} blog entries"/>

                <h:outputText rendered="#{!empty param.day || !empty param.month || !empty param.year}" value="&#160;in"/>
                <h:outputText rendered="#{!empty param.day}" value="&#160;#{param.day}."/>
                <h:outputText rendered="#{!empty param.month}" value="&#160;#{converters.monthNames[param.month]}"/>
                <h:outputText rendered="#{!empty param.year}" value="&#160;#{param.year}"/>
            </s:span>

            <h:outputLink rendered="#{blogDirectory.nextPageAvailable}"
                          value="#{wiki:renderURL(currentDocument)}#{blogDirectory.dateUrl}/Page/#{blogDirectory.nextPage}">
                <div style="width:30px;">
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/page.next.gif" width="13" height="11"/>
                </div>
            </h:outputLink>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/blank.gif" width="13" height="11"
                            rendered="#{!blogDirectory.nextPageAvailable}"/>

            <h:outputLink rendered="#{blogDirectory.nextPageAvailable}"
                          value="#{wiki:renderURL(currentDocument)}/#{blogDirectory.dateUrl}Page/#{blogDirectory.lastPage}">
                <div style="width:30px;">
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/page.last.gif" width="13" height="11"/>
                </div>
            </h:outputLink>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/blank.gif" width="13" height="11"
                            rendered="#{!blogDirectory.nextPageAvailable}"/>

        </h:panelGrid>

        </s:div>

        <s:div id="noBlogEntriesContainer" rendered="#{empty blogDirectory.blogEntries}">
            No blog entries found.
        </s:div>

    </s:div>

</wiki:plugin>