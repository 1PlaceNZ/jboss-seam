<s:fragment
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:wiki="http://jboss.com/products/seam/wiki"
        xmlns:a="https://ajax4jsf.dev.java.net/ajax"
        xmlns:s="http://jboss.com/products/seam/taglib">

    <h:panelGrid columns="2" styleClass="forumPostingHeaderInfoControls" columnClasses="forumPostingHeaderInfo, forumPostingHeaderControls"
                 cellpadding="0" cellspacing="0" border="0">

        <h:outputLink value="#{wiki:renderURL(currentDirectory.defaultFile)}" styleClass="extraExtraLargeFont">
            <h:outputText value="#{messages['forum.label.Forum']}:&#160;#{currentDirectory.name}"/>
        </h:outputLink>

        <h:panelGroup>

            <h:outputLink value="#{wiki:renderURL(currentDirectory.parent)}"
                          accesskey="#{messages['forum.button.ForumList.accesskey']}"
                          tabindex="1" styleClass="buttonNonpersistent">
                <h:outputText styleClass="buttonLabel" escape="false" value="#{messages['forum.button.ForumList']}"/>
            </h:outputLink>

            <h:outputLink value="#{wiki:renderURL(currentDirectory.defaultFile)}"
                          accesskey="#{messages['forum.button.TopicList.accesskey']}"
                          tabindex="1" styleClass="buttonNonpersistent">
                <h:outputText styleClass="buttonLabel" escape="false" value="#{messages['forum.button.TopicList']}"/>
            </h:outputLink>

            <s:fragment rendered="#{s:hasPermission('Comment', 'delete', currentDocument) and not replyHome.showForm}">
                <h:outputLink value="#{wiki:renderURL(currentDirectory.defaultFile)}?showTopicForm=true"
                              accesskey="#{messages['forum.button.NewTopic.accesskey']}"
                              tabindex="1" styleClass="buttonNonpersistent">
                    <h:outputText styleClass="buttonLabel" escape="false" value="#{messages['forum.button.NewTopic']}"/>
                </h:outputLink>
            </s:fragment>

        </h:panelGroup>

    </h:panelGrid>

    <h:outputText escape="false"
                  value="&lt;div class='forumPostingDocumentWrapper #{empty commentQuery.comments or not currentDocument.enableComments? 'noComments' : ''}'>"/>

        <h:panelGrid columns="4" styleClass="commentHeader"
                     columnClasses="commentSubjectIcon, commentSubject, commentAuthorInfo smallFont, commentAuthorPortrait"
                     cellpadding="0" cellspacing="0" border="0">

            <s:fragment>
                <ui:insert name="subjectIcon"/>
            </s:fragment>

            <s:div styleClass="undecoratedLink largeFont" rendered="#{currentDocument.name != c.subject}">
                <h:outputLink styleClass="subjectLink" value="#{wiki:renderURL(currentDocument)}">
                    <h:outputText value="#{currentDocument.name}"/>
                </h:outputLink>
            </s:div>

            <s:fragment>
                <s:div>
                    <s:span styleClass="commentDate">
                        <h:outputText value="#{currentDocument.createdOn}">
                            <f:convertDateTime pattern="dd. MMM yyyy, HH:mm" timeZone="#{wikiPreferences.timeZone}"/>
                        </h:outputText>
                        <h:outputText value="&#160;#{wikiPreferences.timeZone}"/>
                    </s:span>
                    <h:outputText value="&#160;|&#160;"/>
                    <s:span styleClass="commentLink undecoratedLink">
                        <h:outputLink value="#{wiki:renderURL(c)}">
                            <h:outputText value="#{messages['lacewiki.label.Link']}"/>
                        </h:outputLink>
                    </s:span>
                </s:div>
                <s:div rendered="#{currentDocument.ownedByRegularUser}">
                    <s:span styleClass="undecoratedLink">
                        <s:link view="/userInfo_#{skin}.xhtml" propagation="none">
                            <f:param name="userId" value="#{currentDocument.createdBy.id}"/>
                            <h:outputText value="#{currentDocument.createdBy.fullname}"/>
                        </s:link>
                    </s:span>
                    <h:outputText value="&#160;|&#160;"/>
                    <h:outputLink value="#{wiki:escapeEmailURL(wiki:concat('mailto:', currentDocument.createdBy.email))}">
                        <h:outputText value="#{wiki:escapeAtSymbol(currentDocument.createdBy.email)}"/>
                    </h:outputLink>
                </s:div>
                <s:div rendered="#{not currentDocument.ownedByRegularUser}">
                    <h:outputText value="#{currentDocument.createdBy.fullname}"/>
                </s:div>
            </s:fragment>

            <s:fragment rendered="#{currentDocument.ownedByRegularUser and !empty currentDocument.createdBy.profile.imageContentType}">
                <s:span styleClass="undecoratedLink">
                    <s:link view="/userInfo_#{skin}.xhtml" propagation="none">
                        <f:param name="userId" value="#{currentDocument.createdBy.id}"/>
                        <s:graphicImage styleClass="commentAuthorPortraitImage" value="#{currentDocument.createdBy.profile.image}">
                            <s:transformImageSize width="30" maintainRatio="true"/>
                        </s:graphicImage>
                    </s:link>
                </s:span>
            </s:fragment>

        </h:panelGrid>

    <!-- The forumPostingDocumentWrapper <div> stays open! -->

</s:fragment>