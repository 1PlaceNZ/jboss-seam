<s:div id="topicTableContainer"
       styleClass="topicFormContainer"
       xmlns="http://www.w3.org/1999/xhtml"
       xmlns:s="http://jboss.com/products/seam/taglib"
       xmlns:ui="http://java.sun.com/jsf/facelets"
       xmlns:f="http://java.sun.com/jsf/core"
       xmlns:h="http://java.sun.com/jsf/html"
       xmlns:a="https://ajax4jsf.dev.java.net/ajax"
       xmlns:wiki="http://jboss.com/products/seam/wiki">

<s:fragment rendered="#{not topicHome.showForm}">

    <ui:include src="topicPager.xhtml"/>

    <div class="box">

    <h:dataTable id="topicTable"
                 var="topic"
                 value="#{forumQuery.topics}"
                 rendered="#{not empty forumQuery.topics}"
                 styleClass="datatable topLeftBottomBorder topicTable"
                 headerClass="regularHeader rightBorder alignCenter"
                 columnClasses="onePercentColumn rightBorder alignCenter, defaultColumn rightBorder alignLeft,
                                onePercentColumn rightBorder alignCenter, fivePercentColumn rightBorder alignCenter,
                                tenPercentColumn rightBorder alignCenter"
                 rowClasses="rowOdd,rowEven"
                 cellpadding="0" cellspacing="0" border="0">

        <h:column>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/icon.#{topic.iconName}.gif" width="22" height="26"/>
        </h:column>

        <h:column>
            <f:facet name="header">Topic</f:facet>

            <h:outputLink value="#{wiki:renderURL(topic)}" tabindex="1">
                <h:outputText value="#{wiki:truncateString(topic.name, 60, '...')}"/>
            </h:outputLink>

        </h:column>

        <h:column>
            <f:facet name="header">Replies</f:facet>
            <h:outputText value="#{topic.numOfComments}" rendered="#{topic.numOfComments != 0}"/>
            <h:outputText value="-" rendered="#{topic.numOfComments == 0}"/>
        </h:column>

        <h:column>
            <f:facet name="header">Author</f:facet>

            <s:fragment rendered="#{wiki:isRegularUser(topic.createdBy)}">
                <s:div styleClass="undecoratedLink">
                    <h:outputLink value="#"
                                  onclick="jQuery('#userInfoPopup#{topic.createdBy.id}').jqmShow().css({right: '11%'});">
                        <h:outputText value="#{topic.createdBy.fullname}"/>
                    </h:outputLink>
                </s:div>
                <ui:include src="../forumPosting/userInfoPopup.xhtml">
                    <ui:param name="user" value="#{topic.createdBy}"/>
                    <ui:param name="userInfoPopupId" value="#{topic.createdBy.id}"/>
                </ui:include>
            </s:fragment>
            <s:div rendered="#{not wiki:isRegularUser(topic.createdBy)}">
                <h:outputText value="#{topic.createdBy.fullname}"/>
            </s:div>

        </h:column>

        <h:column>
            <f:facet name="header">Last Post</f:facet>
            <s:fragment rendered="#{not empty topic.lastComment}">
                <h:outputLink value="#{wiki:renderCommentURL(topic, topic.lastComment)}" tabindex="1">
                    <h:outputText value="#{topic.lastComment.createdOn}">
                        <f:convertDateTime type="both" timeZone="#{wikiPreferences.timeZone}"/>
                    </h:outputText>
                    <h:graphicImage styleClass="topicGotoIcon" value="/themes/#{wikiPreferences.themeName}/img/icon.posting_goto.gif" width="18" height="9"/>
                </h:outputLink>

                <s:fragment rendered="#{wiki:isRegularUser(topic.lastComment.fromUser)}">
                    <s:div styleClass="undecoratedLink">
                        <h:outputLink value="#"
                                      onclick="jQuery('#userInfoPopup#{topic.lastComment.id}').jqmShow().css({right: '1%'});">
                            <h:outputText value="#{topic.lastComment.fromUser.fullname}"/>
                        </h:outputLink>
                    </s:div>
                    <ui:include src="../forumPosting/userInfoPopup.xhtml">
                        <ui:param name="user" value="#{topic.lastComment.fromUser}"/>
                        <ui:param name="userInfoPopupId" value="#{topic.lastComment.id}"/>
                    </ui:include>
                </s:fragment>
                <s:div rendered="#{not wiki:isRegularUser(topic.lastComment.fromUser)}">
                    <h:outputText value="#{topic.lastComment.fromUser.fullname}"/>
                </s:div>

            </s:fragment>
            <s:fragment rendered="#{empty topic.lastComment}">
                <h:outputLink value="#{wiki:renderURL(topic)}" tabindex="1">
                    <h:outputText value="#{topic.createdOn}">
                        <f:convertDateTime type="both" timeZone="#{wikiPreferences.timeZone}"/>
                    </h:outputText>
                    <h:graphicImage styleClass="topicGotoIcon" value="/themes/#{wikiPreferences.themeName}/img/icon.posting_goto.gif" width="18" height="9"/>
                </h:outputLink>

                <s:fragment rendered="#{wiki:isRegularUser(topic.createdBy)}">
                    <s:div styleClass="undecoratedLink">
                        <h:outputLink value="#"
                                      onclick="jQuery('#userInfoPopup#{topic.id}').jqmShow().css({right: '1%'});">
                            <h:outputText value="#{topic.createdBy.fullname}"/>
                        </h:outputLink>
                    </s:div>
                    <ui:include src="../forumPosting/userInfoPopup.xhtml">
                        <ui:param name="user" value="#{topic.createdBy}"/>
                        <ui:param name="userInfoPopupId" value="#{topic.id}"/>
                    </ui:include>
                </s:fragment>
                <s:div rendered="#{not wiki:isRegularUser(topic.createdBy)}">
                    <h:outputText value="#{topic.createdBy.fullname}"/>
                </s:div>

            </s:fragment>
        </h:column>

    </h:dataTable>

    </div>

    <s:div rendered="#{empty forumQuery.topics}" styleClass="box">
        No topics in this forum.
    </s:div>

    <ui:include src="topicPager.xhtml"/>

</s:fragment>

</s:div>
