<wiki:plugin id="feedTeasersPlugin"
       xmlns="http://www.w3.org/1999/xhtml"
       xmlns:ui="http://java.sun.com/jsf/facelets"
       xmlns:h="http://java.sun.com/jsf/html"
       xmlns:a="https://ajax4jsf.dev.java.net/ajax"
       xmlns:f="http://java.sun.com/jsf/core"
       xmlns:wiki="http://jboss.com/products/seam/wiki"
       xmlns:s="http://jboss.com/products/seam/taglib">

    <s:div id="feedTeasers"
           styleClass="#{showPluginPreferences and !empty feedTeasersPreferencesEditor ? 'pluginPreferencesBox box' : 'box'}">

        <s:div id="feedTeasersPreferences"
               rendered="#{showPluginPreferences and !empty feedTeasersPreferencesEditor}">
            <div align="center">
                <h:message for="feedTeasersPreferences" styleClass="pluginPreferencesMessage"/>

                <ui:include src="../../includes/pluginPreferencesForm.xhtml">
                    <ui:param name="pluginDiv" value="feedTeasers"/>
                    <ui:param name="pluginPreferencesEditor" value="#{feedTeasersPreferencesEditor}"/>
                </ui:include>
            </div>
        </s:div>

        <h:dataTable value="#{feedTeasersPlugin.teasers}" var="fe"
                     styleClass="datatable rightBorder leftBorder topBorder bottomBorder feedTeaserTable"
                     headerClass="regularHeader alignLeft feedTeaserHeader"
                     columnClasses="teaserColumn"
                     rowClasses="rowOdd, rowEven"
                     cellpadding="0" cellspacing="0" border="0">
            <h:column>
                <f:facet name="header"><h:outputText value="#{feedTeasersPreferences.properties['teaserTitle']}"/></f:facet>

                <div class="teaserAuthorDate">
                    <s:span styleClass="teaserDate">
                        <h:outputText value="#{fe.updatedDate}"><f:convertDateTime pattern="dd. MMM yyyy, HH:mm" timeZone="#{wikiPreferences.timeZone}"/></h:outputText>
                        <h:outputText value="&#160;#{wikiPreferences.timeZone}"/>
                    </s:span>
                    <s:span rendered="#{feedTeasersPreferences.properties['showAuthor']}">,&#160;#{messages['feedTeasers.label.By']}&#160;
                        <h:outputLink target="_top" value="#{wiki:renderHomeURL(fe.document.createdBy)}"
                                      rendered="#{!empty fe.document.createdBy.memberHome}">
                            <h:outputText styleClass="teaserAuthorLink" value="#{fe.document.createdBy.fullname}"/>
                        </h:outputLink>
                        <h:outputText styleClass="teaserAuthor" rendered="#{empty fe.document.createdBy.memberHome}" value="#{fe.author}"/>
                    </s:span>
                    <br/>
                    <s:span rendered="#{fe.document.enableComments and wiki:sizeOf(fe.document.comments) > 0}" styleClass="undecoratedLink">
                        <h:outputLink target="_top" styleClass="feedTeaserComments" value="#{wiki:renderPermLink(fe.document)}#comments">
                            #{wiki:sizeOf(fe.document.comments)}&#160;
                            <h:outputText value="#{wiki:sizeOf(fe.document.comments)>1
                                                 ? messages['lacewiki.label.commentsDisplay.Comments']
                                                 : messages['lacewiki.label.commentsDisplay.Comment']}"/>
                        </h:outputLink>
                    </s:span>
                </div>

                <div class="teaserTitle">
                    <h:outputLink target="_top" value="#{fe.link}">#{fe.title}</h:outputLink>
                </div>

                <h:outputText styleClass="teaserBody"
                              value="#{wiki:truncateString(fe.descriptionValueStripped, feedTeasersPreferences.properties['truncateDescription'], '')}"/>
                <h:outputLink target="_top" styleClass="teaserBody"
                              value="#{fe.link}"
                              rendered="#{wiki:length(fe.descriptionValueStripped) > feedTeasersPreferences.properties['truncateDescription']}">
                    &#160;#{messages['feedTeasers.label.More']}
                </h:outputLink>

            </h:column>
        </h:dataTable>

    </s:div>
    
</wiki:plugin>