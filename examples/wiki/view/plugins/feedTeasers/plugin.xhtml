<wiki:plugin
       xmlns="http://www.w3.org/1999/xhtml"
       xmlns:ui="http://java.sun.com/jsf/facelets"
       xmlns:h="http://java.sun.com/jsf/html"
       xmlns:a="https://ajax4jsf.dev.java.net/ajax"
       xmlns:f="http://java.sun.com/jsf/core"
       xmlns:wiki="http://jboss.com/products/seam/wiki"
       xmlns:s="http://jboss.com/products/seam/taglib">

    <s:div styleClass="feedTeasers box">

        <s:div styleClass="boxHeader">
            <h:outputText value="#{preferences.get('FeedTeasers', currentMacro).title}"/>
        </s:div>

        <div class="boxContent">

            <h:dataTable value="#{feedTeasers.teasers}" var="fe"
                         styleClass="datatable feedTeaserTable"
                         columnClasses="teaserColumn"
                         rowClasses="rowOdd, rowEven"
                         cellpadding="0" cellspacing="0" border="0">
                <h:column>
                    <div class="teaserAuthorDate smallFont">
                        <s:span styleClass="teaserDate">
                            <h:outputText value="#{fe.updatedDate}">
                                <f:convertDateTime pattern="dd. MMM yyyy, HH:mm" timeZone="#{preferences.get('Wiki').timeZone}"/>
                            </h:outputText>
                            <h:outputText value="&#160;#{preferences.get('Wiki').timeZone}"/>
                        </s:span>
                        <s:span styleClass="undecoratedLink"
                                rendered="#{preferences.get('FeedTeasers', currentMacro).showAuthor}">
                            <h:outputText value=",&#160;#{messages['feedTeasers.label.By']}&#160;"/>
                            <h:outputText styleClass="teaserAuthor" value="#{fe.author}"/>
                        </s:span>

                        <!-- TODO: Fix this somehow... it was an ugly hack anyway
                        <s:div rendered="#{fe.document.enableComments and wiki:sizeOf(fe.document.comments) > 0}" styleClass="undecoratedLink">
                            <h:outputLink target="_top" styleClass="feedTeaserComments" value="#{wiki:renderPermURL(fe.document)}#comments">
                                #{wiki:sizeOf(fe.document.comments)}&#160;
                                <h:outputText value="#{wiki:sizeOf(fe.document.comments)>1
                                                     ? messages['lacewiki.label.commentsDisplay.Comments']
                                                     : messages['lacewiki.label.commentsDisplay.Comment']}"/>
                            </h:outputLink>
                        </s:div>
                        -->
                    </div>

                    <div class="teaserTitle undecoratedLink">
                        <h:outputLink target="_top" value="#{fe.link}">
                            <h:outputText escape="false" value="#{fe.titleStripped}"/>
                        </h:outputLink>
                    </div>

                    <s:fragment rendered="#{fe.teaserMarkerPresent}">
                        <h:outputText styleClass="teaserBody" value="#{fe.teaserStripped}"/>
                        <h:outputLink target="_top" styleClass="teaserBody" value="#{fe.link}">
                             &#160;#{messages['feedTeasers.label.More']}
                         </h:outputLink>
                    </s:fragment>

                    <s:fragment rendered="#{not fe.teaserMarkerPresent}">
                        <h:outputText styleClass="teaserBody"
                                      value="#{wiki:truncateStringOnWordBoundary(fe.descriptionValueStripped, preferences.get('FeedTeasers', currentMacro).truncateDescription)}"/>

                        <h:outputLink target="_top" styleClass="teaserBody"
                                      value="#{fe.link}"
                                      rendered="#{wiki:length(fe.descriptionValueStripped) > preferences.get('FeedTeasers', currentMacro).truncateDescription}">
                            &#160;#{messages['feedTeasers.label.More']}
                        </h:outputLink>
                    </s:fragment>


                </h:column>
            </h:dataTable>

        </div>

        <div class="boxFooter"/>

    </s:div>
    
</wiki:plugin>