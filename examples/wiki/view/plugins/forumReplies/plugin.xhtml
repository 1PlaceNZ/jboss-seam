<wiki:plugin id="forumRepliesPlugin"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:c="http://java.sun.com/jstl/core"
        xmlns:wiki="http://jboss.com/products/seam/wiki"
        xmlns:a="https://ajax4jsf.dev.java.net/ajax"
        xmlns:s="http://jboss.com/products/seam/taglib">


    <!-- The forumPostingDocumentWrapper <div> is open! -->

        <s:div styleClass="commentSignature"
               rendered="#{not empty currentDocument.createdBy.profile.signature and not empty currentDocument.areaNumber}">
            <s:div styleClass="commentSignatureSeparator">
                <h:outputText value="&#160;"/>
            </s:div>
            <wiki:formattedText value="#{currentDocument.createdBy.profile.signature}"
                                linkStyleClass="regularLink"
                                brokenLinkStyleClass="brokenLink"
                                attachmentLinkStyleClass="regularLink"
                                thumbnailLinkStyleClass="regularLink"
                                linkBaseFile="#{currentDocument}"
                                currentAreaNumber="#{currentDocument.areaNumber}"
                                enablePlugins="false"/>
        </s:div>

        <s:div id="forumPostingControls" styleClass="forumPostingControls">

            <h:panelGroup rendered="#{not replyHome.showForm and replyHome.hasReplyPermission()}">

                <s:link tabindex="1"
                        action="#{replyHome.replyToDocument()}"
                        accesskey="#{messages['forum.button.Reply.accesskey']}"
                        styleClass="buttonNonpersistent">
                    <h:outputText styleClass="buttonLabel" escape="false" value="#{messages['forum.button.Reply']}"/>
                 </s:link>

                <s:link tabindex="1"
                        action="#{replyHome.quoteDocument()}"
                        styleClass="buttonNonpersistent"
                        accesskey="#{messages['forum.button.Quote.accesskey']}">
                     <h:outputText styleClass="buttonLabel" escape="false" value="#{messages['forum.button.Quote']}"/>
                 </s:link>

            </h:panelGroup>

        </s:div>

    <!-- The forumPostingDocumentWrapper <div> is closed here! -->
    <h:outputText escape="false" value="&lt;/div>"/>

    <s:span id="forumRepliesContainer">

        <s:fragment rendered="#{currentDocument.enableComments}">

            <ui:decorate template="../../includes/commentsDisplay.xhtml">
                <ui:param name="titleSingular" value="#{messages['forum.label.Reply']}"/>
                <ui:param name="titlePlural" value="#{messages['forum.label.Replies']}"/>
                <ui:define name="controls">

                    <s:fragment rendered="#{not replyHome.showForm and replyHome.hasReplyPermission()}">

                        <s:link tabindex="102"
                                action="#{replyHome.replyTo()}"
                                styleClass="buttonNonpersistent">
                            <f:param name="parentCommentId" value="#{c.id}"/>
                            <h:outputText styleClass="buttonLabel" value="#{messages['lacewiki.button.commentsDisplay.ReplyTo']}"/>
                        </s:link>

                        <s:link tabindex="102"
                                action="#{replyHome.quote()}"
                                styleClass="buttonNonpersistent">
                            <f:param name="parentCommentId" value="#{c.id}"/>
                            <h:outputText styleClass="buttonLabel" value="#{messages['lacewiki.button.commentsDisplay.Quote']}"/>
                        </s:link>

                    </s:fragment>

                     <s:fragment rendered="#{s:hasPermission('Comment', 'delete', currentDocument) and not replyHome.showForm}">
                        <a:jsFunction name="deleteReplyId#{c.id}"
                                      reRender="forumRepliesContainer"
                                      action="#{replyHome.remove(c.id)}"/>
                            <h:outputLink value="#"
                                  onclick="deleteConfirmation('#{messages['lacewiki.label.commentsDisplay.CommentThread']} \\'#{c.subject}\\'', 'deleteReplyId#{c.id}')"
                                  styleClass="button sessionEventTrigger">
                                <h:outputText styleClass="buttonLabel" value="#{messages['lacewiki.button.commentsDisplay.RemoveComment']}"/>
                        </h:outputLink>
                    </s:fragment>
                </ui:define>
            </ui:decorate>

            <ui:include src="replyForm.xhtml">
                <ui:param name="home" value="#{replyHome}"/>
            </ui:include>

        </s:fragment>

    </s:span>

</wiki:plugin>