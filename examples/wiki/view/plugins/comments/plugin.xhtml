<wiki:plugin
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:a="https://ajax4jsf.dev.java.net/ajax"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:wiki="http://jboss.com/products/seam/wiki"
        xmlns:s="http://jboss.com/products/seam/taglib">
<s:div styleClass="#{showPluginPreferences and !empty commentsPreferencesEditor ? 'pluginPreferencesBox' : null}">

<s:div id="commentsPreferences"
       rendered="#{showPluginPreferences and !empty commentsPreferencesEditor}">
    <div align="center">
        <h:message for="commentsPreferences" styleClass="attentionMessage"/>

        <ui:include src="../../includes/pluginPreferencesForm.xhtml">
            <ui:param name="pluginPreferencesEditor" value="#{commentsPreferencesEditor}"/>
        </ui:include>
    </div>
</s:div>

<h:dataTable value="#{commentHome.comments}" var="c" style="margin-top:10px;"
             rendered="#{not empty commentHome.comments}"
             styleClass="datatable rightBorder leftBorder topBorder bottomBorder"
             headerClass="regularHeader alignLeft"
             columnClasses="commentColumn"
             rowClasses="rowOdd,rowEven"
             cellpadding="0" cellspacing="0" border="0">
    <h:column>
        <f:facet name="header">
            #{wiki:sizeOf(commentHome.comments)} comment(s):
        </f:facet>

        <div class="commentSubject">
            #{c.subject}
        </div>

        <div class="commentAuthorDate">
            <span class="commentDate"><h:outputText value="#{c.createdOn}">
                <f:convertDateTime pattern="dd. MMM yyyy, HH:mm"/>
            </h:outputText></span>
            <s:span>&#160;(<s:span styleClass="commentAuthor" rendered="#{empty c.fromUserHomepage}">#{c.fromUserName}</s:span>
                <s:span styleClass="commentAuthor" rendered="#{!empty c.fromUserHomepage}"><a
                        href="http://#{c.fromUserHomepage}">#{c.fromUserName}</a></s:span>
                <s:span styleClass="commentAuthor" rendered="#{!empty c.fromUserEmail}">, <a
                        href="mailto:#{c.fromUserEmail}">#{c.fromUserEmail}</a></s:span>)
            </s:span>
        </div>

        <s:div styleClass="commentText">
            <s:formattedText value="#{c.text}"/>
        </s:div>

    </h:column>
</h:dataTable>


<h:form id="commentForm" styleClass="commentForm">
    <div class="form">
        <div class="formHead">Post new comment:</div>

        <div class="formFields formBorder wideLabels">

            <s:validateAll>

                <s:decorate id="userNameDecorate">
                    <div class="entry">
                        <div class="label">Name:</div>
                        <div class="input">
                            <h:inputText tabindex="102" size="40" maxlength="100" required="true"
                                         id="userName" value="#{commentHome.comment.fromUserName}">
                                <a:support event="onblur" reRender="userNameDecorate"/>
                            </h:inputText>
                        </div>
                    </div>
                </s:decorate>

                <s:decorate id="userEmailDecorate">
                    <div class="entry">
                        <div class="label">E-mail address (optional):</div>
                        <div class="input">
                            <h:inputText tabindex="102" size="40" maxlength="255" required="false"
                                         id="userEmail" value="#{commentHome.comment.fromUserEmail}">
                            </h:inputText>
                        </div>
                    </div>
                </s:decorate>

                <s:decorate id="userHomepageDecorate">
                    <div class="entry">
                        <div class="label">Homepage URL (optional):</div>
                        <div class="input">
                            <h:inputText tabindex="102" size="40" maxlength="1000" required="false"
                                         id="userHomepage" value="#{commentHome.comment.fromUserHomepage}">
                            </h:inputText>
                        </div>
                    </div>
                </s:decorate>

                <s:decorate id="subjectDecorate">
                    <div class="entry">
                        <div class="label">Subject:</div>
                        <div class="input">
                            <h:inputText tabindex="102" size="40" maxlength="255" required="true"
                                         id="subject" value="#{commentHome.comment.subject}">
                                <a:support event="onblur" reRender="subjectDecorate"/>
                            </h:inputText>
                        </div>
                    </div>
                </s:decorate>

                <s:decorate id="commentDecorate">
                    <div class="entry">
                        <div class="label">Comment:</div>
                        <s:div styleClass="input" id="commentText">
                            <h:inputTextarea tabindex="102" required="true"
                                             cols="40"
                                             rows="10"
                                             id="commentTextInput"
                                             value="#{commentHome.comment.text}">
                                <a:support event="onblur" reRender="commentDecorate"/>
                            </h:inputTextarea>
                        </s:div>
                    </div>
                </s:decorate>


            </s:validateAll>

        </div>

        <div class="formControls wideLabels">
            <div class="entry">
                <div class="label">&#160;</div>
                <div class="input">

                    <h:commandLink action="#{commentHome.persist}" tabindex="102"
                                   styleClass="button"><span class="buttonLabel">Post</span></h:commandLink>

                </div>
            </div>
        </div>

    </div>
</h:form>

</s:div>
</wiki:plugin>