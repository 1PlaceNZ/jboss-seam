<ui:decorate template="popupDialog.xhtml"
         xmlns:s="http://jboss.com/products/seam/taglib"
         xmlns:ui="http://java.sun.com/jsf/facelets"
         xmlns:f="http://java.sun.com/jsf/core"
         xmlns:h="http://java.sun.com/jsf/html"
         xmlns:a="https://ajax4jsf.dev.java.net/ajax"
         xmlns:wiki="http://jboss.com/products/seam/wiki">

    <ui:param  name="hideCancelButton" value="true"/>
    <ui:define name="dialogInit">
            <script type="text/javascript">jQuery(function() {
                var showPopupAndHideTrigger = function(hash) {
                    hash.w.show();
                    jQuery(".closeDialog", hash.w).attr("accesskey", "C"); // Dynamically assign accesskey to .closeDialog buttons
                    jQuery("##{namingContainer}\\:#{dialogId}TriggerContainer").hide();
                    jQuery('##{namingContainer}\\:#{dialogId}TextArea').focus();
                };

                var hidePopupAndShowTrigger = function(hash) {
                    hash.w.hide();
                    jQuery("##{namingContainer}\\:#{dialogId}TriggerContainer").show();
                    jQuery('##{namingContainer}\\:#{dialogId}TextArea').focus();
                };

                jsf('#{dialogId}Popup')
                    .css({ minWidth: "350px", width: "350px",
                           minHeight: jQuery("##{namingContainer}\\:#{dialogId}Content").height()+115+"px",
                           height: jQuery("##{namingContainer}\\:#{dialogId}Content").height()+115+"px",
                           top: "#{positionTop}", left: "#{positionLeft}"})
                    .jqm({
                        trigger: jQuery("##{namingContainer}\\:#{dialogId}Trigger"),
                        closeClass: "closeDialog",
                        onShow: showPopupAndHideTrigger,
                        onHide: hidePopupAndShowTrigger,
                        overlay: 0
                    });
            });</script>
    </ui:define>
    <ui:define name="dialogTitle">Automatic Preview</ui:define>
    <ui:define name="dialogContent">
        <wiki:formattedText value="#{previewWikiText}"
                            linkStyleClass="regularLink"
                            brokenLinkStyleClass="brokenLink"
                            attachmentLinkStyleClass="regularLink"
                            thumbnailLinkStyleClass="regularLink"
                            renderBaseDocument="#{previewBaseDocument}"
                            renderBaseDirectory="#{previewBaseDirectory}"
                            enablePlugins="false"/>
        <script type="text/javascript">jQuery(function() {
            jsf('#{dialogId}Popup')
                .css({ minHeight: jQuery("##{namingContainer}\\:#{dialogId}Content").height()+115+"px",
                       height: jQuery("##{namingContainer}\\:#{dialogId}Content").height()+115+"px"
                    })
        });</script>
    </ui:define>
    <ui:define name="dialogControls">
        <h:outputLink styleClass="buttonNonpersistent closeDialog"
                      accesskey="C"><span class="buttonLabel"><u>C</u>lose Preview</span></h:outputLink>
    </ui:define>

</ui:decorate>