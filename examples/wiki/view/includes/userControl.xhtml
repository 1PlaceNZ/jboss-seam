<div id="userControl"
     xmlns="http://www.w3.org/1999/xhtml"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:wiki="http://jboss.com/products/seam/wiki"
     xmlns:rich="http://richfaces.ajax4jsf.org/rich"
     xmlns:s="http://jboss.com/products/seam/taglib">

    <s:div rendered="#{not identity.loggedIn}">
        <h:form>
            <h:panelGroup>
                <h:outputLabel styleClass="userControlLabel" for="loginUsername" value="Username:"/>
                <h:inputText styleClass="userControlInput" id="loginUsername" value="#{identity.username}" size="8" tabindex="50"/>
                <h:outputLabel styleClass="userControlLabel" for="loginPassword" value="Password:"/>
                <h:inputSecret styleClass="userControlInput" id="loginPassword" value="#{identity.password}" size="8" tabindex="51"/>
                <h:commandLink styleClass="userControlLink" action="#{identity.login}" tabindex="52" accesskey="L"><u>L</u>ogin</h:commandLink>

                <s:link styleClass="userControlLink" action="register" tabindex="53" accesskey="R" propagation="none"
                        rendered="#{userManagementPreferences.properties['enableRegistration']}">
                    <f:param name="lastConversationId" value="#{conversation.id}"/>
                    <u>R</u>egister
                </s:link>

                <s:link styleClass="userControlLink" action="listUsers" tabindex="54" accesskey="M" propagation="none">
                    <f:param name="lastConversationId" value="#{conversation.id}"/>
                    <u>M</u>embers
                </s:link>

            </h:panelGroup>
        </h:form>
    </s:div>

    <s:div rendered="#{identity.loggedIn}">

        <script type="text/javascript">
            setTimeout( 'javascript:Richfaces.showModalPanel(\'timeoutNotice\', {width:280, height:120})', '#{wiki:getSessionTimeoutSeconds() * 1000}' );
        </script>

        <ui:decorate template="confirmationModalDialog.xhtml">
            <ui:param name="confirmationModalDialogId" value="timeoutNotice"/>
            <ui:param name="confirmationHideCancel" value="true"/>
            <ui:define name="confirmationTitle">
                Notice
            </ui:define>
            <ui:define name="confirmationContent">
                <p>Your session has timed out, please login again.</p>
            </ui:define>
            <ui:define name="confirmationOption">
                <h:outputLink id="OKRedirect"
                              onclick="Richfaces.hideModalPanel('#{confirmationModalDialogId}')"
                              value="#{wiki:renderURL(wikiStart)}"
                              styleClass="buttonNonpersistent"><span class="buttonLabel">Take me to the start page</span></h:outputLink>
                <h:outputLink id="OK"
                              onclick="Richfaces.hideModalPanel('#{confirmationModalDialogId}')"
                              styleClass="buttonNonpersistent"><span class="buttonLabel">Close message</span></h:outputLink>
            </ui:define>
        </ui:decorate>

        <h:form>
            <h:panelGroup>
                <h:outputText styleClass="userControlLabel" value="(#{currentUser.fullname})"/>

                <s:link styleClass="userControlLink" action="#{authenticator.logout}" tabindex="70" accesskey="L"><u>L</u>ogout</s:link>

                <h:outputLink styleClass="userControlLink" value="#{wiki:renderHomeURL(currentUser)}"
                        rendered="#{!empty currentUser.memberHome}" tabindex="72" accesskey="H"><u>H</u>ome</h:outputLink>

                <s:link styleClass="userControlLink" action="editUser" tabindex="71" accesskey="P" propagation="none">
                    <f:param name="lastConversationId" value="#{conversation.id}"/>
                    <f:param name="userId" value="#{currentUser.id}"/>
                    <u>P</u>rofile
                </s:link>

                <s:link styleClass="userControlLink" action="listUsers" tabindex="73" accesskey="M" propagation="none">
                    <f:param name="lastConversationId" value="#{conversation.id}"/>
                    <u>M</u>embers
                </s:link>

                <s:link styleClass="userControlLink" action="adminHome" tabindex="74" accesskey="A" propagation="none"
                        rendered="#{s:hasPermission('User', 'isAdmin', currentUser)}">
                    <f:param name="lastConversationId" value="#{conversation.id}"/>
                    <u>A</u>dmin
                </s:link>

            </h:panelGroup>
        </h:form>
    </s:div>

</div>
