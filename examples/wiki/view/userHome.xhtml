<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:rich="http://richfaces.ajax4jsf.org/rich"
                xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                template="themes/#{wikiPreferences.themeName}/template.xhtml">

<ui:define name="includeHeaders">
    <link href="#{themePath}/css/userControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/searchControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/mainMenu.css" rel="stylesheet" type="text/css"/>
</ui:define>

<ui:define name="screenname">
    <h:outputText value="Member Account '#{userHome.instance.username}'"/>
</ui:define>

<ui:define name="headerTopRight">
    <ui:include src="includes/userControl.xhtml"/>
</ui:define>

<ui:define name="headerBottomLeft">&#160;</ui:define>

<ui:define name="sidebar">
    <ui:include src="includes/searchControl.xhtml"/>
    <ui:include src="includes/mainMenu.xhtml"/>
</ui:define>

<ui:define name="controlLeft">&#160;</ui:define>

<ui:define name="controlRight">
    <s:link id="exit" styleClass="linkNavigation"
            action="#{browser.exitConversation(true)}"
            accesskey="E"><u>E</u>xit</s:link>
</ui:define>

<ui:define name="content">

<h:form><div class="form">

    <rich:panelBar styleClass="formPanel"
                   headerStyle="border:0;margin:0;padding-left:13px;padding-top:3px;padding-bottom:3px;color: #555;background: #fff url(/wiki/themes/default/img/th.bg.gif) 0 0 repeat-x;">

        <rich:panelBarItem label="Account">

            <div class="formFields wideLabels">
                <s:validateAll>

                    <s:decorate id="firstnameDecorate">
                        <div class="entry">
                            <div class="label">First name:</div>
                            <div class="input">
                                <h:inputText tabindex="1" size="40" maxlength="63" required="true"
                                             id="firstname" value="#{userHome.instance.firstname}">
                                    <a:support event="onblur" reRender="firstnameDecorate"/>
                                </h:inputText>
                            </div>
                        </div>
                    </s:decorate>

                    <s:decorate  id="lastnameDecorate">
                        <div class="entry">
                            <div class="label">Last name:</div>
                            <div class="input">
                                <h:inputText tabindex="2" size="40" maxlength="63" required="true"
                                             id="lastname" value="#{userHome.instance.lastname}">
                                    <a:support event="onblur" reRender="lastnameDecorate"/>
                                </h:inputText>
                            </div>
                        </div>
                    </s:decorate>

                    <s:decorate id="emailDecorate">
                        <div class="entry">
                            <div class="label">E-Mail:</div>
                            <div class="input">
                                <h:inputText tabindex="3" size="40" maxlength="255" required="true"
                                             id="email" value="#{userHome.instance.email}"
                                             disabled="#{userHome.instance.username == guestUser.username}">
                                    <a:support event="onblur" reRender="emailDecorate"/>
                                </h:inputText>
                            </div>
                        </div>
                    </s:decorate>

                    <s:decorate id="usernameDecorate">
                        <div class="entry">
                            <div class="label">Username:</div>
                            <div class="input">
                                <h:inputText tabindex="4" size="16" maxlength="16" required="true"
                                             id="username" value="#{userHome.instance.username}"
                                             disabled="#{userHome.instance.username == adminUser.username
                                                         or userHome.instance.username == guestUser.username}">
                                    <a:support event="onblur" action="#{userHome.validateUsername}" reRender="usernameDecorate"/>
                                </h:inputText>
                            </div>
                        </div>
                    </s:decorate>

                    <s:decorate id="passwordDecorate">
                        <div class="entry">
                            <div class="label">Password:</div>
                            <div class="input">
                                <h:inputSecret tabindex="5" size="15" maxlength="15"
                                               id="password" redisplay="true" value="#{userHome.password}"
                                               disabled="#{userHome.instance.username == guestUser.username}">
                                    <a:support event="onblur" action="#{userHome.validatePassword}" reRender="passwordDecorate"/>
                                </h:inputSecret>
                            </div>
                        </div>
                    </s:decorate>

                    <s:decorate id="passwordControlDecorate">
                        <div class="entry">
                            <div class="label">Repeat password:</div>
                            <div class="input">
                                <h:inputSecret tabindex="6" size="15" maxlength="15"
                                               id="passwordControl" redisplay="true" value="#{userHome.passwordControl}"
                                               disabled="#{userHome.instance.username == guestUser.username}">
                                <a:support event="onblur" action="#{userHome.validatePasswordControl}" reRender="passwordControlDecorate"/>
                            </h:inputSecret>
                            </div>
                        </div>
                    </s:decorate>

                    <s:div styleClass="entry">
                        <s:div styleClass="label">Roles:</s:div>
                        <div class="input">
                            <h:selectManyListbox value="#{userHome.roles}" tabindex="8"
                                    disabled="#{!s:hasPermission('User', 'editRoles', currentUser)
                                                or userHome.instance.id == adminUser.id
                                                or userHome.instance.id == guestUser.id}"
                                    converter="#{entityConverter}">
                                <s:selectItems value="#{rolesList}"
                                               var="role"
                                               label="#{role.displayName} (Access level: #{role.accessLevel})"/>
                            </h:selectManyListbox>
                        </div>
                    </s:div>

                </s:validateAll>

            </div>

        </rich:panelBarItem>

        <rich:panelBarItem label="Profile">
           Not implemented
        </rich:panelBarItem>

        <rich:panelBarItem label="Preferences">

            <ui:include src="includes/preferencesEditor.xhtml">
                <ui:param name="preferenceComponents" value="#{userPreferenceComponents}"/>
            </ui:include>

        </rich:panelBarItem>

    </rich:panelBar>

    <div class="formControls wideLabels">

        <div class="entry">
            <div class="label">&#160;</div>
            <div class="input">

                <h:commandLink id="createHomeDirectory" styleClass="buttonNonpersistent"
                               rendered="#{empty userHome.instance.memberHome
                                           and userHome.instance.id != guestUser.id
                                           and userHome.instance.id != adminUser.id
                                           and s:hasPermission('User', 'isAdmin', currentUser)}"
                               action="#{userHome.createHomeDirectory}"><span class="buttonLabel">Create Home Directory</span></h:commandLink>

                <h:commandLink id="update" styleClass="button"
                               action="#{userHome.update}"
                               tabindex="9" accesskey="U"><span class="buttonLabel"><u>U</u>pdate</span></h:commandLink>

                <h:outputLink id="delete" value="javascript:Richfaces.showModalPanel('deleteConfirmation',{width:375, height:125})"
                              rendered="#{s:hasPermission('User', 'delete', userHome.instance)}"
                              tabindex="9" accesskey="D" styleClass="button"><span class="buttonLabel"><u>D</u>elete</span></h:outputLink>

            </div>
        </div>

    </div>

</div></h:form>

<ui:decorate template="includes/confirmationModalDialog.xhtml">
    <ui:param name="confirmationModalDialogId" value="deleteConfirmation"/>
    <ui:define name="confirmationContent">
        <p>Are you sure you want to delete the user '#{userHome.instance.username}'?
            Note that any existing home directory or documents owned by this user will not be deleted.</p>
    </ui:define>
    <ui:define name="confirmationOption">
        <h:commandLink id="delete" action="#{userHome.remove}"
                       accesskey="O" styleClass="button">
            <span class="buttonLabel"><u>O</u>k</span>
        </h:commandLink>
    </ui:define>
</ui:decorate>


</ui:define>

<ui:define name="footer">&#160;</ui:define>

</ui:composition>

