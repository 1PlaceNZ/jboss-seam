<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                template="themes/#{preferences.get('Wiki').themeName}/template.xhtml">

<ui:define name="screenname">#{directoryHome.instance.name}</ui:define>

<ui:define name="controlTwo">

    <s:fragment rendered="#{!empty directoryHome.parentNode}">

        <s:link id="createDir" styleClass="linkNavigation"
                accesskey="#{messages['lacewiki.button.CreateSubdirectory.accesskey']}"
                view="/dirEdit_#{skin}.xhtml"
                rendered="#{s:hasPermission('Node', 'create', directoryHome.instance)}">
            <h:outputText escape="false" value="#{messages['lacewiki.button.CreateSubdirectory']}"/>
            <f:param name="directoryId"/>
            <f:param name="parentDirectoryId" value="#{directoryHome.instance.id}"/>
        </s:link>

        <s:link id="editDir" styleClass="linkNavigation"
                accesskey="#{messages['lacewiki.button.EditDirectory.accesskey']}"
                view="/dirEdit_#{skin}.xhtml"
                rendered="#{s:hasPermission('Node', 'edit', directoryHome.instance)}">
            <h:outputText escape="false" value="#{messages['lacewiki.button.EditDirectory']}"/>
        </s:link>

        <s:link id="createDoc" styleClass="linkNavigation"
                accesskey="#{messages['lacewiki.button.NewDocument.accesskey']}"
                view="/docEdit_#{skin}.xhtml"
                rendered="#{s:hasPermission('Node', 'create', directoryHome.instance)}">
            <h:outputText escape="false" value="#{messages['lacewiki.button.NewDocument']}"/>
            <f:param name="documentId"/>
            <f:param name="parentDirectoryId" value="#{directoryHome.instance.id}"/>
        </s:link>

        <s:link id="uploadFile" styleClass="linkNavigation"
                accesskey="#{messages['lacewiki.button.UploadFile.accesskey']}"
                view="/uploadCreate_#{skin}.xhtml"
                rendered="#{s:hasPermission('Node', 'create', directoryHome.instance)}">
            <h:outputText escape="false" value="#{messages['lacewiki.button.UploadFile']}"/>
            <f:param name="parentDirectoryId" value="#{directoryHome.instance.id}"/>
        </s:link>

    </s:fragment>

    <s:fragment rendered="#{empty directoryHome.parentNode}">
        <s:link id="createArea" styleClass="linkNavigation"
                accesskey="#{messages['lacewiki.button.NewArea.accesskey']}"
                view="/dirEdit_#{skin}.xhtml"
                rendered="#{s:hasPermission('Node', 'create', directoryHome.instance)}">
            <h:outputText escape="false" value="#{messages['lacewiki.button.NewArea']}"/>
            <f:param name="directoryId"/>
            <f:param name="parentDirectoryId" value="#{directoryHome.instance.id}"/>
        </s:link>

        <s:link id="editRoot" styleClass="linkNavigation"
                accesskey="#{messages['lacewiki.button.EditWikiRoot.accesskey']}"
                view="/dirEdit_#{skin}.xhtml"
                rendered="#{s:hasPermission('Node', 'edit', directoryHome.instance)}">
            <h:outputText escape="false" value="#{messages['lacewiki.button.EditWikiRoot']}"/>
            <f:param name="parentDirectoryId"/>
        </s:link>

    </s:fragment>

    <h:outputLink value="#{wiki:renderFeedURL(directoryHome.instance.feed, null, null)}"
                  styleClass="linkNavigation" rendered="#{not empty directoryHome.instance.feed}">
        <h:graphicImage styleClass="feedIcon" value="/themes/#{preferences.get('Wiki').themeName}/img/icon.atom.gif" width="18" height="18"/>
        <h:outputText value="#{messages['lacewiki.button.DirectoryFeed']}"/>
    </h:outputLink>

</ui:define>

<ui:define name="content">

<h:form id="dirSelectionForm">

<div class="box">

    <script type="text/javascript">
        function switchClipboardControl() {
            var clipboardControlsEnabled = false
            jQuery(".wikiFileSelect").each(
                function checkSelected() {
                    if (jQuery(this).attr("checked")) {
                        clipboardControlsEnabled = true;
                    }
                }
            );
            if (clipboardControlsEnabled) {
                jQuery(".clipboardControl").show();
            } else {
                jQuery(".clipboardControl").hide();
            }
        }
    </script>

    <h:panelGrid columns="3"
                 styleClass="directoryControl smallFont" 
                 columnClasses="directorySelectControl, directoryTrash, directoryClipboard"
                 cellpadding="0" cellspacing="0" border="0">

        <s:fragment>
            <h:panelGroup styleClass="undecoratedLink"
                          rendered="#{childNodesList.size > 0 and directoryHome.instance.id != wikiRoot.id}">
                <h:outputText value="#{messages['lacewiki.label.Clipboard.Select']}:&#160;"/>
                <h:outputLink value="#" onclick="selectCheckBoxes('wikiFileSelect'); switchClipboardControl();" tabindex="1">
                    <h:outputText value="#{messages['lacewiki.label.Clipboard.All']}"/>
                </h:outputLink>
                <h:outputText value="&#160;|&#160;"/>
                <h:outputLink value="#" onclick="deselectCheckBoxes('wikiFileSelect'); switchClipboardControl();" tabindex="1">
                    <h:outputText value="#{messages['lacewiki.label.Clipboard.None']}"/>
                </h:outputLink>
                <h:outputText value="&#160;|&#160;"/>
                <h:outputLink value="#"  tabindex="1"
                              onclick="deselectCheckBoxes('wikiFileSelect'); selectCheckBoxes('wikiDocumentSelect'); switchClipboardControl();">
                    <h:outputText value="#{messages['lacewiki.label.Clipboard.Documents']}"/>
                </h:outputLink>
                <h:outputText value="&#160;|&#160;"/>
                <h:outputLink value="#" tabindex="1"
                              onclick="deselectCheckBoxes('wikiFileSelect'); selectCheckBoxes('wikiUploadSelect'); switchClipboardControl();">
                    <h:outputText value="#{messages['lacewiki.label.Clipboard.UploadedFiles']}"/>
                </h:outputLink>
            </h:panelGroup>
        </s:fragment>

        <s:fragment>
            <h:panelGroup rendered="#{directoryHome.instance.id == trashArea.id and s:hasPermission('Trash', 'empty', directoryHome.instance)}">
                <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/icon.trash.gif"
                                width="18" height="20" style="vertical-align:middle;"/>
                <h:commandLink action="#{directoryHome.emptyTrash()}"
                               tabindex="1" styleClass="button">
                    <h:outputText styleClass="buttonLabel" value="#{messages['lacewiki.button.EmptyTrash']}"/>
                </h:commandLink>
            </h:panelGroup>
        </s:fragment>

        <s:fragment>
            <h:panelGroup>
                <s:span>
                    <h:outputText value="#{messages['lacewiki.label.Clipboard']}&#160;"/>
                    <h:outputText value="(#{clipboard.items.size()} #{messages['lacewiki.label.Clipboard.Items']})" rendered="#{clipboard.items.size() > 1}"/>
                    <h:outputText value="(#{clipboard.items.size()} #{messages['lacewiki.label.Clipboard.Item']})" rendered="#{clipboard.items.size() == 1}"/>
                    <h:outputText value="(#{messages['lacewiki.label.Clipboard.Empty']})" rendered="#{empty clipboard.items}"/>
                    <h:outputText value=":&#160;" styleClass="#{empty clipboard.items ? 'clipboardControl': ''}"
                                  style="display:#{empty clipboard.items ? 'none':'inherit'}"/>
                </s:span>

                <h:commandLink action="#{directoryHome.copy()}" style="display:none;"
                               tabindex="1" styleClass="buttonNonpersistent clipboardControl"
                               accesskey="#{messages['lacewiki.button.Clipboard.Copy.accesskey']}">
                    <h:outputText styleClass="buttonLabel" escape="false" value="#{messages['lacewiki.button.Clipboard.Copy']}"/>
                </h:commandLink>
                <h:commandLink action="#{directoryHome.cut()}" style="display:none;"
                               rendered="#{s:hasPermission('Node', 'edit', directoryHome.instance)}"
                               tabindex="1" styleClass="buttonNonpersistent clipboardControl"
                               accesskey="#{messages['lacewiki.button.Clipboard.Cut.accesskey']}">
                    <h:outputText styleClass="buttonLabel" escape="false" value="#{messages['lacewiki.button.Clipboard.Cut']}"/>
                </h:commandLink>
                <h:commandLink action="#{directoryHome.clearClipboard()}"
                               rendered="#{not empty clipboard.items}"
                               tabindex="1"
                               accesskey="#{messages['lacewiki.button.Clipboard.Clear.accesskey']}"
                               styleClass="buttonNonpersistent">
                    <h:outputText styleClass="buttonLabel" escape="false" value="#{messages['lacewiki.button.Clipboard.Clear']}"/>
                </h:commandLink>
                <h:commandLink action="#{directoryHome.paste()}"
                               rendered="#{not empty clipboard.items and directoryHome.instance.id != wikiRoot.id
                                           and s:hasPermission('Node', 'create', directoryHome.instance)}"
                               tabindex="1"
                               accesskey="#{messages['lacewiki.button.Clipboard.Paste.accesskey']}"
                               styleClass="button">
                    <h:outputText styleClass="buttonLabel" escape="false" value="#{messages['lacewiki.button.Clipboard.Paste']}"/>
                </h:commandLink>
            </h:panelGroup>
        </s:fragment>

    </h:panelGrid>

    <h:panelGrid columns="2" styleClass="directoryPathTable" columnClasses="directoryPath, directoryPagerControl"
                 cellpadding="0" cellspacing="0" border="0">

        <h:panelGroup>
            <h:outputText value="/" styleClass="directorySeparator"/>
            <ui:repeat var="directory" value="#{directoryHome.instance.path}">

                <s:link view="/dirDisplay_#{skin}.xhtml" value="#{directory.name}" styleClass="directoryButton" tabindex="1">
                    <f:param name="directoryId" value="#{directory.id}"/>
                </s:link>

                <h:outputText value="/" styleClass="directorySeparator" rendered="#{directory != directoryHome.instance}"/>

            </ui:repeat>
        </h:panelGroup>

        <h:panelGroup rendered="#{childNodesList.size > 0}" styleClass="smallFont">
            <h:outputText value="#{messages['lacewiki.label.dirDisplay.ShowItems']}:&#160;"/>
            <h:selectOneMenu value="#{directoryHome.pager.pageSize}" tabindex="1">
                <f:selectItem itemLabel="5" itemValue="5"/>
                <f:selectItem itemLabel="15" itemValue="15"/>
                <f:selectItem itemLabel="50" itemValue="50"/>
                <f:selectItem itemLabel="#{messages['lacewiki.label.dirDisplay.All']}" itemValue="999999"/>
            </h:selectOneMenu>
            <h:commandLink action="#{directoryHome.refreshChildNodes()}"
                             tabindex="1" accesskey="#{messages['lacewiki.button.dirDisplay.Refresh.accesskey']}"
                             styleClass="buttonNonpersistent">
                <h:outputText styleClass="buttonLabel" escape="false" value="#{messages['lacewiki.button.dirDisplay.Refresh']}"/>
            </h:commandLink>
        </h:panelGroup>

    </h:panelGrid>

    <s:div styleClass="directoryEmpty" rendered="#{childNodesList.size == 0}">
            <s:link view="/dirDisplay_#{skin}.xhtml" tabindex="1" accesskey="."
                    rendered="#{!empty directoryHome.parentNode and s:hasPermission('Node','read',directoryHome.parentNode)}">
                <f:param name="directoryId" value="#{directoryHome.parentNode.id}"/>
                <h:panelGrid columns="2">
                    <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/icon.dirup.gif" width="18" height="20"/>
                    <h:outputText value=".."/>
                </h:panelGrid>
            </s:link>
            <h:outputText rendered="#{empty directoryHome.parentNode or !s:hasPermission('Node','read',directoryHome.parentNode)}"
                          value="#{messages['lacewiki.label.dirDisplay.DirectoryIsEmpty']}"/>

    </s:div>

    <h:panelGrid columns="5" rendered="#{childNodesList.size > 0 and directoryHome.pager.numOfRecords > directoryHome.pager.pageSize}"
                 styleClass="pager"
                 columnClasses="pagerIconColumn,pagerIconColumn,pagerTextColumn,pagerIconColumn,pagerIconColumn"
                 cellpadding="0" cellspacing="0" border="0">


        <s:link view="/dirDisplay_#{skin}.xhtml" tabindex="1" target="_top"
                rendered="#{directoryHome.pager.previousPageAvailable}">
            <f:param name="page" value="0"/>
            <f:param name="pageSize" value="#{directoryHome.pager.pageSize}"/>
            <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/page.first.gif" width="13" height="11"/>
        </s:link>
        <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/blank.gif" width="13" height="11"
                        rendered="#{!directoryHome.pager.previousPageAvailable}"/>

        <s:link view="/dirDisplay_#{skin}.xhtml" tabindex="1" target="_top"
                rendered="#{directoryHome.pager.previousPageAvailable}">
            <f:param name="page" value="#{directoryHome.pager.previousPage}"/>
            <f:param name="pageSize" value="#{directoryHome.pager.pageSize}"/>
            <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/page.previous.gif" width="13" height="11"/>
        </s:link>
        <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/blank.gif" width="13" height="11"
                        rendered="#{!directoryHome.pager.previousPageAvailable}"/>

        <s:span>
            <h:outputText value="#{messages['lacewiki.label.dirDisplay.PagerShowing']}
                                    #{directoryHome.pager.firstRecord} #{messages['lacewiki.label.dirDisplay.PagerTo']}
                                    #{directoryHome.pager.lastRecord} #{messages['lacewiki.label.dirDisplay.PagerOf']}
                                    #{directoryHome.pager.numOfRecords} #{messages['lacewiki.label.dirDisplay.PagerElements']}"/>
        </s:span>

        <s:link view="/dirDisplay_#{skin}.xhtml" tabindex="1" target="_top"
                rendered="#{directoryHome.pager.nextPageAvailable}">
            <f:param name="page" value="#{directoryHome.pager.nextPage}"/>
            <f:param name="pageSize" value="#{directoryHome.pager.pageSize}"/>
            <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/page.next.gif" width="13" height="11"/>
        </s:link>
        <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/blank.gif" width="13" height="11"
                        rendered="#{!directoryHome.pager.nextPageAvailable}"/>

        <s:link view="/dirDisplay_#{skin}.xhtml" tabindex="1" target="_top"
                rendered="#{directoryHome.pager.nextPageAvailable}">
            <f:param name="page" value="#{directoryHome.pager.lastPage}"/>
            <f:param name="pageSize" value="#{directoryHome.pager.pageSize}"/>
            <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/page.last.gif" width="13" height="11"/>
        </s:link>
        <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/blank.gif" width="13" height="11"
                        rendered="#{!directoryHome.pager.nextPageAvailable}"/>

    </h:panelGrid>

    <h:dataTable id="dirTable" var="node"
                 value="#{childNodesList}"
                 rendered="#{childNodesList.size > 0}"
                 styleClass="datatable topLeftBottomBorder smallFont"
                 headerClass="regularHeader rightBorder alignCenter"
                 columnClasses="onePercentColumn rightBorder alignCenter, onePercentColumn rightBorder alignCenter,
                                defaultColumn rightBorder alignLeft wrapWhitespace,
                                twentyPercentColumn rightBorder alignLeft wrapWhitespace,
                                fifteenPercentColumn rightBorder alignLeft wrapWhitespace,
                                fifteenPercentColumn rightBorder alignLeft wrapWhitespace,
                                fifteenPercentColumn rightBorder alignCenter wrapWhitespace"
                 rowClasses="rowOdd,rowEven"
                 cellpadding="0" cellspacing="0" border="0">
        <h:column>
            <s:fragment rendered="#{not clipboard.isCut(node.id)}">
                <h:selectBooleanCheckbox value="#{directoryHome.selectedNodes[node]}"
                                         onchange="switchClipboardControl()"
                                         styleClass="wikiFileSelect wikiDocumentSelect"
                                         rendered="#{node.isInstance('WikiDocument')}"/>
                <h:selectBooleanCheckbox value="#{directoryHome.selectedNodes[node]}"
                                         onchange="switchClipboardControl()"
                                         styleClass="wikiFileSelect wikiUploadSelect"
                                         rendered="#{node.isInstance('WikiUpload')}"/>
                <h:outputText value="-" rendered="#{node.isInstance('WikiDirectory')}"/>
            </s:fragment>
            <s:fragment rendered="#{clipboard.isCut(node.id)}">
                <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/icon.cut.gif" width="18" height="20"/>
            </s:fragment>
        </h:column>
        <h:column>
            <f:facet name="header">
                <s:link view="/dirDisplay_#{skin}.xhtml" tabindex="1" accesskey="."
                        rendered="#{!empty directoryHome.parentNode and s:hasPermission('Node','read',directoryHome.parentNode)}">
                    <f:param name="directoryId" value="#{directoryHome.parentNode.id}"/>
                    <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/icon.dirup.gif" width="18" height="20"/>
                </s:link>
            </f:facet>
            <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/icon.dir.gif"
                            width="18" height="20"
                            rendered="#{node.isInstance('WikiDirectory')
                                      and node.id != trashArea.id and node.id != memberArea.id and node.id != helpArea.id}"/>
            <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/icon.trash.gif"
                            width="18" height="20"
                            rendered="#{node.isInstance('WikiDirectory') and node.id == trashArea.id}"/>
            <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/icon.user.gif"
                            width="18" height="20"
                            rendered="#{node.isInstance('WikiDirectory') and node.id == memberArea.id}"/>
            <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/icon.help.gif"
                            width="18" height="20"
                            rendered="#{node.isInstance('WikiDirectory') and node.id == helpArea.id}"/>

            <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/icon.doc.gif"
                            width="18" height="20"
                            rendered="#{node.isInstance('WikiDocument') and node.id != directoryHome.instance.defaultFile.id}"/>
            <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/icon.doc.default.gif"
                            width="18" height="20"
                            rendered="#{node.isInstance('WikiDocument') and node.id == directoryHome.instance.defaultFile.id}"/>

            <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/#{uploadTypes[node.contentType].displayIcon}"
                            width="18" height="20"
                            rendered="#{node.isInstance('WikiUpload') and !empty uploadTypes[node.contentType]}"/>
            <h:graphicImage value="/themes/#{preferences.get('Wiki').themeName}/img/#{uploadTypes['generic'].displayIcon}"
                            width="18" height="20"
                            rendered="#{node.isInstance('WikiUpload') and empty uploadTypes[node.contentType]}"/>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="#{messages['lacewiki.label.dirDisplay.Name']}&#160;#{messages['lacewiki.label.dirDisplay.RightClickForActions']}"/>
            </f:facet>

            <s:fragment rendered="#{node.isInstance('WikiDirectory')}">
                <s:fragment rendered="#{s:hasPermission('Node','read',node)}">

                    <s:link id="directoryLink" value="#{wiki:truncateString(node.name, 40, '...')}"
                            view="/dirDisplay_#{skin}.xhtml" tabindex="1">
                        <f:param name="directoryId" value="#{node.id}"/>
                    </s:link>

                    <s:div id="directoryMenu" styleClass="contextMenu">
                        <ul>
                            <li class="undecoratedLink">
                                <h:outputLink value="#{wiki:renderURL(node)}">
                                    <h:outputText value="#{messages['lacewiki.button.dirDisplay.View']}"/>
                                </h:outputLink>
                            </li>

                            <s:fragment rendered="#{s:hasPermission('Node', 'edit', node)}">
                                <li class="undecoratedLink">
                                    <s:link view="/dirEdit_#{skin}.xhtml">
                                        <f:param name="directoryId" value="#{node.id}"/>
                                        <h:outputText value="#{messages['lacewiki.button.dirDisplay.Edit']}"/>
                                    </s:link>
                                </li>
                            </s:fragment>

                        </ul>
                    </s:div>

                    <script type="text/javascript">jQuery(function() {
                        jQuery("#dirSelectionForm\\:dirTable\\:#{uiComponent['dirSelectionForm:dirTable'].rowIndex}\\:directoryLink")
                                .contextMenu("dirSelectionForm\\:dirTable\\:#{uiComponent['dirSelectionForm:dirTable'].rowIndex}\\:directoryMenu", {})
                    });</script>

                </s:fragment>

                <h:outputText value="#{wiki:truncateString(node.name, 40, '...')}" rendered="#{!s:hasPermission('Node','read',node)}"/>

            </s:fragment>

            <s:fragment rendered="#{node.isInstance('WikiDocument')}">

                <s:fragment rendered="#{s:hasPermission('Node','read',node)}">

                    <h:outputLink id="documentLink" value="#{wiki:renderURL(node)}" tabindex="1">
                        <h:outputText value="#{wiki:truncateString(node.name, 40, '...')}"/>
                    </h:outputLink>

                    <s:div id="documentMenu" styleClass="contextMenu">
                        <ul>
                            <li class="undecoratedLink">
                                <h:outputLink value="#{wiki:renderURL(node)}">
                                    <h:outputText value="#{messages['lacewiki.button.dirDisplay.View']}"/>
                                </h:outputLink>
                            </li>

                            <s:fragment rendered="#{s:hasPermission('Node', 'edit', node)}">
                                <li class="undecoratedLink">
                                    <s:link view="/docEdit_#{skin}.xhtml">
                                        <f:param name="documentId" value="#{node.id}"/>
                                        <h:outputText value="#{messages['lacewiki.button.dirDisplay.Edit']}"/>
                                    </s:link>
                                </li>
                            </s:fragment>

                        </ul>
                    </s:div>

                    <script type="text/javascript">jQuery(function() {
                        jQuery("#dirSelectionForm\\:dirTable\\:#{uiComponent['dirSelectionForm:dirTable'].rowIndex}\\:documentLink")
                                .contextMenu("dirSelectionForm\\:dirTable\\:#{uiComponent['dirSelectionForm:dirTable'].rowIndex}\\:documentMenu", {})
                    });</script>
                </s:fragment>

                <h:outputText value="#{wiki:truncateString(node.name, 40, '...')}" rendered="#{!s:hasPermission('Node','read',node)}"/>

            </s:fragment>

            <s:fragment rendered="#{node.isInstance('WikiUpload')}">
                <s:fragment rendered="#{s:hasPermission('Node','read',node)}">

                    <h:outputLink id="uploadLink" value="#{wiki:renderURL(node)}" tabindex="1">
                        <h:outputText value="#{wiki:truncateString(node.name, 30, '...')} (#{wiki:displayFilesize(node.filesize)}, #{node.contentType})"/>
                    </h:outputLink>

                    <s:div id="uploadMenu" styleClass="contextMenu">
                        <ul>
                            <li class="undecoratedLink">
                                <h:outputLink value="#{wiki:renderURL(node)}">
                                    <h:outputText value="#{messages['lacewiki.button.dirDisplay.View']}"/>
                                </h:outputLink>
                            </li>

                            <s:fragment rendered="#{s:hasPermission('Node', 'edit', node)}">
                                <li class="undecoratedLink">
                                    <s:link view="/uploadEdit_#{skin}.xhtml">
                                        <f:param name="uploadId" value="#{node.id}"/>
                                        <h:outputText value="#{messages['lacewiki.button.dirDisplay.Edit']}"/>
                                    </s:link>
                                </li>
                            </s:fragment>

                        </ul>
                    </s:div>

                    <script type="text/javascript">jQuery(function() {
                        jQuery("#dirSelectionForm\\:dirTable\\:#{uiComponent['dirSelectionForm:dirTable'].rowIndex}\\:uploadLink")
                                .contextMenu("dirSelectionForm\\:dirTable\\:#{uiComponent['dirSelectionForm:dirTable'].rowIndex}\\:uploadMenu", {})
                    });</script>
                </s:fragment>

                <h:outputText value="#{wiki:truncateString(node.name, 40, '...')}" rendered="#{!s:hasPermission('Node','read',node)}"/>

            </s:fragment>

        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="#{messages['lacewiki.label.dirDisplay.Owner']}"/>
            </f:facet>
            <s:span styleClass="undecoratedLink" rendered="#{node.ownedByRegularUser}">
                <h:outputLink value="#{wiki:renderUserInfoURL(node.createdBy)}">
                    <h:outputText value="#{node.createdBy.fullname}"/>
                </h:outputLink>
            </s:span>
            <h:outputText rendered="#{not node.ownedByRegularUser}" value="#{node.createdBy.fullname}"/>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="#{messages['lacewiki.label.dirDisplay.ReadAccess']}"/>
            </f:facet>
            <h:outputText value="#{wiki:truncateString(wiki:resolveAccessLevel(node.readAccessLevel).roleNames, 20, '...')}"/>
        </h:column>

        <h:column>
            <f:facet name="header">
                <h:outputText value="#{messages['lacewiki.label.dirDisplay.WriteAccess']}"/>
            </f:facet>
            <h:outputText value="#{wiki:truncateString(wiki:resolveAccessLevel(node.writeAccessLevel).roleNames, 20, '...')}"/>
        </h:column>

        <h:column rendered="#{!empty node.lastModifiedOn and !empty node.lastModifiedBy}">
            <f:facet name="header">
                #{messages['lacewiki.label.dirDisplay.LastModifiedOn']}
            </f:facet>
            <h:outputText value="#{node.lastModifiedOn}">
                <f:convertDateTime pattern="dd. MMM yyyy, HH:mm" timeZone="#{preferences.get('Wiki').timeZone}"/>
            </h:outputText>
            (<s:span styleClass="undecoratedLink">
                <h:outputLink value="#{wiki:renderUserInfoURL(node.lastModifiedBy)}">
                    <h:outputText value="#{node.lastModifiedBy.username}"/>
                </h:outputLink>
            </s:span>)
        </h:column>

        <h:column rendered="#{empty node.lastModifiedOn or empty node.lastModifiedBy}">
            <f:facet name="header">
                #{messages['lacewiki.label.dirDisplay.LastModifiedOn']}
            </f:facet>
            -
        </h:column>

    </h:dataTable>

</div>

</h:form>

</ui:define>

<ui:define name="footer">&#160;</ui:define>

</ui:composition>

