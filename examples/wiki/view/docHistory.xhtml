<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                template="themes/#{wikiPreferences.themeName}/template.xhtml">

<ui:define name="includeHeaders">
    <link href="#{themePath}/css/userControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/searchControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/mainMenu.css" rel="stylesheet" type="text/css"/>
</ui:define>

<ui:define name="screenname">Document History</ui:define>

<ui:define name="headerTopRight">
    <ui:include src="includes/userControl.xhtml"/>
</ui:define>

<ui:define name="headerBottomLeft">&#160;</ui:define>

<ui:define name="sidebar">
    <ui:include src="includes/searchControl.xhtml"/>
    <ui:include src="includes/mainMenu.xhtml"/>
</ui:define>

<ui:define name="controlRight">
    <s:link id="exit" styleClass="linkNavigation"
            action="#{browser.exitConversation(true)}"
            accesskey="E"><u>E</u>xit</s:link>
</ui:define>

<ui:define name="content">

<h:form rendered="#{historicalNodeList.rowCount >0}">
<div class="form">

    <div class="formHead">Document History: #{currentNode.name}</div>
    <div class="formFieldsWideLabels">

        <s:div styleClass="entry">
            <div class="label">Revision:</div>
            <div class="output">
                <h:outputText value="#{currentNode.revision}"/>
            </div>
        </s:div>

        <s:div styleClass="entry">
            <div class="label">Parent:</div>
            <div class="output">
                <h:outputText value="#{currentNode.parent.name}"/>
            </div>
        </s:div>

        <s:div styleClass="entry">
            <div class="label">Created On:</div>
            <div class="output">
                <h:outputText value="#{currentNode.createdOn}">
                    <f:convertDateTime type="both"/>
                </h:outputText>
                (#{currentNode.createdBy.username})
            </div>
        </s:div>

        <s:div styleClass="entry" rendered="#{!empty currentNode.lastModifiedBy}">
            <div class="label">Last Modified On:</div>
            <div class="output">
                <h:outputText value="#{currentNode.lastModifiedOn}">
                    <f:convertDateTime type="both"/>
                </h:outputText>
                (#{currentNode.lastModifiedBy.username})
            </div>
        </s:div>

        <s:div styleClass="entry">
            <div class="label">Historical revisions:</div>
            <div class="input">

                <h:dataTable id="historyTable" var="hnode" style="width:50%"
                             value="#{historicalNodeList}"
                             styleClass="datatable topLeftBottomBorder"
                             headerClass="sortableHeader rightBorder"
                             columnClasses="onePercentColumn rightBorder alignCenter,
                                            tenPercentColumn rightBorder alignLeft,
                                            tenPercentColumn rightBorder alignLeft,
                                            defaultColumn rightBorder alignCenter"
                             rowClasses="rowOdd,rowEven"
                             cellpadding="0" cellspacing="0" border="0">

                    <h:column>
                        <f:facet name="header">#</f:facet>
                        #{hnode.revision}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Last Modified On</f:facet>
                        <h:outputText value="#{hnode.lastModifiedOn}">
                            <f:convertDateTime type="both"/>
                        </h:outputText>
                    </h:column>

                    <h:column>
                        <f:facet name="header">Last Modified By</f:facet>
                        <h:outputText value="#{hnode.lastModifiedByUsername}"/>
                    </h:column>

                    <h:column>
                        <h:commandLink id="diff"
                                       action="#{nodeHistory.diff}"
                                       tabindex="3" styleClass="buttonNonpersistent"><span class="buttonLabel">Diff</span></h:commandLink>
                        <h:commandLink id="rollback"
                                       action="#{nodeHistory.rollback}"
                                       tabindex="4" styleClass="buttonNonpersistent"
                                       rendered="#{s:hasPermission('Node', 'edit', currentNode)}"><span class="buttonLabel">Rollback</span></h:commandLink>
                    </h:column>

                </h:dataTable>

            </div>
        </s:div>

    </div>

</div>
</h:form>

    <s:div id="diffOutput" rendered="#{not empty nodeHistory.diffResult}">
        <wiki:formattedText value="#{nodeHistory.diffResult}"
                            linkStyleClass="regularLink"
                            brokenLinkStyleClass="brokenLink"
                            attachmentLinkStyleClass="regularLink"
                            inlineLinkStyleClass="regularLink"/>
    </s:div>


</ui:define>

<ui:define name="footer">&#160;</ui:define>

</ui:composition>

