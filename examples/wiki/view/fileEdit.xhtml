<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                xmlns:j4j="http://javascript4jsf.dev.java.net/"
                xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                template="themes/#{wikiPreferences.themeName}/template.xhtml">

<ui:define name="screenname">
    <h:outputText value="Upload File" rendered="#{!fileHome.managed}"/>
    <h:outputText value="Edit File" rendered="#{fileHome.managed}"/>
</ui:define>

<ui:define name="controlTwo">

    <s:link id="exitxitManaged" styleClass="linkNavigation" action="exit" accesskey="E"><u>E</u>xit Editor</s:link>

</ui:define>

<ui:define name="content">

    <s:span rendered="#{fileHome.managed}">
        <ui:include src="includes/directorySelector.xhtml">
            <ui:param name="home" value="#{fileHome}"/>
        </ui:include>
    </s:span>

    <s:span rendered="#{s:hasPermission('User', 'isAdmin', currentUser) and fileHome.managed}">
        <ui:include src="includes/ownerSelector.xhtml">
            <ui:param name="home" value="#{fileHome}"/>
        </ui:include>
    </s:span>

    <s:span rendered="#{fileHome.managed}">
        <ui:include src="includes/deleteConfirmation.xhtml">
            <ui:param name="home" value="#{fileHome}"/>
        </ui:include>
    </s:span>

    <h:form id="fileEditForm" styleClass="box" enctype="multipart/form-data">
        <div class="form">

            <ui:include src="includes/statusIndicator.xhtml"/>

            <div class="formHead">
                <h:outputText value="Create file" rendered="#{!fileHome.managed}"/>
                <h:outputText value="Edit file" rendered="#{fileHome.managed}"/>
            </div>

            <div class="formFields formBorder wideLabels">

                <s:div styleClass="entry">
                    <div class="label">Directory:</div>
                    <div class="output">
                        <s:span id="directoryNameDisplay">#{fileHome.parentDirectory.name}</s:span>

                        <h:outputLink rendered="#{fileHome.managed}" id="selectDirectory"
                                      value="#" tabindex="1" styleClass="buttonNonpersistent"><j4j:idProxy
                                        id="openDialogDirectorySelection"/><span class="buttonLabel">...</span></h:outputLink>
                    </div>
                </s:div>

                <s:div styleClass="entry" rendered="#{fileHome.managed}">
                    <div class="label">Created On:</div>
                    <div class="output">
                        <h:outputText value="#{fileHome.instance.createdOn}">
                            <f:convertDateTime type="both" timeZone="#{wikiPreferences.timeZone}"/>
                        </h:outputText>
                        <s:span id="ownerDisplay">&#160;(#{fileHome.instance.createdBy.username})</s:span>
                        <h:outputLink id="selectOwner" value="#" tabindex="1" styleClass="buttonNonpersistent"
                                      rendered="#{s:hasPermission('User', 'isAdmin', currentUser)}"><j4j:idProxy
                                        id="openDialogOwnerSelection"/><span class="buttonLabel">...</span></h:outputLink>
                    </div>
                </s:div>

                <s:decorate id="nameDecorate" template="includes/formFieldDecorate.xhtml">
                    <ui:define name="label">Name</ui:define>
                    <h:inputText size="50" maxlength="255" required="true" tabindex="1" value="#{fileHome.instance.name}">
                        <a:support status="fileEditForm:status" event="onblur" reRender="nameDecorate"/>
                    </h:inputText>
                </s:decorate>

                <ui:include src="includes/accessLevelSelector.xhtml"/>

                <s:div id="details" rendered="#{fileHome.managed}">

                    <div class="entry">
                        <div class="label">File Details:</div>
                        <div class="output">
                            <h:panelGroup>
                                <h:outputLink value="#{wiki:renderURL(fileHome.instance)}">
                                    <h:outputText value="#{fileHome.instance.filename}, #{wiki:displayFilesize(fileHome.instance.filesize)}, #{fileHome.instance.contentType}"/>
                                </h:outputLink>
                            </h:panelGroup>
                        </div>
                    </div>

                </s:div>

                <s:div rendered="#{fileHome.managed and empty fileHome.instance.imageMetaInfo and not empty fileHome.availableImporters}">
                    <div class="entry">
                        <div class="label">Converters:</div>
                        <div class="input">
                            <h:selectOneMenu value="#{fileHome.selectedImporter}" tabindex="1">
                                <s:selectItems value="#{fileHome.availableImporters}"
                                               var="imp"
                                               label="#{imp.description}"
                                               noSelectionLabel="Don't convert file"/>
                                <a:support status="fileEditForm:status" event="onchange" reRender="uploadControl"/>
                            </h:selectOneMenu>
                        </div>
                    </div>
                </s:div>

                <s:div rendered="#{fileHome.managed and not empty fileHome.instance.imageMetaInfo}">

                    <div class="entry">
                        <div class="label">Original Image Size:</div>
                        <div class="output">#{fileHome.instance.imageMetaInfo.sizeX} x #{fileHome.instance.imageMetaInfo.sizeY} pixel</div>
                    </div>

                    <s:div styleClass="entry" id="imagePreview">
                        <div class="label">Image Preview:</div>
                        <div class="output">
                            <h:panelGrid columns="1">
                                <h:panelGroup>
                                    <a:region>
                                        <a:commandLink status="fileEditForm:status" id="zoomOut" tabindex="2" action="#{fileHome.zoomPreviewOut}" reRender="imagePreview" alt="Zoom Out">
                                            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/minus.gif" width="18" height="18"/>
                                        </a:commandLink>
                                        <a:commandLink status="fileEditForm:status" id="actualSize" tabindex="2" action="#{fileHome.zoomActualSize}" reRender="imagePreview" alt="Actual Size">
                                            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/equals.gif" width="18" height="18"/>
                                        </a:commandLink>
                                        <a:commandLink status="fileEditForm:status" id="zoomIn" tabindex="2" action="#{fileHome.zoomPreviewIn}" reRender="imagePreview" alt="Zoom In">
                                            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/plus.gif" width="18" height="18"/>
                                        </a:commandLink>
                                    </a:region>
                                </h:panelGroup>
                                <h:outputLink value="#{facesContext.externalContext.requestContextPath}/servlets/files/download.seam?fileId=#{fileHome.instance.id}">
                                    <s:graphicImage value="#{fileHome.instance.data}" style="border: 1px solid black;">
                                        <s:transformImageSize width="#{fileHome.imagePreviewSize}" maintainRatio="true"/>
                                    </s:graphicImage>
                                </h:outputLink>
                            </h:panelGrid>
                        </div>
                    </s:div>

                    <div class="entry">
                        <div class="label">Show in documents:</div>
                        <div class="input">
                            <h:selectOneMenu value="#{fileHome.instance.imageMetaInfo.thumbnail}" styleClass="" tabindex="4">
                                <f:selectItem itemLabel="Small thumbnail" itemValue="S"/>
                                <f:selectItem itemLabel="Medium thumbnail" itemValue="M"/>
                                <f:selectItem itemLabel="Large thumbnail" itemValue="L"/>
                                <f:selectItem itemLabel="Full size " itemValue="F"/>
                                <f:selectItem itemLabel="As attachment" itemValue="A"/>
                            </h:selectOneMenu>
                        </div>
                    </div>

                </s:div>

                <s:div id="uploadControl">
                    <s:decorate id="uploadDecorate" template="includes/formFieldDecorate.xhtml" rendered="#{empty fileHome.selectedImporter}">
                        <ui:define name="label">Upload (max. #{wiki:displayFilesize(org.jboss.seam.web.multipartFilter.maxRequestSize)})</ui:define>
                        <s:fileUpload id="upload" data="#{fileHome.filedata}" contentType="#{fileHome.contentType}" fileName="#{fileHome.filename}"/>
                    </s:decorate>
                </s:div>

            </div>
            <div class="formControls wideLabels">

                <div class="entry">
                    <div class="label">&#160;</div>
                    <div class="input">

                        <h:commandLink id="save" action="#{fileHome.persist}"
                                       rendered="#{!fileHome.managed}"
                                       tabindex="5" accesskey="S" styleClass="button"><span class="buttonLabel"><u>S</u>ave</span></h:commandLink>

                        <h:commandLink id="update" action="#{fileHome.update}"
                                   rendered="#{fileHome.managed}"
                                   tabindex="6" accesskey="U" styleClass="button"><span class="buttonLabel"><u>U</u>pdate</span></h:commandLink>

                        <h:outputLink id="delete" value="#" tabindex="7" accesskey="D" styleClass="button"
                                      rendered="#{fileHome.managed}"><j4j:idProxy
                                id="openDialogDelete"/><span class="buttonLabel"><u>D</u>elete</span></h:outputLink>

                    </div>
                </div>

            </div>

        </div>
    </h:form>

</ui:define>

<ui:define name="footer">&#160;</ui:define>


</ui:composition>

