<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                template="themes/#{wikiPreferences.themeName}/#{skin}/template.xhtml">

<ui:define name="screenname">#{documentHome.instance.name}</ui:define>

<ui:define name="control">

    <s:link id="createDoc" styleClass="linkNavigation" view="/docEdit_#{skin}.xhtml"
            accesskey="#{messages['lacewiki.button.CreateDocument.accesskey']}"
            rendered="#{s:hasPermission('Node', 'create', documentHome.instance.parent)}">
        <h:outputText escape="false" value="#{messages['lacewiki.button.CreateDocument']}"/>
        <f:param name="documentId" value=""/>
        <f:param name="parentDirectoryId" value="#{documentHome.instance.parent.id}"/>
    </s:link>

    <s:link id="editDoc" styleClass="linkNavigation" view="/docEdit_#{skin}.xhtml"
            accesskey="#{messages['lacewiki.button.EditDocument.accesskey']}"
            rendered="#{s:hasPermission('Node', 'edit', documentHome.instance)}">
        <h:outputText escape="false" value="#{messages['lacewiki.button.EditDocument']}"/>
    </s:link>

    <s:link id="showHistory" styleClass="linkNavigation" view="/docHistory_#{skin}.xhtml"
            accesskey="#{messages['lacewiki.button.HistoryDocument.accesskey']}"
            rendered="#{documentHome.historicalNodesPresent}">
        <h:outputText escape="false" value="#{messages['lacewiki.button.HistoryDocument']}"/>
        <f:param name="nodeId" value="#{documentHome.nodeId}"/>
    </s:link>

    <s:link id="browseDir" styleClass="linkNavigation" view="/dirDisplay_#{skin}.xhtml"
            accesskey="#{messages['lacewiki.button.BrowseDirectory.accesskey']}">
        <h:outputText escape="false" value="#{messages['lacewiki.button.BrowseDirectory']}"/>
        <f:param name="directoryId" value="#{documentHome.parentDirectory.id}"/>
    </s:link>

</ui:define>

<ui:define name="content">

    <s:div id="documentDisplay" styleClass="documentDisplay">
        <s:div rendered="#{documentHome.instance.nameAsTitle}"><h1 class="documentTitle">#{documentHome.instance.name}</h1></s:div>
        <wiki:formattedText value="#{wiki:disableFloats(documentHome.instance.content)}"
                            linkStyleClass="regularLink"
                            brokenLinkStyleClass="brokenLink"
                            attachmentLinkStyleClass="regularLink"
                            thumbnailLinkStyleClass="regularLink"
                            renderBaseDocument="#{documentHome.instance}"
                            renderBaseDirectory="#{documentHome.parentDirectory}"
                            enablePlugins="true"/>
    </s:div>

    <ui:include src="includes/attachmentDisplay.xhtml"/>

    <s:fragment rendered="#{not empty commentHome.comments and documentHome.instance.enableComments}">
        <br/>
        <div class="boxHeader">
            <h:outputText value="#{wiki:sizeOf(commentHome.comments)}&#160;#{messages['lacewiki.label.commentsDisplay.Comment']}:"
                          rendered="#{wiki:sizeOf(commentHome.comments) == 1}"/>
            <h:outputText value="#{wiki:sizeOf(commentHome.comments)}&#160;#{messages['lacewiki.label.commentsDisplay.Comments']}:"
                          rendered="#{wiki:sizeOf(commentHome.comments) > 1}"/>
        </div>

        <h:panelGrid columns="1" rowClasses="rowEven, rowOdd">

            <c:forEach var="c" items="#{commentHome.comments}">

                <s:div>

                    <div class="commentSubject">
                        <h:outputText value="#{c.subject}" rendered="#{documentHome.instance.name != c.subject}"/>
                    </div>

                    <div class="commentAuthorDate">
                    <span class="commentDate">
                        <h:outputText value="#{c.createdOn}">
                            <f:convertDateTime pattern="dd. MMM yyyy, HH:mm" timeZone="#{wikiPreferences.timeZone}"/>
                        </h:outputText>
                        <h:outputText value="&#160;#{wikiPreferences.timeZone}"/>
                    </span>
                        <s:span>&#160;(
                            <s:span styleClass="commentAuthor" rendered="#{empty c.fromUserHomepage}">#{c.fromUserName}</s:span>
                            <s:span styleClass="commentAuthor" rendered="#{!empty c.fromUserHomepage}"><a
                                    href="http://#{c.fromUserHomepage}">#{c.fromUserName}</a></s:span>
                            <s:span styleClass="commentAuthor" rendered="#{!empty c.fromUserEmail}">,&#160;
                                <h:outputLink value="#{wiki:escapeEmailURL(wiki:concat('mailto:', c.fromUserEmail))}">#{wiki:escapeAtSymbol(c.fromUserEmail)}</h:outputLink>
                            </s:span>)
                        </s:span>
                    </div>

                    <s:div styleClass="commentText" rendered="#{c.useWikiText}">
                        <wiki:formattedText value="#{c.text}"
                                            linkStyleClass="regularLink"
                                            brokenLinkStyleClass="brokenLink"
                                            attachmentLinkStyleClass="regularLink"
                                            thumbnailLinkStyleClass="regularLink"
                                            renderBaseDocument="#{documentHome.instance}"
                                            renderBaseDirectory="#{documentHome.parentDirectory}"
                                            enablePlugins="false"/>
                    </s:div>
                    <s:div styleClass="commentText" rendered="#{not c.useWikiText and documentHome.instance.name != c.subject}" style="margin-top:15px;">
                        <h:outputText value="#{wiki:escapeHTML(c.text, true)}" escape="false"/>
                    </s:div>
                    <s:div styleClass="commentText" rendered="#{not c.useWikiText and documentHome.instance.name == c.subject}">
                        <h:outputText value="#{wiki:escapeHTML(c.text, true)}" escape="false"/>
                    </s:div>

                    <div align="right">
                        <h:form rendered="#{s:hasPermission('Comment', 'delete', documentHome.instance)}">
                            <h:commandButton action="#{commentHome.remove(c.id)}" value="Remove Comment"/>
                        </h:form>
                    </div>

                </s:div>

            </c:forEach>

        </h:panelGrid>
    </s:fragment>

    <s:fragment rendered="#{documentHome.instance.enableComments and documentHome.instance.enableCommentForm}">
        <br/>
        <div class="boxHeader">#{messages['lacewiki.label.commentForm.PostComment']}:</div>
        <h:form id="commentForm"><s:validateAll>

            <div class="errorMessage"><h:message for="userName"/></div>
            <div>#{messages['lacewiki.label.commentForm.Name']}:&#160;<br/><h:inputText size="30" maxlength="100" required="true" id="userName" value="#{commentHome.comment.fromUserName}"/></div>

            <div class="errorMessage"><h:message for="userEmail"/></div>
            <div>#{messages['lacewiki.label.commentForm.Email']}:&#160;<br/><h:inputText size="30" maxlength="255" required="false" id="userEmail" value="#{commentHome.comment.fromUserEmail}"/></div>

            <div class="errorMessage"><h:message for="userHomepage"/></div>
            <div>#{messages['lacewiki.label.commentForm.Homepage']}:&#160;<br/><h:inputText size="30" maxlength="1000" required="false" id="userHomepage" value="#{commentHome.comment.fromUserHomepage}"/></div>

            <div class="errorMessage"><h:message for="subject"/></div>
            <div>#{messages['lacewiki.label.commentForm.Subject']}:&#160;<br/><h:inputText size="30" maxlength="255" required="true" id="subject" value="#{commentHome.comment.subject}"/></div>

            <div class="errorMessage"><h:message for="comment"/></div>
            <div>
                <h:inputTextarea required="true"
                                 cols="45"
                                 rows="5"
                                 id="comment"
                                 value="#{commentHome.comment.text}"/>
            </div>

            <s:div rendered="#{!identity.loggedIn}">
                <div>#{messages['lacewiki.label.VerificationQuestion']}:&#160;#{messages['lacewiki.label.VerificationQuestionQuestion']}&#160;<h:outputText value="#{captcha.question}"/>?</div>
                <div class="errorMessage"><h:message for="verifyCaptcha"/></div>
                <div>#{messages['lacewiki.label.VerificationEnterResponse']}:&#160;</div>
                <h:inputText size="5" maxlength="5" required="true" id="verifyCaptcha" value="#{captcha.response}"/>
            </s:div>

            <div class="formControls">
                <h:commandButton action="#{commentHome.persist}" value="#{messages['lacewiki.label.commentForm.PostComment']}"/>
            </div>
    
        </s:validateAll></h:form>
    </s:fragment>


</ui:define>

</ui:composition>
