<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                template="themes/#{globalPrefs.themeName}/template.xhtml">

<ui:define name="includeHeaders">
    <link href="#{themePath}/css/userControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/searchControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/mainMenu.css" rel="stylesheet" type="text/css"/>
</ui:define>

<ui:define name="screenname">
    <h:outputText value="Registration" rendered="#{!userHome.managed}"/>
    <h:outputText value="Member Account" rendered="#{userHome.managed}"/>
</ui:define>

<ui:define name="headerTopRight">
    <ui:include src="includes/userControl.xhtml"/>
</ui:define>

<ui:define name="headerBottomLeft">&#160;</ui:define>

<ui:define name="sidebar">
    <ui:include src="includes/searchControl.xhtml"/>
    <ui:include src="includes/mainMenu.xhtml"/>
</ui:define>

<ui:define name="controlLeft">
    <s:div rendered="#{userHome.managed}">
        <s:link id="editAccount" styleClass="linkTab activeTab" action="editAccount">Account</s:link>
        <s:link id="editProfile" styleClass="linkTab inactiveTab" action="editProfile">Profile</s:link>
        <s:link id="editPreferences" styleClass="linkTab inactiveTab" action="editPreferences">Preferences</s:link>
    </s:div>
</ui:define>

<ui:define name="controlRight">
    <s:link id="exit" styleClass="linkNavigation"
            action="#{browser.exitConversation(true)}"
            accesskey="E"><u>E</u>xit</s:link>
</ui:define>

<ui:define name="content">

<h:form>
    <div class="form">
        <div class="formHead">
            <h:outputText value="Register a new account" rendered="#{!userHome.managed}"/>
            <h:outputText value="Editing account: #{userHome.instance.username}" rendered="#{userHome.managed}"/>
        </div>

        <div class="formFieldsWideLabels">

            <s:validateAll>

                <s:decorate>
                    <div class="entry">
                        <div class="label">First name:</div>
                        <div class="input">
                            <h:inputText tabindex="1" size="40" maxlength="63" id="firstname" required="true"
                                         value="#{userHome.instance.firstname}"/>
                        </div>
                    </div>
                </s:decorate>

                <s:decorate>
                    <div class="entry">
                        <div class="label">Last name:</div>
                        <div class="input">
                            <h:inputText tabindex="2" size="40" maxlength="63" id="lastname" required="true"
                                         value="#{userHome.instance.lastname}"/>
                        </div>
                    </div>
                </s:decorate>

                <s:decorate>
                    <div class="entry">
                        <div class="label">E-Mail:</div>
                        <div class="input">
                            <h:inputText tabindex="3" size="40" maxlength="255" id="email" required="true"
                                         value="#{userHome.instance.email}"/>
                        </div>
                    </div>
                </s:decorate>

                <s:decorate>
                    <div class="entry">
                        <div class="label">Username:</div>
                        <div class="input">
                            <h:inputText tabindex="4" size="16" maxlength="16" id="username" required="true"
                                         value="#{userHome.instance.username}"/>
                        </div>
                    </div>
                </s:decorate>

                <s:decorate>
                    <div class="entry">
                        <div class="label">Password:</div>
                        <div class="input">
                            <h:inputSecret tabindex="5" size="15" maxlength="15" id="password"
                                           redisplay="true"
                                           value="#{userHome.password}"/>
                        </div>
                    </div>
                </s:decorate>

                <s:decorate>
                    <div class="entry">
                        <div class="label">Repeat password:</div>
                        <div class="input">
                            <h:inputSecret tabindex="6" size="15" maxlength="15" id="passwordControl"
                                           redisplay="true"
                                           value="#{userHome.passwordControl}"/>
                        </div>
                    </div>
                </s:decorate>

                <s:div styleClass="entry" rendered="#{!userHome.managed}">
                    <div class="label">Verification image:</div>
                    <div class="output">
                        <h:graphicImage value="/seam/resource/captcha?#{captcha.id}" style="border: 1px solid black;"/>
                    </div>
                </s:div>

                <s:decorate>
                    <s:div styleClass="entry" rendered="#{!userHome.managed}">
                        <div class="label">Enter the letters:</div>
                        <div class="input">
                            <h:inputText tabindex="7" size="15" id="verifyCaptcha" value="#{captcha.response}" required="true"/>
                        </div>
                    </s:div>
                </s:decorate>

                <s:div styleClass="entry" rendered="#{userHome.managed}">
                    <s:div styleClass="label" rendered="#{s:hasPermission('User', 'editRoles', currentUser)}">Edit roles:</s:div>
                    <s:div styleClass="label" rendered="#{!s:hasPermission('User', 'editRoles', currentUser)}">Assigned roles:</s:div>
                    <div class="input">
                        <h:selectManyListbox value="#{userHome.roles}" tabindex="8"
                                disabled="#{!s:hasPermission('User', 'editRoles', currentUser)}"
                                converter="#{entityConverter}">
                            <s:selectItems value="#{rolesList}"
                                           var="role"
                                           label="#{role.displayName} (Access level: #{role.accessLevel})"/>
                        </h:selectManyListbox>
                    </div>
                </s:div>

            </s:validateAll>

        </div>

        <div class="formControlsWideLabels">

            <div class="entry">
                <div class="label">&#160;</div>
                <div class="input">

                    <h:commandLink id="register" styleClass="button"
                                   action="#{userHome.persist}"
                                   rendered="#{!userHome.managed}"
                                   tabindex="8" accesskey="G"><span class="buttonLabel">Re<u>g</u>ister</span></h:commandLink>

                    <h:commandLink id="update" styleClass="button"
                                   action="#{userHome.update}"
                                   rendered="#{userHome.managed}"
                                   tabindex="9" accesskey="U"><span class="buttonLabel"><u>U</u>pdate</span></h:commandLink>

                </div>
            </div>

        </div>

    </div>
</h:form>


</ui:define>

<ui:define name="footer">&#160;</ui:define>

</ui:composition>

