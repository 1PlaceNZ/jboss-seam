<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:j4j="http://javascript4jsf.dev.java.net/"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                template="themes/#{wikiPreferences.themeName}/template.xhtml">

<ui:define name="screenname">Search: #{wikiSearch.simpleQuery}</ui:define>

<ui:define name="controlTwo">

    <s:link id="close" styleClass="linkNavigation" view="/wiki.xhtml" propagation="end" accesskey="E">Clos<u>e</u></s:link>

</ui:define>

<ui:define name="content">

    <h:form id="searchForm">
        <s:div styleClass="form" id="searchControl">

            <a:region>

            <h:panelGrid columns="5"
                         styleClass="datatable topLeftBottomBorder"
                         headerClass="regularHeader rightBorder"
                         columnClasses="twentyPercentColumn formFields, twentyPercentColumn formFields,
                                        twentyPercentColumn formFields, twentyPercentColumn formFields,
                                        defaultColumn alignCenter rightBorder formFields"
                         cellpadding="0" cellspacing="0" border="0">

                <f:facet name="header">
                    <h:outputText value="Search"/>
                </f:facet>

                <h:panelGrid columns="2" cellpadding="0" cellspacing="0" border="0">
                    <h:outputText styleClass="label" value="In:&#160;"/>
                    <h:selectOneMenu value="#{wikiSearch.selectedSearchableEntity}" tabindex="1">
                        <s:selectItems value="#{searchRegistry.searchableEntities}"
                                       var="se"
                                       label="#{se.description}"
                                       noSelectionLabel="All"/>
                        <a:support event="onchange" reRender="searchControl, searchPager, searchResult" action="#{wikiSearch.search}"/>
                    </h:selectOneMenu>
                </h:panelGrid>

                <h:panelGrid columns="2" rendered="#{empty wikiSearch.selectedSearchableEntity}" cellpadding="0" cellspacing="0" border="0">
                    <h:outputText styleClass="label" value="Terms:&#160;"/>
                    <h:inputText value="#{wikiSearch.simpleQuery}" size="28" maxlength="1000" tabindex="1"/>
                </h:panelGrid>
                <s:span rendered="#{not empty wikiSearch.selectedSearchableEntity}">&#160;</s:span>

                <h:panelGrid columns="2" rendered="#{empty wikiSearch.selectedSearchableEntity}" cellpadding="0" cellspacing="0" border="0">
                    <h:selectBooleanCheckbox value="#{wikiSearch.simpleQueryMatchExactPhrase}" tabindex="1"/>
                    <h:outputText styleClass="label" style="white-space:nowrap;" value="&#160;Exact phrase"/>
                </h:panelGrid>
                <s:span rendered="#{not empty wikiSearch.selectedSearchableEntity}">&#160;</s:span>

                <h:panelGrid columns="2" cellpadding="0" cellspacing="0" border="0">
                    <h:outputText styleClass="label" value="Results:&#160;"/>
                    <h:selectOneMenu value="#{wikiSearch.pageSize}" id="pageSize" tabindex="1">
                        <f:selectItem itemLabel="5" itemValue="5"/>
                        <f:selectItem itemLabel="15" itemValue="15"/>
                        <f:selectItem itemLabel="50" itemValue="50"/>
                        <a:support event="onchange" reRender="searchControl, searchPager, searchResult" action="#{wikiSearch.search}"/>
                    </h:selectOneMenu>
                </h:panelGrid>

                <a:commandLink id="find" styleClass="buttonNonpersistent" reRender="workspaceSwitcher, searchControl, searchPager, searchResult"
                               action="#{wikiSearch.search()}"
                               tabindex="1" accesskey="F"><span class="buttonLabel"><u>F</u>ind</span></a:commandLink>

            </h:panelGrid>

            <s:div id="searchOptions">

                <s:div rendered="#{!empty wikiSearch.selectedSearchableEntity}">

                    <h:dataTable id="searchOptionsTable"
                                 rendered="#{not empty wikiSearch.selectedSearchableEntity}"
                                 var="search"
                                 value="#{wikiSearch.searches[wikiSearch.selectedSearchableEntity]}"
                                 styleClass="datatable topBorder topLeftBottomBorder"
                                 columnClasses="tenPercentColumn alignLeft formFields, defaultColumn alignLeft formFields rightBorder"
                                 cellpadding="0" cellspacing="0" border="0">

                        <h:column>
                            <h:outputText styleClass="label" value="#{search.property.description}"/>
                        </h:column>

                        <h:column>

                            <h:panelGrid columns="5" rendered="#{search.property.type == 'PHRASE'}">
                                <h:inputText value="#{search.terms['include']}" size="32" tabindex="1"/>
                                <h:outputText styleClass="label" value="&#160;Exclude:&#160;"/>
                                <h:inputText value="#{search.terms['exclude']}" size="32" tabindex="1"/>
                                <h:selectBooleanCheckbox value="#{search.terms['matchExactPhrase']}" tabindex="1"/>
                                <h:outputText styleClass="label" value="&#160;Match exact phrase"/>
                            </h:panelGrid>

                            <s:div rendered="#{search.property.type == 'PASTDATE'}">
                                <h:selectOneMenu value="#{search.terms['numOfDays']}" tabindex="1">
                                    <f:selectItem itemLabel="at any time" itemValue=""/>
                                    <f:selectItem itemLabel="last 7 days" itemValue="7"/>
                                    <f:selectItem itemLabel="last 30 days" itemValue="30"/>
                                    <f:selectItem itemLabel="last 6 months" itemValue="180"/>
                                </h:selectOneMenu>
                            </s:div>

                        </h:column>

                    </h:dataTable>
                </s:div>

            </s:div>

            </a:region>
        </s:div>

        <s:div id="searchPager">
            <h:panelGrid columns="5" styleClass="pager"
                         columnClasses="pagerIconColumn,pagerIconColumn,pagerTextColumn,pagerIconColumn,pagerIconColumn"
                         cellpadding="0" cellspacing="0" border="0"
                         rendered="#{wikiSearch.totalCount > 0}">

                <h:commandLink action="#{wikiSearch.firstPage()}" rendered="#{wikiSearch.previousPageAvailable}" tabindex="7">
                    <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/page.first.gif" width="13" height="11"/>
                </h:commandLink>
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/blank.gif" width="13" height="11"
                                rendered="#{!wikiSearch.previousPageAvailable}"/>

                <h:commandLink action="#{wikiSearch.previousPage()}" rendered="#{wikiSearch.previousPageAvailable}" tabindex="7">
                    <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/page.previous.gif" width="13" height="11"/>
                </h:commandLink>
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/blank.gif" width="13" height="11"
                                rendered="#{!wikiSearch.previousPageAvailable}"/>

                <h:outputText value="#{wikiSearch.firstRow} to
                                     #{wikiSearch.lastRow} of
                                     #{wikiSearch.totalCount} hit(s)"/>

                <h:commandLink action="#{wikiSearch.nextPage()}" rendered="#{wikiSearch.nextPageAvailable}" tabindex="7">
                    <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/page.next.gif" width="13" height="11"/>
                </h:commandLink>
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/blank.gif" width="13" height="11"
                                rendered="#{!wikiSearch.nextPageAvailable}"/>

                <h:commandLink action="#{wikiSearch.lastPage()}" rendered="#{wikiSearch.nextPageAvailable}" tabindex="7">
                    <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/page.last.gif" width="13" height="11"/>
                </h:commandLink>
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/blank.gif" width="13" height="11"
                                rendered="#{!wikiSearch.nextPageAvailable}"/>

            </h:panelGrid>
        </s:div>

        <s:div id="searchResult">

            <h:dataTable id="searchResultTable" var="hit"
                         value="#{searchResult}"
                         rendered="#{wikiSearch.totalCount>0}"
                         styleClass="datatable topLeftBottomBorder"
                         columnClasses="rightBorder alignLeft minorPadding"
                         rowClasses="rowOdd,rowEven"
                         cellpadding="0" cellspacing="0" border="0">

                <h:column>

                    <h:panelGrid columns="2">
                        <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/#{hit.icon}" width="18" height="20"/>
                        <h:outputLink value="#{hit.link}" tabindex="1"><h:outputText escape="false" value="#{hit.title}"/></h:outputLink>
                    </h:panelGrid>
                    <h:outputText escape="false" value="#{hit.fragment}"/>
                </h:column>

            </h:dataTable>

            <s:div styleClass="formFields minorPadding" rendered="#{wikiSearch.totalCount == 0}">
                <h:outputText value="No hits, please try again."/>
            </s:div>

        </s:div>

    </h:form>

</ui:define>

<ui:define name="footer">&#160;</ui:define>

</ui:composition>

