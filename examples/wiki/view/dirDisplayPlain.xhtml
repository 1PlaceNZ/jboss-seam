<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                template="themes/#{wikiPreferences.themeName}/templatePlain.xhtml">

<ui:define name="screenname">#{directoryHome.instance.name}</ui:define>

<ui:define name="content">

<div class="box">
    <div class="directoryPathPanel" style="border-top: 1px solid lightgray;">

        <h:panelGroup>
            <s:link view="/dirDisplayPlain.xhtml" tabindex="1" accesskey="."
                    rendered="#{!empty directoryHome.parentDirectory and s:hasPermission('Node','read',directoryHome.parentDirectory)}">
                <f:param name="directoryId" value="#{directoryHome.parentDirectory.id}"/>
                <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/icon.dirup.gif" width="18" height="20"
                                style="vertical-align:middle;border:0;margin-bottom:-2px;margin-top:-3px;margin-right:10px;"/>
            </s:link>

            <s:link view="/dirDisplayPlain.xhtml" value="#{wikiRoot.name}" styleClass="directoryButton" tabindex="1">
                <f:param name="directoryId" value="#{wikiRoot.id}"/>
            </s:link>
            <h:outputText value="/" styleClass="directorySeparator"/>

            <h:panelGroup>
                <ui:repeat var="directory" value="#{breadcrumb}">
                    <s:link view="/dirDisplayPlain.xhtml" value="#{directory.name}" styleClass="directoryButton" tabindex="1">
                        <f:param name="directoryId" value="#{directory.id}"/>
                    </s:link>
                    <h:outputText value="/" styleClass="directorySeparator" rendered="#{directory != directoryHome.instance}"/>
                </ui:repeat>
            </h:panelGroup>

        </h:panelGroup>
    </div>

    <s:div styleClass="directoryEmpty" rendered="#{empty directoryHome.instance.children}">
            <s:link view="/dirDisplayPlain.xhtml" tabindex="1" accesskey="."
                    rendered="#{!empty directoryHome.parentDirectory and s:hasPermission('Node','read',directoryHome.parentDirectory)}">
                <f:param name="directoryId" value="#{directoryHome.parentDirectory.id}"/>
                <h:panelGrid columns="2">
                    <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/icon.dirup.gif" width="18" height="20"/>
                    <h:outputText value=".."/>
                </h:panelGrid>
            </s:link>
            <h:outputText rendered="#{empty directoryHome.parentDirectory or !s:hasPermission('Node','read',directoryHome.parentDirectory)}"
                          value="This directory is empty."/>

    </s:div>

    <h:dataTable id="directoryTable" var="node"
                 value="#{directoryHome.instance.children}"
                 rendered="#{!empty directoryHome.instance.children}"
                 styleClass="datatable topLeftBottomBorder"
                 headerClass="regularHeader rightBorder"
                 columnClasses="onePercentColumn rightBorder alignCenter, defaultColumn rightBorder alignLeft"
                 rowClasses="rowOdd,rowEven"
                 cellpadding="0" cellspacing="0" border="0">

        <h:column>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/icon.dir.gif"
                            width="18" height="20"
                            rendered="#{wiki:isDirectory(node)}"/>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/icon.doc.gif"
                            width="18" height="20"
                            rendered="#{wiki:isDocument(node) and node != directoryHome.instance.defaultDocument}"/>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/icon.doc.default.gif"
                            width="18" height="20"
                            rendered="#{wiki:isDocument(node) and node == directoryHome.instance.defaultDocument}"/>

            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/#{fileMetaMap[node.contentType].displayIcon}"
                            width="18" height="20"
                            rendered="#{wiki:isFile(node) and !empty fileMetaMap[node.contentType]}"/>
            <h:graphicImage value="/themes/#{wikiPreferences.themeName}/img/#{fileMetaMap['generic'].displayIcon}"
                            width="18" height="20"
                            rendered="#{wiki:isFile(node) and empty fileMetaMap[node.contentType]}"/>
        </h:column>

        <h:column>

            <s:span rendered="#{wiki:isDirectory(node)}">
                <s:link id="browseDirectory" value="#{wiki:truncateString(node.name, 40, '...')}"
                        view="/dirDisplayPlain.xhtml"
                        rendered="#{s:hasPermission('Node','read',node)}" tabindex="2">
                    <f:param name="directoryId" value="#{node.id}"/>
                </s:link>
                <h:outputText value="#{wiki:truncateString(node.name, 40, '...')}" rendered="#{!s:hasPermission('Node','read',node)}"/>
            </s:span>

            <s:span rendered="#{wiki:isDocument(node)}">
                <h:outputLink value="#{wiki:renderPlainURL(node)}" rendered="#{s:hasPermission('Node','read',node)}" tabindex="2">
                    <h:outputText value="#{wiki:truncateString(node.name, 40, '...')}"/>
                </h:outputLink>
                <h:outputText value="#{node.name}" rendered="#{!s:hasPermission('Node','read',node)}"/>
            </s:span>

            <h:panelGroup rendered="#{wiki:isFile(node) and !s:hasPermission('Node', 'edit', node)}">
                <h:outputLink value="#{wiki:renderPlainURL(node)}">
                    <h:outputText value="#{wiki:truncateString(node.name, 30, '...')} (#{wiki:displayFilesize(node.filesize)}, #{node.contentType})"/>
                </h:outputLink>
            </h:panelGroup>

        </h:column>

    </h:dataTable>
</div>

</ui:define>

</ui:composition>
