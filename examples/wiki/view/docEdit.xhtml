<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                xmlns:j4j="http://javascript4jsf.dev.java.net/"
                template="themes/#{wikiPreferences.themeName}/template.xhtml">

<ui:define name="screenname">
    <h:outputText value="Create document" rendered="#{!documentHome.managed}"/>
    <h:outputText value="Edit document" rendered="#{documentHome.managed}"/>
</ui:define>

<ui:define name="controlTwo">

    <s:link id="exitManaged" styleClass="linkNavigation" rendered="#{documentHome.managed}" action="exitManaged"
            accesskey="E"><u>E</u>xit Editor</s:link>

    <s:link id="exitUnmanaged" styleClass="linkNavigation" rendered="#{!documentHome.managed}" action="exitUnmanaged"
            accesskey="E"><u>E</u>xit Editor</s:link>

</ui:define>

<ui:define name="content">

    <script type="text/javascript">jQuery(function() {
        clearContentBackground();
    });</script>

    <s:span rendered="#{documentHome.managed}">
        <ui:include src="includes/directorySelector.xhtml">
            <ui:param name="home" value="#{documentHome}"/>
        </ui:include>
    </s:span>

    <s:span rendered="#{s:hasPermission('User', 'isAdmin', currentUser) and documentHome.managed}">
        <ui:include src="includes/ownerSelector.xhtml">
            <ui:param name="home" value="#{documentHome}"/>
        </ui:include>
    </s:span>

    <s:span rendered="#{documentHome.managed and documentHome.instance.id != wikiStart.id}">
        <ui:include src="includes/deleteConfirmation.xhtml">
            <ui:param name="home" value="#{documentHome}"/>
        </ui:include>
    </s:span>


    <div id="docEditFormContainer" class="shadowContainer"><div class="shadow1"><div class="shadow2">
    <h:form id="docEditForm">
        <div class="form">

            <ui:include src="includes/statusIndicator.xhtml"/>

            <script type="text/javascript">jQuery(function() {
                jQuery('#formTabs').tabs(2, {onClick: function(){formTabClicked()} });
            });</script>
            <div id="formTabs" class="formTabs">

                <ul>
                    <li class="formTabsTitle">
                        <h:outputText value="Create document" rendered="#{!documentHome.managed}"/>
                        <h:outputText value="Edit document" rendered="#{documentHome.managed}"/>
                    </li>
                    <li id="docContentTab"><a href="#docContent" accesskey="C"><u>C</u>ontent</a></li>
                    <li id="docPropertiesTab"><a href="#docProperties" accesskey="T">Proper<u>t</u>ies</a></li>
                </ul>

                <div id="formTabsTitle"/>

                <div id="docContent">

                    <a:region>
                        <div class="formFields">

                            <s:div styleClass="entry">
                                <div class="label">Directory:</div>
                                <div class="output">
                                    <s:span id="directoryNameDisplay">#{documentHome.parentDirectory.name}</s:span>

                                    <h:outputLink id="selectDirectory" rendered="#{documentHome.managed}" 
                                                  value="#" tabindex="1"
                                                  styleClass="buttonNonpersistent"><j4j:idProxy
                                            id="openDialogDirectorySelection"/><span class="buttonLabel">...</span></h:outputLink>
                                </div>
                            </s:div>

                            <s:decorate id="nameDecorate" template="includes/formFieldDecorate.xhtml">
                                <ui:param name="tabId" value="docContentTab"/>
                                <ui:param name="fieldId" value="name"/>
                                <ui:define name="label">Name</ui:define>
                                <h:inputText tabindex="2" size="70" maxlength="255" required="true" value="#{documentHome.instance.name}">
                                    <a:support status="docEditForm:status" event="onblur" reRender="nameDecorate"/>
                                </h:inputText>
                            </s:decorate>

                            <s:div styleClass="entry">
                                <div class="label">&#160;</div>
                                <div class="input">
                                    <h:selectBooleanCheckbox value="#{documentHome.instance.nameAsTitle}" tabindex="2"/>
                                    Render name as document title
                                </div>
                            </s:div>

                            <s:div styleClass="entry" rendered="#{documentHome.managed}">
                                <div class="label">&#160;</div>
                                <div class="input">
                                    <h:selectBooleanCheckbox value="#{documentHome.minorRevision}" tabindex="3"/>
                                    Minor change, don't create a new revision
                                </div>
                            </s:div>

                            <s:fragment rendered="#{not documentHome.managed}">
                                <s:div styleClass="entry">
                                    <div class="label">&#160;</div>
                                    <div class="input">
                                        <h:selectBooleanCheckbox value="#{documentHome.pushOnFeeds}" tabindex="3">
                                            <a:support status="docEditForm:status" event="onchange" reRender="pushOnSiteFeedSwitchUnmanaged"/>
                                        </h:selectBooleanCheckbox>
                                        Create entry on parent directory feeds
                                    </div>
                                </s:div>
                                <s:div id="pushOnSiteFeedSwitchUnmanaged">
                                    <s:div styleClass="entry" rendered="#{documentHome.pushOnFeeds}">
                                        <div class="label">&#160;</div>
                                        <div class="input">
                                            <h:selectBooleanCheckbox value="#{documentHome.pushOnSiteFeed}" tabindex="3"/>
                                            Create entry on global site feed
                                        </div>
                                    </s:div>
                                </s:div>
                            </s:fragment>

                            <s:fragment rendered="#{documentHome.managed}">
                                <s:fragment rendered="#{documentHome.siteFeedEntryPresent}">
                                    <s:div styleClass="entry">
                                        <div class="label">&#160;</div>
                                        <div class="input">
                                            <h:selectBooleanCheckbox value="#{documentHome.pushOnFeeds}" tabindex="3"/>
                                            Push changes onto feeds
                                        </div>
                                    </s:div>
                                </s:fragment>
                                <s:fragment rendered="#{not documentHome.siteFeedEntryPresent}">
                                    <s:div styleClass="entry">
                                        <div class="label">&#160;</div>
                                        <div class="input">
                                            <h:selectBooleanCheckbox value="#{documentHome.pushOnFeeds}" tabindex="3">
                                                <a:support status="docEditForm:status" event="onchange" reRender="pushOnSiteFeedSwitch"/>
                                            </h:selectBooleanCheckbox>
                                            Push changes onto feeds of parent directories
                                        </div>
                                    </s:div>
                                    <s:div id="pushOnSiteFeedSwitch">
                                        <s:div styleClass="entry" rendered="#{documentHome.pushOnFeeds}">
                                            <div class="label">&#160;</div>
                                            <div class="input">
                                                <h:selectBooleanCheckbox value="#{documentHome.pushOnSiteFeed}" tabindex="3"/>
                                                Create entry on  global site feed
                                            </div>
                                        </s:div>
                                    </s:div>
                                </s:fragment>
                            </s:fragment>

                            <s:decorate id="contentDecorate" template="includes/formFieldDecorate.xhtml">
                                <ui:param name="tabId" value="docContentTab"/>
                                <ui:param name="fieldId" value="contentTextArea"/>
                                <ui:define name="label">Content</ui:define>
                                <script type="text/javascript">if(!$.browser.safari &amp;&amp; !$.browser.msie){
                                    jQuery(function() {
                                        jQuery("#contentTextEdit").Resizable({
                                            minHeight: 50,
                                            handlers: {
                                                s: '#contentTextEditResizeHandle'
                                            },
                                            onResize: function(size) {
                                                jQuery("textarea", this).css({ height: size.height + "px" });
                                            }
                                        });
                                        jQuery("#contentTextEditResizeHandle").show();
                                    }
                                )};</script>
                                <div id="contentTextEdit" class="textEditResizable">
                                    <h:inputTextarea tabindex="3"
                                                     required="true"
                                                     cols="#{docEditorPreferences.properties['regularEditAreaColumns']}"
                                                     rows="#{docEditorPreferences.properties['regularEditAreaRows']}"
                                                     id="contentTextArea"
                                                     value="#{documentHome.formContent}">
                                        <a:support status="docEditForm:status" rendered="#{documentHome.enabledPreview}" event="onkeyup" reRender="preview" requestDelay="3000" eventsQueue="editKeyPress"/>
                                        <a:support status="docEditForm:status" event="onblur" reRender="contentDecorate"/>
                                    </h:inputTextarea>
                                    <div id="contentTextEditResizeHandle" class="textEditResizeHandle" style="display:none"/>
                                </div>
                            </s:decorate>

                            <s:div styleClass="entry">
                                <div class="label">&#160;</div>
                                <div class="input">
                                    <h:selectBooleanCheckbox value="#{documentHome.enabledPreview}" tabindex="3">
                                        <a:support status="docEditForm:status" event="onchange" reRender="preview,contentDecorate,pluginSwitch"/>
                                    </h:selectBooleanCheckbox>
                                    Show interactive preview
                                </div>
                            </s:div>

                            <s:div id="pluginSwitch">
                                <s:div styleClass="entry" rendered="#{documentHome.enabledPreview}">
                                    <div class="label">&#160;</div>
                                    <div class="input">
                                        <h:selectBooleanCheckbox value="#{documentHome.showPluginPrefs}" tabindex="3">
                                            <a:support status="docEditForm:status" event="onchange" reRender="preview"/>
                                        </h:selectBooleanCheckbox>
                                        Show plugin settings in preview
                                    </div>
                                </s:div>
                            </s:div>

                        </div>
                    </a:region>

                </div>

                <div id="docProperties">

                    <a:region>
                        <div class="formFields">

                            <s:div styleClass="entry" rendered="#{documentHome.managed}">
                                <div class="label">Created On:</div>
                                <div class="output">
                                    <h:outputText value="#{documentHome.instance.createdOn}">
                                        <f:convertDateTime type="both" timeZone="#{wikiPreferences.timeZone}"/>
                                    </h:outputText>
                                    <s:span id="ownerDisplay">&#160;(#{documentHome.instance.createdBy.username})</s:span>
                                    <h:outputLink id="selectOwner" value="#" tabindex="1" styleClass="buttonNonpersistent"
                                                  rendered="#{s:hasPermission('User', 'isAdmin', currentUser)}"><j4j:idProxy
                                                    id="openDialogOwnerSelection"/><span class="buttonLabel">...</span></h:outputLink>
                                </div>
                            </s:div>

                            <ui:include src="includes/accessLevelSelector.xhtml"/>


                            <s:div styleClass="entry">
                                <div class="label">Options:</div>
                                <div class="input">
                                    <h:selectBooleanCheckbox value="#{documentHome.instance.enableComments}" tabindex="3">
                                        <a:support status="docEditForm:status" event="onchange" reRender="commentFormSwitch"/>
                                    </h:selectBooleanCheckbox>
                                    Enable comments
                                </div>
                            </s:div>

                            <s:div id="commentFormSwitch">
                                <s:div styleClass="entry" rendered="#{documentHome.instance.enableComments}">
                                    <div class="label">&#160;</div>
                                    <div class="input">
                                        <h:selectBooleanCheckbox value="#{documentHome.instance.enableCommentForm}" tabindex="3"/>
                                        Allow posting of new comments
                                    </div>
                                </s:div>
                            </s:div>

                        </div>
                    </a:region>

                </div>

            </div>

            <div class="formControls">
                <div class="entry">
                    <div class="label">&#160;</div>
                    <div class="input">

                        <h:commandLink id="save" action="#{documentHome.persist}"
                                       rendered="#{!documentHome.managed}"
                                       tabindex="4" accesskey="S" styleClass="button saveButton"><span class="buttonLabel"><u>S</u>ave</span></h:commandLink>

                        <h:commandLink id="update" action="#{documentHome.update}"
                                   rendered="#{documentHome.managed}"
                                   tabindex="4" accesskey="U" styleClass="button saveButton"><span class="buttonLabel"><u>U</u>pdate</span></h:commandLink>

                        <h:outputLink id="delete" value="#" tabindex="4" accesskey="D" styleClass="button"
                                      rendered="#{documentHome.managed and documentHome.instance.id != wikiStart.id}"><j4j:idProxy
                                id="openDialogDelete"/><span class="buttonLabel"><u>D</u>elete</span></h:outputLink>

                    </div>
                </div>
            </div>

        </div>
    </h:form>

    </div></div></div>

    <br/>

    <s:div id="preview">
        <s:div id="documentDisplayContainer"
               rendered="#{documentHome.enabledPreview}"
               styleClass="shadowContainer"><div class="shadow1"><div class="shadow2">
            <s:div id="documentDisplay" styleClass="documentDisplay"><j4j:idProxy id="documentDisplay_" />
                <s:div rendered="#{documentHome.instance.nameAsTitle}"><h1 class="documentTitle">#{documentHome.instance.name}</h1></s:div>
                <wiki:formattedText value="#{documentHome.instance.content}"
                                    linkStyleClass="regularLink"
                                    brokenLinkStyleClass="brokenLink"
                                    attachmentLinkStyleClass="regularLink"
                                    thumbnailLinkStyleClass="regularLink"
                                    renderBaseDocument="#{documentHome.instance}"
                                    renderBaseDirectory="#{documentHome.parentDirectory}"
                                    enablePlugins="true"/>
            </s:div>
        </div></div></s:div>

        <s:div rendered="#{documentHome.enabledPreview}">
            <ui:include src="includes/attachmentDisplay.xhtml"/>
        </s:div>
    </s:div>

</ui:define>

<ui:define name="footer">&#160;</ui:define>


</ui:composition>

