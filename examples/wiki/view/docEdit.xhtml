
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                xmlns:rich="http://richfaces.ajax4jsf.org/rich"
                template="themes/#{globalPrefs.themeName}/template.xhtml">

<ui:define name="includeHeaders">
    <link href="#{themePath}/css/userControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/searchControl.css" rel="stylesheet" type="text/css"/>
    <link href="#{themePath}/css/mainMenu.css" rel="stylesheet" type="text/css"/>
</ui:define>

<ui:define name="screenname">
    <h:outputText value="Create document" rendered="#{!documentHome.managed}"/>
    <h:outputText value="Edit document" rendered="#{documentHome.managed}"/>
</ui:define>

<ui:define name="headerTopRight">
    <ui:include src="includes/userControl.xhtml"/>
</ui:define>

<ui:define name="headerBottomLeft">&#160;</ui:define>

<ui:define name="sidebar">
    <ui:include src="includes/searchControl.xhtml"/>
    <ui:include src="includes/mainMenu.xhtml"/>
</ui:define>

<ui:define name="controlRight">

    <s:link id="uploadFile" styleClass="linkNavigation" action="uploadFile" accesskey="U"
            rendered="#{s:hasPermission('Node', 'create', documentHome.parentDirectory)}"><u>U</u>pload File</s:link>

    <s:link id="exit" styleClass="linkNavigation"
            action="#{documentHome.exitConversation(true)}"
            accesskey="E"><u>E</u>xit Editor</s:link>
</ui:define>

<ui:define name="content">

    <h:form>

        <div class="form">
            <div class="formHead">
                <h:outputText value="New document: #{documentHome.instance.name}" rendered="#{!documentHome.managed}"/>
                <h:outputText value="Editing document: #{documentHome.instance.name}"
                              rendered="#{documentHome.managed}"/>
            </div>

            <div class="formFields">

                <s:validateAll>

                    <s:div styleClass="entry" rendered="#{documentHome.managed}">
                        <div class="label">Created On:</div>
                        <div class="output">
                            <h:outputText value="#{documentHome.instance.createdOn}">
                                <f:convertDateTime type="both"/>
                            </h:outputText>
                            (#{documentHome.instance.createdBy.username})
                        </div>
                    </s:div>

                    <ui:include src="includes/accessLevelSelector.xhtml"/>

                    <s:decorate>
                        <div class="entry">
                            <div class="label">Name:</div>
                            <div class="input">
                                <h:inputText tabindex="2" size="80" maxlength="255" id="name" required="true"
                                             value="#{documentHome.instance.name}"/>
                            </div>
                        </div>
                    </s:decorate>

                    <s:decorate>
                        <div class="entry">
                            <div class="label">Content:</div>
                            <s:div styleClass="input" id="content">
                                <h:inputTextarea tabindex="3" required="true" cols="80" rows="25" 
                                                 id="contentNoPreview"
                                                 rendered="#{!documentHome.enabledPreview}"
                                                 value="#{documentHome.formContent}"/>
                                <h:inputTextarea tabindex="3" required="true" cols="80" rows="8"
                                                 id="contentWithPreview"
                                                 rendered="#{documentHome.enabledPreview}"
                                                 value="#{documentHome.formContent}">
                                    <a:support event="onkeyup" reRender="preview,attachmentDisplay" requestDelay="3000" eventQueue="editKeyPress"/>
                                </h:inputTextarea>
                            </s:div>
                        </div>
                    </s:decorate>
                    
                    <s:div styleClass="entry">
                        <div class="label">&#160;</div>
                        <div class="input">
                            <h:selectBooleanCheckbox value="#{documentHome.enabledPreview}" tabindex="3">
                                <a:support event="onchange" reRender="preview,attachmentDisplay,content"/>
                            </h:selectBooleanCheckbox>
                            Show interactive preview
                        </div>
                    </s:div>

                    <s:div styleClass="entry" rendered="#{documentHome.managed}">
                        <div class="label">&#160;</div>
                        <div class="input">
                            <h:selectBooleanCheckbox value="#{documentHome.minorRevision}" tabindex="3"/>
                            Minor change, don't create a new revision
                        </div>
                    </s:div>

                </s:validateAll>

            </div>
            <div class="formControls">

                <div class="entry">
                    <div class="label">&#160;</div>
                    <div class="input">

                        <h:commandLink id="save" action="#{documentHome.persist}"
                                       rendered="#{!documentHome.managed}"
                                       tabindex="4" accesskey="S" styleClass="button"><span class="buttonLabel"><u>S</u>ave</span></h:commandLink>

                        <h:commandLink id="update" action="#{documentHome.update}"
                                   rendered="#{documentHome.managed}"
                                   tabindex="5" accesskey="U" styleClass="button"><span class="buttonLabel"><u>U</u>pdate</span></h:commandLink>

                        <h:outputLink id="delete" value="javascript:Richfaces.showModalPanel('deleteConfirmation',{})"
                                      rendered="#{documentHome.managed}"
                                      tabindex="6" accesskey="D" styleClass="button"><span class="buttonLabel"><u>D</u>elete</span></h:outputLink>

                    </div>
                </div>

            </div>

        </div>

    </h:form>

    <ui:decorate template="includes/confirmationModalDialog.xhtml">
        <ui:param name="confirmationModalDialogId" value="deleteConfirmation"/>
        <ui:define name="confirmationText">
            <p>Are you sure you want to delete the document '#{documentHome.instance.name}'?</p>
        </ui:define>
        <ui:define name="confirmationOption">
            <h:commandLink id="delete" action="#{documentHome.remove}"
                           accesskey="O" styleClass="button">
                <span class="buttonLabel"><u>O</u>k</span>
            </h:commandLink>
        </ui:define>
    </ui:decorate>

    <s:div styleClass="documentDisplay" id="preview">
        <wiki:formattedText value="#{documentHome.instance.content}"
                            rendered="#{documentHome.enabledPreview}"
                            linkStyleClass="regularLink"
                            brokenLinkStyleClass="brokenLink"
                            attachmentLinkStyleClass="regularLink"
                            inlineLinkStyleClass="regularLink"/>

        <ui:include src="includes/attachmentDisplay.xhtml"/>

    </s:div>

</ui:define>

<ui:define name="footer">&#160;</ui:define>


</ui:composition>

