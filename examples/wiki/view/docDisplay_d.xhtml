<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:wiki="http://jboss.com/products/seam/wiki"
                xmlns:j4j="http://javascript4jsf.dev.java.net/"
                xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:rich="http://richfaces.org/rich"
                template="themes/#{wikiPreferences.themeName}/template.xhtml">

<ui:define name="includeHeaders">

    <s:fragment rendered="#{not empty documentHome.parentDirectory.feed}">
        <link rel="alternate" type="application/atom+xml"
              title="#{documentHome.parentDirectory.name}"
              href="#{facesContext.externalContext.request.contextPath}/servlets/feeds/atom.seam?feedId=#{currentDirectory.feed.id}"/>
        
    </s:fragment>

</ui:define>

<ui:define name="screenname">#{documentHome.instance.name}</ui:define>

<ui:define name="controlTwo">

    <s:fragment rendered="#{not documentHome.instance.macroPresent('hideControls') or s:hasPermission('User', 'isAdmin', currentUser)}">

        <s:link id="createDoc" styleClass="linkNavigation"
                accesskey="#{messages['lacewiki.button.CreateDocument.accesskey']}"
                view="/docEdit_#{skin}.xhtml"
                rendered="#{s:hasPermission('Node', 'create', documentHome.instance.parent)}">
            <h:outputText escape="false" value="#{messages['lacewiki.button.CreateDocument']}"/>
            <f:param name="documentId" value=""/>
            <f:param name="parentDirectoryId" value="#{documentHome.instance.parent.id}"/>
        </s:link>

        <s:link id="editDoc" styleClass="linkNavigation"
                accesskey="#{messages['lacewiki.button.EditDocument.accesskey']}"
                view="/docEdit_#{skin}.xhtml"
                rendered="#{s:hasPermission('Node', 'edit', documentHome.instance)}">
            <h:outputText escape="false" value="#{messages['lacewiki.button.EditDocument']}"/>
        </s:link>

        <s:link id="showHistory" styleClass="linkNavigation"
                accesskey="#{messages['lacewiki.button.HistoryDocument.accesskey']}"
                view="/docHistory_#{skin}.xhtml"
                rendered="#{documentHome.historicalNodesPresent}">
            <h:outputText escape="false" value="#{messages['lacewiki.button.HistoryDocument']}"/>
            <f:param name="nodeId" value="#{documentHome.nodeId}"/>
        </s:link>

        <s:link id="browseDir" styleClass="linkNavigation"
                accesskey="#{messages['lacewiki.button.BrowseDirectory.accesskey']}"
                view="/dirDisplay_#{skin}.xhtml">
            <h:outputText escape="false" value="#{messages['lacewiki.button.BrowseDirectory']}"/>
            <f:param name="directoryId" value="#{documentHome.parentDirectory.id}"/>
        </s:link>

    </s:fragment>

    <s:fragment rendered="#{documentHome.instance.macroPresent('hideControls') and not s:hasPermission('User', 'isAdmin', currentUser)}">
        <script type="text/javascript">jQuery(function() {
            jQuery("#wikiControls").hide();
        })</script>
    </s:fragment>

</ui:define>

<ui:define name="content">

    <s:fragment rendered="#{documentHome.instance.macroPresent('clearBackground')}">
        <script type="text/javascript">jQuery(function() {
            clearDocumentBackground();
        });</script>
    </s:fragment>

    <div id="documentDisplayContainer" class="box">
        <s:div id="documentDisplay" styleClass="documentDisplay">
            <s:div rendered="#{documentHome.instance.nameAsTitle}"><h1 class="documentTitle">#{documentHome.instance.name}</h1></s:div>
            <wiki:formattedText value="#{documentHome.instance.content}"
                                linkStyleClass="regularLink"
                                brokenLinkStyleClass="brokenLink"
                                attachmentLinkStyleClass="regularLink"
                                thumbnailLinkStyleClass="regularLink"
                                renderBaseDocument="#{documentHome.instance}"
                                renderBaseDirectory="#{documentHome.parentDirectory}"
                                enablePlugins="true"/>
        </s:div>

        <s:div rendered="#{wikiPreferences.showTags and not documentHome.instance.macroPresent('hideTags') and not empty documentHome.instance.tags}"
               styleClass="documentTags undecoratedLink">
            <s:div>
                #{messages['lacewiki.label.docDisplay.Tags']}:&#160;
                <ui:repeat var="tag" value="#{documentHome.instance.tagsSplit}">
                    <s:link view="/tagDisplay_#{skin}.xhtml" value="#{tag}">
                        <f:param value="#{tag}" name="tag"/>
                    </s:link>

                    <h:outputText rendered="#{documentHome.instance.tagsSplit.indexOf(tag) &lt; documentHome.instance.tagsSplit.size()-1}"
                                  value="&#160;|&#160;"/>
                </ui:repeat>
            </s:div>
        </s:div>

        <s:div rendered="#{wikiPreferences.showDocumentCreatorHistory and not documentHome.instance.macroPresent('hideCreatorHistory')}"
               styleClass="documentCreatorHistory undecoratedLink">
            <s:div>
                #{messages['lacewiki.label.docDisplay.Created']}:&#160;
                <h:outputText value="#{documentHome.instance.createdOn}">
                    <f:convertDateTime pattern="dd. MMM yyyy, HH:mm" timeZone="#{wikiPreferences.timeZone}"/>
                </h:outputText>
                <h:outputText value="&#160;#{wikiPreferences.timeZone}&#160;("/>
                <h:outputLink value="#{wiki:renderHomeURL(documentHome.instance.createdBy)}"
                              rendered="#{!empty documentHome.instance.createdBy.memberHome}">
                    <h:outputText value="#{documentHome.instance.createdBy.fullname}"/>
                </h:outputLink>
                <h:outputText rendered="#{empty documentHome.instance.createdBy.memberHome}"
                              value="#{documentHome.instance.createdBy.fullname}"/>
                <h:outputText value=")"/>
            </s:div>
            <s:div rendered="#{not empty documentHome.instance.lastModifiedBy}">
                #{messages['lacewiki.label.docDisplay.LastModified']}:&#160;
                <h:outputText value="#{documentHome.instance.lastModifiedOn}">
                    <f:convertDateTime pattern="dd. MMM yyyy, HH:mm" timeZone="#{wikiPreferences.timeZone}"/>
                </h:outputText>
                <h:outputText value="&#160;#{wikiPreferences.timeZone}&#160;("/>
                <h:outputLink value="#{wiki:renderHomeURL(documentHome.instance.lastModifiedBy)}"
                              rendered="#{!empty documentHome.instance.lastModifiedBy.memberHome}">
                    <h:outputText value="#{documentHome.instance.lastModifiedBy.fullname}"/>
                </h:outputLink>
                <h:outputText rendered="#{empty documentHome.instance.lastModifiedBy.memberHome}"
                              value="#{documentHome.instance.lastModifiedBy.fullname}"/>
                <h:outputText value=")"/>
            </s:div>
            <s:div rendered="#{documentHome.historicalNodesPresent}">
                #{messages['lacewiki.label.docDisplay.Revisions']}:&#160;
                <ui:repeat var="hnode" value="#{documentHome.historicalNodes}">

                    <h:outputText value="#{hnode.lastModifiedOn}">
                        <f:convertDateTime pattern="dd. MMM yyyy, HH:mm" timeZone="#{wikiPreferences.timeZone}"/>
                    </h:outputText>
                    <h:outputText value="&#160;#{wikiPreferences.timeZone}&#160;(#{hnode.lastModifiedByUsername})"/>

                    &#160;
                    <s:link view="/docHistory_#{skin}.xhtml" action="#{nodeHistory.diff}">
                        <h:outputText value="#{messages['lacewiki.label.docDisplay.Diff']}"/>
                        <f:param name="nodeId" value="#{documentHome.instance.id}"/>
                        <f:param name="historicalNodeId" value="#{hnode.historyId}"/>
                    </s:link>

                    <h:outputText rendered="#{documentHome.historicalNodes.indexOf(hnode) &lt; documentHome.historicalNodes.size()-1}"
                                  value="&#160;|&#160;"/>

                </ui:repeat>
            </s:div>

        </s:div>
    </div>

    <ui:include src="includes/attachmentDisplay.xhtml"/>

    <s:span id="commentDisplayForm" rendered="#{not documentHome.instance.macroPresent('hideComments')}">
        <ui:include src="includes/commentsDisplay.xhtml"/>

        <ui:include src="includes/commentForm.xhtml"/>
    </s:span>

</ui:define>

<ui:define name="footer">&#160;</ui:define>

</ui:composition>

