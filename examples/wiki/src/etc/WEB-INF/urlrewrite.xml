<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE urlrewrite PUBLIC "-//tuckey.org//DTD UrlRewrite 3.0//EN" "http://tuckey.org/res/dtds/urlrewrite3.0.dtd">

<!--

    Rewrite various Wiki-like URL paths to request parameters (http://tuckey.org/urlrewrite/)

    @author Christian Bauer

-->
<urlrewrite>

    <!-- Disable the Red Hat crawler -->
    <rule>
        <from>.*</from>
        <condition name="remote-addr">66.187.233.202</condition>
        <to last="true" type="temporary-redirect">/robots.txt</to>
    </rule>

    <!-- Mobile browser -->
    <rule>
        <from>.*</from>
        <condition next="or" name="user-agent">Windows CE</condition>
        <condition next="or" name="user-agent">SonyEricsson</condition>
        <condition name="user-agent">BlackBerry</condition>
        <set type="session" name="skin">m</set>
    </rule>

    <!-- /123.lace -->
    <rule>
        <from>^/([0-9]+)\.[a-zA-z]+$</from>
        <to last="true">/wiki.seam?nodeId=$1</to>
     </rule>

    <!-- /service/Feed/atom (/Area/Foo) (/Node/Bar) (/Comments/exclude/) (/Tag/foobar) (/Aggregate/My Aggregate) -->
    <rule>
        <from casesensitive="true">^/service/Feed/atom(?:/Area/([A-Z0-9]+[A-Za-z0-9]*))?(?:/Node/([A-Z0-9]+[A-Za-z0-9]*))?(?:/Comments/([a-z]+))?(?:/Tag/(.+))?(?:/Aggregate/(.+))?$</from>
        <to last="true">/servlets/feeds/atom.seam?areaName=$1&amp;nodeName=$2&amp;comments=$3&amp;tag=$4&amp;aggregate=$5</to>
    </rule>

    <!-- /service/File/123 -->
    <rule>
        <from casesensitive="true">^/service/File/([0-9]+)$</from>
        <to last="true">/servlets/files/download.seam?fileId=$1</to>
    </rule>

    <!-- /Foo (/Bar) (/Year/2007 (/Month/08) (/Day/23) (/Page/3) (/Tag/foobar) (/Category/foobar) -->
    <rule>
        <from casesensitive="true">^/([A-Z0-9]+[A-Za-z0-9]*)(?:/([A-Z0-9]+[A-Za-z0-9]*))?(?:/Year/([0-9]{4}))?(?:/Month/([0-9]{2}))?(?:/Day/([0-9]{2}))?(?:/Page/([0-9]+))?(?:/Tag/(.+))?(?:/Category/(.+))?$</from>
        <to>/wiki.seam?areaName=$1&amp;nodeName=$2&amp;year=$3&amp;month=$4&amp;day=$5&amp;page=$6&amp;tag=$7&amp;category=$8</to>
    </rule>

    <!-- /Foo (/Bar) (/Year/2007) (/Month/08) (/Day/23) /Summary -->
    <rule>
        <from casesensitive="true">^/([A-Z0-9]+[A-Za-z0-9]*)(?:/([A-Z0-9]+[A-Za-z0-9]*))?(?:/Year/([0-9]{4}))?(?:/Month/([0-9]{2}))?(?:/Day/([0-9]{2}))?/Summary$</from>
        <to>/wiki.seam?areaName=$1&amp;nodeName=$2&amp;year=$3&amp;month=$4&amp;day=$5&amp;summary=true</to>
    </rule>

    <!-- Blosxom migration from blog.hibernate.org, the best we can do (you probably can delete all of this):

        http://blog.hibernate.org/cgi-bin/blosxom.cgi
        http://blog.hibernate.org/cgi-bin/blosxom.cgi/2007/08/
        http://blog.hibernate.org/cgi-bin/blosxom.cgi/2007/08/01/
        http://blog.hibernate.org/cgi-bin/blosxom.cgi/index.rss
    -->
    <rule>
        <from casesensitive="true">^/cgi-bin/blosxom.cgi$</from>
        <to last="true" type="permanent-redirect">%{scheme}://%{server-name}%{context-path}/</to>
    </rule>
    <rule>
        <from casesensitive="true">^/cgi-bin/blosxom.cgi/([0-9]{4})/([0-9]{2})/?$</from>
        <to last="true" type="permanent-redirect">%{scheme}://%{server-name}%{context-path}/Bloggers/Everyone/$1/$2</to>
    </rule>
    <rule>
        <from casesensitive="true">^/cgi-bin/blosxom.cgi/([0-9]{4})/([0-9]{2})/([0-9]{2})/?$</from>
        <to last="true" type="permanent-redirect">%{scheme}://%{server-name}%{context-path}/Bloggers/Everyone/$1/$2/$3</to>
    </rule>
    <rule>
        <from casesensitive="true">^/cgi-bin/blosxom.cgi/index.rss$</from>
        <to last="true" type="permanent-redirect">%{scheme}://%{server-name}%{context-path}/Feed/atom</to>
    </rule>

    <!-- ROOT / -->
    <rule>
        <from>^/$</from>
        <to>/wiki.seam</to>
    </rule>

</urlrewrite>

