<?xml version="1.0"?>
<!-- Ant build file containing build related common properties, definitions and targets -->
<!-- Properties used:
   build.dir - root of Seam build system
   version
   patchlevel
   mavenised - whether to use a mavenised dependency management system. 
               If false a ${seam.dir}/lib dir and the ${seam.dir}/jboss-seam*.jar
               must be present.
-->
<project basedir="." xmlns:artifact="urn:maven-artifact-ant">

	<property file="${seam.dir}/build.properties" />
	
	<condition property="mavenized.property">
		<not>
			<equals arg1="${mavenized}" arg2="false" />
		</not>
	</condition>

	<property name="build.lib.dir" value="${build.dir}/lib" />
	<property name="maven.dir" value="${build.dir}/maven" />

	<path id="maven-ant-tasks.classpath" path="${build.lib.dir}/maven-ant-tasks.jar" />
	<typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant" classpathref="maven-ant-tasks.classpath" />

	<artifact:remoteRepository id="local.repository" url="file://${build.dir}/repository" />

	<!-- POMs -->
	<echo>Setting up dependencies</echo>
	<pomfile name="root.pom" value="${build.dir}/root.pom.xml" />
	<install pom="${root.pom}" />
	<pomfile name="core.pom" value="${build.dir}/core.pom.xml" />
	<pomfile name="debug.pom" value="${build.dir}/debug.pom.xml" />
	<pomfile name="gen.pom" value="${build.dir}/gen.pom.xml" />
	<pomfile name="ioc.pom" value="${build.dir}/ioc.pom.xml" />
	<pomfile name="mail.pom" value="${build.dir}/mail.pom.xml" />
	<pomfile name="pdf.pom" value="${build.dir}/pdf.pom.xml" />
	<pomfile name="remoting.pom" value="${build.dir}/remoting.pom.xml" />
	<pomfile name="ui.pom" value="${build.dir}/ui.pom.xml" />

	<target name="initcopy">
		<mkdir dir="${lib.dir}" />
	</target>
	
	<target name="copyseamdependencies" if="mavenized.property">
		<copyDependencies id="core" pom="${core.pom}" todir="${lib.dir}" scope="compile" />
		<copyDependencies id="debug" pom="${debug.pom}" todir="${lib.dir}" scope="compile" />
		<copyDependencies id="ioc" pom="${ioc.pom}" todir="${lib.dir}" scope="compile" />
		<copyDependencies id="mail" pom="${mail.pom}" todir="${lib.dir}" scope="compile" />
		<copyDependencies id="pdf" pom="${pdf.pom}" todir="${lib.dir}" scope="compile" />
		<copyDependencies id="remoting" pom="${remoting.pom}" todir="${lib.dir}" scope="compile" />
		<copyDependencies id="ui" pom="${ui.pom}" todir="${lib.dir}" scope="compile" />
	</target>

	<target name="copyseam" if="mavenized.property">
		<artifact:dependencies filesetId="seam.fileset" versionsId="seam.versions">
			<dependency groupId="org.jboss.seam" artifactId="jboss-seam" version="${version}.${patchlevel}" />
			<dependency groupId="org.jboss.seam" artifactId="jboss-seam-debug" version="${version}.${patchlevel}" />
			<dependency groupId="org.jboss.seam" artifactId="jboss-seam-ioc" version="${version}.${patchlevel}" />
			<dependency groupId="org.jboss.seam" artifactId="jboss-seam-mail" version="${version}.${patchlevel}" />
			<dependency groupId="org.jboss.seam" artifactId="jboss-seam-pdf" version="${version}.${patchlevel}" />
			<dependency groupId="org.jboss.seam" artifactId="jboss-seam-remoting" version="${version}.${patchlevel}" />
			<dependency groupId="org.jboss.seam" artifactId="jboss-seam-ui" version="${version}.${patchlevel}" />
		</artifact:dependencies>
		<copy todir="${lib.dir}">
			<fileset refid="seam.fileset" />
			<mapper classpathref="maven-ant-tasks.classpath" classname="org.apache.maven.artifact.ant.VersionMapper" from="${seam.versions}" to="flatten" />
		</copy>
	</target>
	
	<target name="copyjbossembedded" if="mavenized.property">
		<artifact:dependencies filesetId="embeddedjboss.fileset" versionsId="embeddedjboss.versions">
			<dependency groupId="org.jboss.embedded" artifactId="jboss-embedded-all" version="beta2" />
			<dependency groupId="org.jboss.embedded" artifactId="thirdparty-all" version="beta2" />
			<dependency groupId="org.jboss.embedded" artifactId="hibernate-all" version="beta2" />
			<remoteRepository refId="local.repository" />
		</artifact:dependencies>
		<copy todir="${lib.dir}/test">
			<fileset refid="embeddedjboss.fileset" />
			<mapper classpathref="maven-ant-tasks.classpath" classname="org.apache.maven.artifact.ant.VersionMapper" from="${embeddedjboss.versions}" to="flatten" />
		</copy>
	</target>
</project>