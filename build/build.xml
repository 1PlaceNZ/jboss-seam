<?xml version="1.0"?>

<!-- ======================================================================= -->
<!-- JBoss build file                                                       -->
<!-- ======================================================================= -->

<project name="JBoss" default="deploy" basedir="..">

	<property environment="env" />
	<property name="src.dir" value="${basedir}/src" />
	<property name="main.dir" value="${src.dir}/main" />
	<property name="resources.dir" value="${src.dir}/resources" />
	<property name="output.dir" value="${basedir}/output" />
	<property name="output.classes.dir" value="${output.dir}/classes" />
	<property name="output.deployer.dir" value="${output.dir}" />

	<property name="jboss.home" value="${env.JBOSS_HOME}" />
	<property name="jboss.server" value="default"/>
	<property name="jboss.server.dir" value="${jboss.home}/server/${jboss.server}"/>
	<property name="deploy.dir" value="${jboss.server.dir}/deploy" />

	<!-- Build classpath -->
	<path id="classpath">
		<fileset dir="${basedir}/lib">
			<include name="**/*.jar"/>
		</fileset>
		<fileset dir="${jboss.home}/lib">
			<include name="**/*.jar" />
		</fileset>
		<fileset dir="${jboss.server.dir}/lib">
			<include name="**/*.jar" />
		</fileset>
		<fileset dir="${jboss.server.dir}/deploy/jbossweb-tomcat55.sar/jsf-libs">
			<include name="**/*.jar" />
		</fileset>
		<fileset dir="${jboss.server.dir}/deploy/ejb3.deployer">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${jboss.server.dir}/deploy/jboss-aop-jdk50.deployer">
			<include name="*.jar" />
		</fileset>
	</path>

	<property name="build.classpath" refid="classpath" />

	<!-- =================================================================== -->
	<!-- Prepares the build directory                                        -->
	<!-- =================================================================== -->
	<target name="prepare">
		<mkdir dir="${output.dir}" />
		<mkdir dir="${output.deployer.dir}" />
		<mkdir dir="${output.deployer.dir}/META-INF" />
		<mkdir dir="${output.classes.dir}" />
	</target>

	<!-- =================================================================== -->
	<!-- Compiles the source code                                            -->
	<!-- =================================================================== -->
	<target name="compile" depends="prepare">
		<javac srcdir="${main.dir}" destdir="${output.classes.dir}" debug="on" deprecation="on" optimize="off" includes="**">
			<classpath refid="classpath" />
		</javac>
	</target>

	<target name="package" depends="compile">
		<jar jarfile="${output.dir}/jboss-seam.jar">
			<fileset dir="${output.classes.dir}">
				<include name="**/*.class" />
			</fileset>
			<fileset dir="${main.dir}">
			    <include name="**/*.cfg.xml" />
			</fileset>
			<fileset dir="${resources.dir}">
				<include name="META-INF/jboss-seam.tld"/>
			</fileset>
		</jar>
	</target>

	<target name="deploy" depends="package">
		<mkdir dir="${deploy.dir}/seam.deployer" />
		<copy file="${output.dir}/jboss-seam.jar" todir="${deploy.dir}/seam.deployer" />
		<copy file="${basedir}/lib/jbpm-3.0.jar" todir="${deploy.dir}/seam.deployer" />
		<copy file="${basedir}/lib/ehcache-1.1.jar" todir="${deploy.dir}/seam.deployer" />
		<copy file="${basedir}/lib/hibernate3.jar" todir="${deploy.dir}/seam.deployer" />
		<mkdir dir="${deploy.dir}/seam.deployer/META-INF" />
		<copy todir="${deploy.dir}/seam.deployer/META-INF">
			<fileset dir="${resources.dir}/META-INF" />
		</copy>
	</target>

	<target name="undeploy">
		<delete dir="${deploy.dir}/seam.deployer" />
	</target>

	<!-- =================================================================== -->
	<!-- Cleans up generated stuff                                           -->
	<!-- =================================================================== -->

	<target name="clean">
		<delete dir="${output.dir}" />
		<delete dir="${deploy.dir}/seam.deployer" />
	</target>


</project>

